<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY WORK</title>
    <style>
        /* --- æç®€å·¥ä¸šé£æ ¼è®¾ç½® --- */
        :root {
            --bg-color: #F0F0F0;
            --text-color: #111;
            --card-bg: #FFF;
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            padding: 40px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            overflow-x: hidden;
        }

        /* é¡¶éƒ¨ä»‹ç»åŒº */
 /* ========================================= */
        /* âœ… æ–°çš„ï¼šå¤´éƒ¨èƒŒæ™¯è§†é¢‘æ ·å¼ (æ›¿æ¢å¼€å§‹)       */
        /* ========================================= */
        
        header {
            position: relative; /* å…³é”®å®šä½ */
            height: 75vh;       /* é«˜åº¦å å±å¹• 75% */
            min-height: 500px;
            margin-bottom: 30px; /* ä» 50px å‡å°‘åˆ° 30pxï¼Œè®©æ¸å˜æ›´æ¥è¿‘èœå•æ  */
            overflow: hidden;   /* æ”¹ä¸º hiddenï¼Œé˜²æ­¢è¾“å…¥æ¡†è¶…å‡ºè¾¹ç•Œ */
            display: flex;
            align-items: flex-end; /* å†…å®¹æ²‰åº• */
            color: white;       /* å¼ºåˆ¶æ–‡å­—å˜ç™½ */
        }

        /* Canvas èƒŒæ™¯å±‚ */
        #starry-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #000;
            display: block;
            pointer-events: auto; /* ç¡®ä¿å¯ä»¥æ¥æ”¶é¼ æ ‡äº‹ä»¶ */
        }
        
        /* æ§åˆ¶é¢æ¿æ ·å¼ï¼ˆå¯é€‰ï¼‰ */
        .starry-controls {
            position: absolute;
            top: 16px;
            right: 16px;
            z-index: 50;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .starry-controls:hover {
            opacity: 1;
        }
        
        .starry-controls input {
            width: 100%;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: white;
            text-align: center;
            font-size: 12px;
            text-transform: uppercase;
            font-family: var(--font-mono);
        }
        
        .starry-controls input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .control-buttons {
            display: flex;
            gap: 6px;
        }
        
        .control-btn {
            flex: 1;
            padding: 6px 8px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.6);
            font-size: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: var(--font-mono);
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .control-btn.active {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            color: rgb(191, 219, 254);
        }

        /* é¡¶éƒ¨æ è¾“å…¥æ¡†æ ·å¼ */
        .header-text-input {
            position: absolute;
            top: 40px;  /* ä¸æ ‡é¢˜ padding ä¿æŒä¸€è‡´ */
            right: 40px;  /* ä¸æ ‡é¢˜ padding ä¿æŒä¸€è‡´ */
            z-index: 10;
            width: 200px;
            max-width: calc(100% - 80px); /* å·¦å³å„ 40pxï¼Œæ€»å…± 80px */
        }
        
        .header-text-input input {
            width: 100%;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            color: white;
            font-size: 14px;
            font-family: var(--font-mono);
            text-align: center;
            text-transform: uppercase;
            transition: all 0.3s;
        }
        
        .header-text-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
            text-transform: none;
        }
        
        .header-text-input input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .header-text-input {
                top: 40px;  /* ä¸æ ‡é¢˜ padding ä¿æŒä¸€è‡´ */
                right: 40px;  /* ä¸æ ‡é¢˜ padding ä¿æŒä¸€è‡´ */
                width: 150px;
                max-width: calc(100% - 80px); /* ç§»åŠ¨ç«¯å·¦å³å„ 40pxï¼Œæ€»å…± 80px */
            }
            
            .header-text-input input {
                padding: 8px 12px;
                font-size: 12px;
            }
        }

        /* 2. é®ç½©å±‚ (ä¸­é—´å±‚) - è®©æ–‡å­—æ›´æ¸…æ™° */
        .overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0); /* é™ä½ä¸º 0ï¼Œå®Œå…¨é€æ˜ï¼Œä¸æ˜¾ç¤ºé®ç½© */
            z-index: 1;
            pointer-events: none; /* ä¸é˜»æŒ¡é¼ æ ‡äº‹ä»¶ï¼Œè®© canvas å¯ä»¥æ¥æ”¶äº¤äº’ */
        }

        /* 3. å†…å®¹å±‚ (æœ€ä¸Šå±‚) */
        .header-content {
            position: relative;
            z-index: 2;
            width: 100%;
            padding: 40px; /* æ–‡å­—ç¦»è¾¹ç¼˜çš„è·ç¦» */
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap; /* æ‰‹æœºä¸Šå…è®¸æ¢è¡Œ */
            gap: 20px;
            pointer-events: none; /* ä¸é˜»æŒ¡é¼ æ ‡äº‹ä»¶ï¼Œè®© canvas å¯ä»¥æ¥æ”¶äº¤äº’ */
        }
        
        /* ä½†æ–‡å­—å†…å®¹æœ¬èº«éœ€è¦å¯ä»¥ç‚¹å‡»ï¼Œæ‰€ä»¥å†…éƒ¨çš„é“¾æ¥ç­‰éœ€è¦æ¢å¤ pointer-events */
        .header-content a,
        .header-content button,
        .header-content input {
            pointer-events: auto;
        }

        /* å¤´éƒ¨å¤§æ ‡é¢˜ */
        h1 {
            font-size: 6rem; /* å­—ä½“æ”¹å¤§ä¸€ç‚¹æ›´éœ¸æ°” */
            line-height: 0.85;
            margin: 0;
            letter-spacing: -3px;
            text-transform: uppercase;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5); /* åŠ ç‚¹é˜´å½± */
        }

        /* å¤´éƒ¨ä»‹ç»æ–‡å­— */
        .intro {
            font-family: var(--font-mono);
            font-size: 1rem;
            max-width: 400px;
            line-height: 1.5;
            color: #eee; /* æµ…ç°ç™½ */
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* æ‰‹æœºé€‚é…è°ƒæ•´ */
        @media (max-width: 768px) {
            header { height: 60vh; }
            h1 { font-size: 3.5rem; }
            .header-content { flex-direction: column; align-items: flex-start; }
        }

        /* ========================================= */
        /* âœ… æ–°çš„æ ·å¼ (æ›¿æ¢ç»“æŸ)                    */
        /* ========================================= */
        .intro {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            max-width: 400px;
            line-height: 1.5;
        }

        /* åˆ†ç±»ç­›é€‰å™¨ */
        .filter-container {
            position: relative;
            z-index: 1; /* ç¡®ä¿åœ¨æ¸å˜ä¸Šæ–¹ */
            margin-bottom: 50px;
            padding: 0;
            width: 100%;
            max-width: 100%;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
        }

        .filter-btn {
            padding: 10px 20px;
            background: var(--card-bg);
            color: var(--text-color);
            border: 2px solid var(--text-color);
            border-radius: 8px;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            background: var(--text-color);
            color: var(--card-bg);
            border-color: var(--text-color);
        }

        .filter-btn.active {
            background: var(--text-color);
            color: var(--card-bg);
            border-color: var(--text-color);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            font-weight: 700;
        }

        .filter-btn:active {
            transform: translateY(0);
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
        }

        /* æ— ç»“æœæç¤º */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-family: var(--font-mono);
            grid-column: 1 / -1;
            font-size: 0.9rem;
        }

        /* ç€‘å¸ƒæµå¸ƒå±€ */
        .gallery {
            column-count: 3; /* ç”µè„‘æ˜¾ç¤º3åˆ— */
            column-gap: 20px;
        }

        /* å•ä¸ªä½œå“å¡ç‰‡ */
        .item {
            break-inside: avoid;
            background: var(--card-bg);
            margin-bottom: 20px;
            padding: 10px;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1); /* ç¡¬é˜´å½±æ›´æœ‰è®¾è®¡æ„Ÿ */
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .item:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
        }

        /* å›¾ç‰‡/è§†é¢‘å®¹å™¨ */
        .media-box {
            position: relative;
            width: 100%;
            background: #ddd; /* åŠ è½½å‰çš„å ä½è‰² */
            overflow: hidden;
        }

        /* æ¡Œé¢ç«¯ï¼šä¿æŒè‡ªé€‚åº”é«˜åº¦ï¼Œä½†è®¾ç½®æœ€å°é«˜åº¦é˜²æ­¢å¡Œé™· */
        @media (min-width: 769px) {
            .media-box {
                min-height: 200px; /* æœ€å°é«˜åº¦ï¼Œä½†ä¸å¼ºåˆ¶æ¯”ä¾‹ */
            }
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šç§»é™¤å›ºå®šæ¯”ä¾‹ï¼Œä½¿ç”¨è§†é¢‘åŸå§‹æ¯”ä¾‹ */
        @media (max-width: 768px) {
            .media-box {
                /* å®Œå…¨ç§»é™¤é«˜åº¦é™åˆ¶ï¼Œè®©è§†é¢‘å†…å®¹å†³å®šé«˜åº¦ */
                min-height: 0;
            }
            
            /* è§†é¢‘å®¹å™¨ä¸é™åˆ¶é«˜åº¦ */
            .video-container {
                min-height: 0;
            }
            
            /* éšè—ç§»åŠ¨ç«¯æ’­æ”¾æŒ‰é’® */
            .play-button-large {
                display: none !important;
            }
        }

        /* è§†é¢‘å®¹å™¨ç‰¹æ®Šå¤„ç† */
        .video-container {
            cursor: pointer;
        }

        /* æ’­æ”¾æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ */
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex; /* é»˜è®¤æ˜¾ç¤ºï¼Œæ¡Œé¢ç«¯éšè— */
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            z-index: 15; /* æé«˜å±‚çº§ç¡®ä¿å¯è§ */
            transition: all 0.3s ease;
            pointer-events: auto;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .play-button:active {
            transform: translate(-50%, -50%) scale(0.95);
            background: rgba(0, 0, 0, 0.9);
        }

        /* è§†é¢‘å ä½ç¬¦ */
        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            overflow: hidden;
        }
        
        /* å°é¢å›¾ */
        .video-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            display: block; /* ç¡®ä¿å°é¢å›¾æ˜¾ç¤º */
        }
        
        /* å°é¢å›¾åŠ è½½å¤±è´¥æ—¶çš„å¤„ç† */
        .video-cover[src=""],
        .video-cover:not([src]) {
            display: none;
        }
        
        .video-placeholder .play-button-large {
            position: relative;
            z-index: 2;
        }

        .play-button-large {
            width: 80px;
            height: 80px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .play-button-large:active {
            transform: scale(0.95);
            background: rgba(0, 0, 0, 0.9);
        }

        /* è§†é¢‘åŠ è½½ä¸­æ˜¾ç¤º */
        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            z-index: 12;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .video-loading::before {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .video-container video.ready {
            opacity: 1;
        }
        
        .video-container video.loading {
            opacity: 0.7;
        }

        /* è§†é¢‘æ’­æ”¾æ—¶éšè—å ä½ç¬¦å’ŒæŒ‰é’® */
        .video-container video.playing {
            z-index: 11;
        }

        .video-container video.playing ~ .video-placeholder,
        .video-container video.playing ~ .play-button {
            display: none !important;
            pointer-events: none !important;
        }
        
        /* æ¡Œé¢ç«¯ï¼šç¡®ä¿å ä½ç¬¦ä¸ä¼šé˜»æŒ¡è§†é¢‘å…ƒç´ çš„é¼ æ ‡äº‹ä»¶ */
        @media (min-width: 769px) {
            .video-placeholder {
                pointer-events: none !important;
            }
        }

        /* ç¡®ä¿å›¾ç‰‡è§†é¢‘é“ºæ»¡ */
        .media-box img,
        .media-box video {
            width: 100%;
            display: block;
            object-fit: cover;
            filter: grayscale(100%); /* é»˜è®¤é»‘ç™½ */
            transition: filter 0.3s;
        }
        
        /* æ¡Œé¢ç«¯ï¼šå›¾ç‰‡å’Œè§†é¢‘ä¿æŒè‡ªç„¶é«˜åº¦ */
        @media (min-width: 769px) {
            .media-box img,
            .media-box video {
                height: auto; /* æ¡Œé¢ç«¯è‡ªé€‚åº”é«˜åº¦ */
            }
        }
        
        /* ç§»åŠ¨ç«¯ï¼šå›¾ç‰‡å’Œè§†é¢‘ä¿æŒåŸå§‹æ¯”ä¾‹ */
        @media (max-width: 768px) {
            /* è§†é¢‘å®¹å™¨ - ä¸é™åˆ¶é«˜åº¦ï¼Œè®©å†…å®¹å†³å®š */
            .video-container {
                position: relative;
                min-height: 0;
            }
            
            /* å›¾ç‰‡ä¿æŒåŸå§‹æ¯”ä¾‹ */
            .media-box > img:not(.video-cover) {
                position: relative;
                height: auto;
                width: 100%;
            }
            
            /* å°é¢å›¾å ä½ç¬¦ - ç›¸å¯¹å®šä½ï¼Œè®©å®¹å™¨æ ¹æ®å°é¢å›¾é«˜åº¦è‡ªåŠ¨è°ƒæ•´ */
            /* å°é¢å›¾å ä½ç¬¦ - å…ˆç”¨ç›¸å¯¹å®šä½æ’‘å¼€å®¹å™¨ï¼Œä¿æŒåŸå§‹æ¯”ä¾‹ */
            .video-placeholder {
                position: relative;
                width: 100%;
                display: block;
                background: #222;
                cursor: pointer;
            }
            
            .video-placeholder .video-cover {
                position: relative;
                width: 100%;
                height: auto;
                display: block;
                object-fit: cover;
                transition: filter 0.3s, opacity 0.3s;
            }
            
            /* ç‚¹å‡»åå°é¢å›¾å˜ä¸ºå½©è‰² */
            .video-placeholder.clicked .video-cover,
            .video-placeholder:active .video-cover {
                filter: grayscale(0%) !important;
            }
            
            /* è§†é¢‘å®¹å™¨ */
            .video-container {
                position: relative;
            }
            
            /* ç§»åŠ¨ç«¯è§†é¢‘å…ƒç´  - ç›´æ¥æ˜¾ç¤ºï¼Œä½¿ç”¨ç›¸å¯¹å®šä½ */
            .mobile-video-item video {
                position: relative;
                width: 100%;
                height: auto;
                display: block;
                object-fit: cover;
                filter: grayscale(0%) !important;
            }
            
            /* ç§»åŠ¨ç«¯å›¾ç‰‡ï¼šé»˜è®¤é»‘ç™½ï¼Œè¿›å…¥è§†å£åå˜ä¸ºå½©è‰² */
            .media-box > img:not(.video-cover) {
                width: 100%;
                height: auto;
                display: block;
                filter: grayscale(100%) !important; /* é»˜è®¤é»‘ç™½ï¼Œæ·»åŠ  !important ç¡®ä¿ä¼˜å…ˆçº§ */
                transition: filter 0.3s;
            }
            
            /* å›¾ç‰‡è¿›å…¥è§†å£åå˜ä¸ºå½©è‰² */
            .media-box > img:not(.video-cover).in-view {
                filter: grayscale(0%) !important;
            }
            
            /* ç¡®ä¿ç§»åŠ¨ç«¯æ™®é€šå›¾ç‰‡ï¼ˆéè§†é¢‘å°é¢ï¼‰åº”ç”¨ç°åº¦æ•ˆæœ */
            .item .media-box img:not(.video-cover) {
                filter: grayscale(100%) !important;
            }
            
            .item .media-box img:not(.video-cover).in-view {
                filter: grayscale(0%) !important;
            }
        }

        /* é¼ æ ‡æ‚¬åœå˜å½©è‰² */
        .item:hover img, .item:hover video {
            filter: grayscale(0%);
        }

        /* è§†é¢‘æ ‡è¯†å°æ ‡ç­¾ */
        .badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #FF3333;
            color: white;
            font-size: 10px;
            padding: 3px 6px;
            font-weight: bold;
            font-family: var(--font-mono);
            z-index: 10;
            pointer-events: none;
        }

        /* æ–‡å­—ä¿¡æ¯ */
        .meta {
            margin-top: 12px;
        }
        .work-title {
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
        }
        .work-desc {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            .filter-container {
                margin-bottom: 30px;
                padding: 0;
            }
            
            .filter-buttons {
                gap: 8px;
                justify-content: flex-start;
            }
            
            .filter-btn {
                padding: 8px 16px;
                font-size: 0.75rem;
                border-radius: 6px;
            }
            
            .gallery { column-count: 1; } /* æ‰‹æœºå˜1åˆ— */
            h1 { font-size: 3rem; }
            body { padding: 20px; }
            
            /* ç§»åŠ¨ç«¯æ˜¾ç¤ºæ’­æ”¾æŒ‰é’® */
            .play-button {
                display: flex;
            }
            
            /* ç§»åŠ¨ç«¯ç‚¹å‡»æ—¶è§†é¢‘æ’­æ”¾ï¼Œéšè—æŒ‰é’® */
            .video-container:active .play-button {
                opacity: 0;
                transition: opacity 0.2s;
            }
            
            /* ç§»åŠ¨ç«¯è§†é¢‘ç‚¹å‡»æ’­æ”¾ */
            .video-container video {
                cursor: pointer;
            }
        }

        /* æ¡Œé¢ç«¯éšè—æ’­æ”¾æŒ‰é’® */
        @media (min-width: 769px) {
            .play-button {
                display: none !important;
            }
            
            .video-placeholder {
                display: none;
            }
        }
        
        
        
    </style>
</head>
<body>

    <!-- ========================================= -->
    <!-- âœ… æ–°çš„ï¼šå¤´éƒ¨ç»“æ„ (æ›¿æ¢å¼€å§‹)               -->
    <!-- ========================================= -->
    <header id="starry-header">
        <!-- Canvas èƒŒæ™¯å±‚ -->
        <canvas id="starry-canvas"></canvas>
        
        <!-- é»‘è‰²é®ç½© -->
        <div class="overlay"></div>
        
        <!-- é¡¶éƒ¨è¾“å…¥æ¡† - æ›´æ”¹äº¤äº’æ–‡å­— -->
        <div class="header-text-input">
            <input 
                type="text" 
                id="header-text-input" 
                value="MG-MANGO" 
                maxlength="15" 
                placeholder="è¾“å…¥æ–‡å­—"
            />
        </div>
        
        <!-- æ§åˆ¶é¢æ¿ï¼ˆå¯é€‰ï¼Œå³ä¸Šè§’ï¼‰ -->
        <div class="starry-controls" style="display: none;">
            <input type="text" id="starry-text" value="MG-MANGO" maxlength="10" placeholder="è¾“å…¥æ–‡å­—" />
            <div class="control-buttons">
                <button id="toggle-constellations" class="control-btn active">æ˜Ÿåº§</button>
                <button id="toggle-density" class="control-btn">å¯†åº¦</button>
            </div>
        </div>
        
        <!-- æ–‡å­—å†…å®¹ -->
        <div class="header-content">
            <!-- ğŸ‘‡ è¿™é‡Œæ”¹å¤§æ ‡é¢˜ -->
            <h1>
                MG-mango<br>Portfolio.
            </h1>
            
            <!-- ğŸ‘‡ è¿™é‡Œæ”¹å³ä¸‹è§’çš„ä»‹ç» -->
            <div class="intro">
                æ…¢å·¥è‰ºæœ¯.<br>
                å¹³PING & èŠ’æœå°å­.<br>
                æ•°å­—è‰ºæœ¯åˆ›ä½œè€….<br>
                æ¹–åŒ—æ­¦æ±‰.<br>
                ğŸ›°VXï¼šmango130p<br>
            </div>
        </div>
    </header>
    <!-- ========================================= -->
    <!-- âœ… æ–°çš„ç»“æ„ (æ›¿æ¢ç»“æŸ)                    -->
    <!-- ========================================= -->

    <!-- åˆ†ç±»ç­›é€‰å™¨ -->
    <div class="filter-container">
        <div class="filter-buttons">
            <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
            <button class="filter-btn" data-category="åŠ¨ç”»">åŠ¨ç”»</button>
            <button class="filter-btn" data-category="ç»˜ç”»">ç»˜ç”»</button>
            <button class="filter-btn" data-category="äº¤äº’">äº¤äº’</button>
            <button class="filter-btn" data-category="è®¾è®¡">è®¾è®¡</button>
        </div>
    </div>

    <!-- ä½œå“å±•ç¤ºåŒº -->
    <div class="gallery" id="app"></div>

    <script>
        // ========================================================
        // ğŸŒŸ StarryCanvas å®ç°ï¼ˆæ˜Ÿç©ºç²’å­èƒŒæ™¯ï¼‰
        // ========================================================
        
        // é…ç½®å¸¸é‡ - æ€§èƒ½ä¼˜åŒ–ç‰ˆæœ¬
        const STARRY_CONFIG = {
            particleBaseSize: 1.5,  // ä» 1.2 æ”¹ä¸º 1.5ï¼Œè®©ç²’å­æ›´å¤§æ›´æ˜æ˜¾
            assembleSpeed: 0.06,
            friction: 0.92,
            mouseRadius: 120,
            mousePush: 5,
            returnForce: 0.003,
            bgStarCount: 20,  // ä» 30 å‡å°‘åˆ° 20ï¼Œè¿›ä¸€æ­¥é™ä½ GPU æ¶ˆè€—ï¼ˆè§†è§‰å½±å“å¾ˆå°ï¼‰
            colors: [
                '#ffffff', // Pure White
                '#ccebff', // Blue-ish White
                '#ffd9b3', // Warm White
                '#a3b8ff', // Deep Blue
            ]
        };
        
        // Particle ç±»ï¼ˆæ–‡å­—ç²’å­ï¼‰
        class Particle {
            constructor(x, y, canvasWidth, canvasHeight) {
                // æ·»åŠ è½»å¾®éšæœºåç§»ï¼Œé¿å…å®Œç¾åƒç´ ç½‘æ ¼
                this.originX = x + (Math.random() - 0.5) * 2;
                this.originY = y + (Math.random() - 0.5) * 2;
                
                // åˆå§‹éšæœºç”Ÿæˆä½ç½®
                this.x = Math.random() * canvasWidth;
                this.y = Math.random() * canvasHeight;
                
                this.vx = (Math.random() - 0.5) * 1;
                this.vy = (Math.random() - 0.5) * 1;
                
                // ç§»åŠ¨ç«¯ä½¿ç”¨æ›´å°çš„ç²’å­å¤§å°
                const isMobile = window.innerWidth <= 768;
                const baseSize = isMobile ? 0.8 : STARRY_CONFIG.particleBaseSize;  // ç§»åŠ¨ç«¯ä½¿ç”¨ 0.8ï¼Œæ¡Œé¢ç«¯ä½¿ç”¨ 1.5
                this.size = Math.random() * baseSize + (isMobile ? 0.3 : 0.5);  // ç§»åŠ¨ç«¯æœ€å° 0.3ï¼Œæ¡Œé¢ç«¯æœ€å° 0.5
                this.isMobile = isMobile;  // ä¿å­˜ç§»åŠ¨ç«¯æ ‡å¿—ï¼Œä¾› draw æ–¹æ³•ä½¿ç”¨
                
                this.color = STARRY_CONFIG.colors[Math.floor(Math.random() * STARRY_CONFIG.colors.length)];
                
                this.angle = Math.random() * Math.PI * 2;
                this.blinkSpeed = 0.02 + Math.random() * 0.03;
                this.blinkOffset = Math.random() * Math.PI * 2;
            }
            
            update(mouse, width, height) {
                // 1. é¼ æ ‡äº¤äº’
                if (mouse.x != null && mouse.y != null) {
                    const dx = mouse.x - this.x;
                    const dy = mouse.y - this.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < STARRY_CONFIG.mouseRadius) {
                        const forceDirectionX = dx / distance;
                        const forceDirectionY = dy / distance;
                        const force = (STARRY_CONFIG.mouseRadius - distance) / STARRY_CONFIG.mouseRadius;
                        const direction = -1;
                        
                        this.vx += forceDirectionX * force * STARRY_CONFIG.mousePush * direction;
                        this.vy += forceDirectionY * force * STARRY_CONFIG.mousePush * direction;
                    }
                }
                
                // 2. è¿”å›åŸç‚¹
                const dx = this.originX - this.x;
                const dy = this.originY - this.y;
                
                // å‘¼å¸è¿åŠ¨
                const breatheX = Math.cos(Date.now() / 2000 + this.originY * 0.01) * 2.0;
                const breatheY = Math.sin(Date.now() / 2000 + this.originX * 0.01) * 2.0;
                
                this.vx += (dx + breatheX) * STARRY_CONFIG.returnForce;
                this.vy += (dy + breatheY) * STARRY_CONFIG.returnForce;
                
                // 3. æ‘©æ“¦åŠ›
                this.vx *= STARRY_CONFIG.friction;
                this.vy *= STARRY_CONFIG.friction;
                
                this.x += this.vx;
                this.y += this.vy;
            }
            
            draw(ctx) {
                const alpha = 0.5 + 0.5 * Math.abs(Math.sin(Date.now() * 0.001 * this.blinkSpeed + this.blinkOffset));  // ä» 0.3+0.7 æ”¹ä¸º 0.5+0.5ï¼Œæé«˜æœ€ä½äº®åº¦åˆ° 0.5ï¼Œè®©ç²’å­æ›´äº®
                
                ctx.save();
                ctx.globalAlpha = alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                
                // ä¼˜åŒ–ï¼šç¨å¾®é™ä½é˜´å½±æ¨¡ç³Šï¼Œå‡å°‘ GPU æ¶ˆè€—ï¼ˆè§†è§‰å½±å“å¾ˆå°ï¼‰
                ctx.shadowBlur = this.isMobile ? this.size * 1.2 : this.size * 1.5;  // ä» 1.5/2 é™ä½åˆ° 1.2/1.5
                
                ctx.shadowColor = this.color;
                ctx.fill();
                ctx.restore();
            }
        }
        
        // BackgroundStar ç±»ï¼ˆèƒŒæ™¯æ˜Ÿæ˜Ÿï¼‰- æ¢å¤é—ªçƒæ•ˆæœ
        class BackgroundStar {
            constructor(w, h) {
                this.x = Math.random() * w;
                this.y = Math.random() * h;
                this.size = Math.random() * 1.5;  // æ¢å¤åŸå§‹å¤§å°
                this.speed = Math.random() * 0.05 + 0.02;  // æ¢å¤åŸå§‹é€Ÿåº¦
                // ç§»é™¤ç¼“å­˜çš„ alphaï¼Œè®©æ¯å¸§éƒ½é‡æ–°è®¡ç®—ï¼Œäº§ç”Ÿé—ªçƒæ•ˆæœ
            }
            
            update(w, h) {
                this.x -= this.speed;
                if (this.x < 0) this.x = w;
            }
            
            draw(ctx) {
                ctx.save();
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.3 + 0.2})`;  // ä» 0.1-0.4 æ”¹ä¸º 0.2-0.5ï¼Œæé«˜äº®åº¦èŒƒå›´ï¼Œè®©èƒŒæ™¯æ˜Ÿæ˜Ÿæ›´äº®
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.restore();
            }
        }
        
        // StarryCanvas åˆå§‹åŒ–å‡½æ•°
        function initStarryCanvas() {
            const header = document.getElementById('starry-header');
            const canvas = document.getElementById('starry-canvas');
            
            if (!header || !canvas) {
                console.warn('StarryCanvas: header æˆ– canvas å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.warn('StarryCanvas: æ— æ³•è·å– canvas context');
                return;
            }
            
            let particles = [];
            let bgStars = [];
            let mouse = { x: null, y: null };
            let dimensions = { width: 0, height: 0 };
            let animationId = null;
            let text = 'MG-MANGO';
            let showConstellations = true;
            let density = 12;  // ä» 8 æ”¹ä¸º 12ï¼ˆæ›´å¤§çš„å€¼ = æ›´å°‘çš„ç²’å­ï¼Œæå‡æ€§èƒ½ï¼‰
            
            // ç¼“å­˜æ¸æ™•æ•ˆæœï¼ˆåªåœ¨å°ºå¯¸æ”¹å˜æ—¶é‡æ–°åˆ›å»ºï¼Œä¸å½±å“è§†è§‰æ•ˆæœï¼‰
            let cachedGradient = null;
            let cachedGradientSize = { width: 0, height: 0 };
            
            // æ›´æ–°ç²’å­ï¼ˆä»æ–‡å­—ç”Ÿæˆï¼‰
            // æ·»åŠ æ ‡å¿—é˜²æ­¢å¾ªç¯è°ƒç”¨
            let isUpdatingParticles = false;
            let isUpdatingDimensions = false;
            let isResizeObserverDisconnected = false; // è·Ÿè¸ª ResizeObserver æ˜¯å¦å·²æ–­å¼€
            let updateDimensionsDepth = 0; // è·Ÿè¸ªåµŒå¥—è°ƒç”¨æ·±åº¦ï¼Œé˜²æ­¢æ— é™é€’å½’
            
            function updateParticles(providedWidth, providedHeight) {
                // é˜²æ­¢å¾ªç¯è°ƒç”¨
                if (isUpdatingParticles) {
                    console.warn('updateParticles æ­£åœ¨æ‰§è¡Œï¼Œè·³è¿‡é‡å¤è°ƒç”¨');
                    return;
                }
                
                isUpdatingParticles = true;
                
                // å…³é”®ä¿®å¤ï¼šåœ¨ updateParticles æ‰§è¡ŒæœŸé—´ï¼Œè®¾ç½®ä¸€ä¸ªå…¨å±€æ ‡å¿—ï¼Œå®Œå…¨ç¦ç”¨ resize å¤„ç†
                const previousResizeDisabled = window.__starryResizeDisabled || false;
                window.__starryResizeDisabled = true;
                
                try {
                    // ç¡®ä¿ text æœ‰æ•ˆï¼ˆé˜²æ­¢ç©ºå­—ç¬¦ä¸²å¯¼è‡´é—®é¢˜ï¼‰
                    if (!text || text.trim() === '') {
                        text = 'MG-MANGO';
                    }
                    
                    console.log('updateParticles è¢«è°ƒç”¨ï¼Œtext:', text, 'particles.length:', particles.length); // è°ƒè¯•ä¿¡æ¯
                    
                    // å¦‚æœæä¾›äº†å°ºå¯¸å‚æ•°ï¼Œä½¿ç”¨æä¾›çš„å°ºå¯¸ï¼ˆé¿å…è§¦å‘ getBoundingClientRectï¼‰
                    // å¦åˆ™è·å–å®é™…æ˜¾ç¤ºå°ºå¯¸
                    let displayWidth, displayHeight;
                    if (providedWidth && providedHeight) {
                        displayWidth = providedWidth;
                        displayHeight = providedHeight;
                    } else {
                        // å§‹ç»ˆä½¿ç”¨å®é™…æ˜¾ç¤ºå°ºå¯¸ï¼Œç¡®ä¿ Canvas å°ºå¯¸æ­£ç¡®
                        const rect = header.getBoundingClientRect();
                        displayWidth = rect.width;
                        displayHeight = rect.height;
                    }
                
                // å¦‚æœæ— æ³•è·å–å®é™…å°ºå¯¸ï¼Œå°è¯•ä½¿ç”¨ dimensions
                if (displayWidth === 0 || displayHeight === 0) {
                    if (dimensions.width > 0 && dimensions.height > 0) {
                        // ä½¿ç”¨ dimensions ä½œä¸ºå¤‡ç”¨
                        displayWidth = dimensions.width;
                        displayHeight = dimensions.height;
                    } else {
                        // å¦‚æœ dimensions ä¹Ÿæ— æ•ˆï¼Œå»¶è¿Ÿé‡è¯•ï¼ˆå¯èƒ½æ˜¯å…ƒç´ è¿˜æ²¡æ¸²æŸ“å®Œæˆï¼‰
                        // æ³¨æ„ï¼šåœ¨ finally ä¹‹å‰é‡ç½®æ ‡å¿—ï¼Œé¿å…å»¶è¿Ÿè°ƒç”¨æ—¶æ ‡å¿—ä»ä¸º true
                        isUpdatingParticles = false;
                        setTimeout(() => {
                            // å»¶è¿Ÿè°ƒç”¨æ—¶å†æ¬¡æ£€æŸ¥ï¼Œé¿å…é‡å¤è°ƒç”¨
                            if (!isUpdatingParticles) {
                                updateParticles();
                            }
                        }, 50);
                        return;
                    }
                }
                
                // é‡è¦ï¼šä¸è¦åœ¨ updateParticles ä¸­æ›´æ–° dimensionsï¼Œé¿å…è§¦å‘ ResizeObserver å¯¼è‡´å¾ªç¯
                // dimensions åªåœ¨ updateDimensions ä¸­æ›´æ–°
                // dimensions = { width: displayWidth, height: displayHeight }; // å·²åˆ é™¤ï¼Œé¿å…å¾ªç¯
                
                // è®¾ç½® Canvas å†…éƒ¨å°ºå¯¸ï¼ˆå¿…é¡»ä¸æ˜¾ç¤ºå°ºå¯¸å®Œå…¨ä¸€è‡´ï¼‰
                // æ³¨æ„ï¼šå¦‚æœæä¾›äº†å°ºå¯¸å‚æ•°ï¼ˆä» updateDimensions è°ƒç”¨ï¼‰ï¼ŒCanvas å°ºå¯¸å·²ç»æ›´æ–°ï¼Œä¸éœ€è¦å†æ¬¡æ›´æ–°
                // åªæœ‰åœ¨æ²¡æœ‰æä¾›å°ºå¯¸å‚æ•°æ—¶ï¼ˆä»å…¶ä»–äº‹ä»¶è°ƒç”¨ï¼‰ï¼Œæ‰éœ€è¦æ›´æ–° Canvas å°ºå¯¸
                if (!providedWidth || !providedHeight) {
                    // æ³¨æ„ï¼šCanvas çš„ CSS æ˜¯ width: 100%; height: 100%ï¼Œæ‰€ä»¥å†…éƒ¨å°ºå¯¸å¿…é¡»åŒ¹é…æ˜¾ç¤ºå°ºå¯¸
                    // ä½†åªæ›´æ–° Canvas å°ºå¯¸ï¼Œä¸æ›´æ–° dimensionsï¼Œé¿å…è§¦å‘ ResizeObserver
                    if (canvas.width !== displayWidth || canvas.height !== displayHeight) {
                        // å…³é”®ä¿®å¤ï¼šæš‚æ—¶æ–­å¼€ ResizeObserverï¼Œé¿å…æ›´æ–° Canvas å°ºå¯¸æ—¶è§¦å‘å¾ªç¯
                        if (!isResizeObserverDisconnected) {
                            resizeObserver.disconnect();
                            isResizeObserverDisconnected = true;
                        }
                        canvas.width = displayWidth;
                        canvas.height = displayHeight;
                        // ä¸è¦åœ¨è¿™é‡Œé‡è¿ ResizeObserverï¼Œè®© updateDimensions çš„ finally å—ç»Ÿä¸€å¤„ç†
                        // å¦‚æœæ˜¯ä»å…¶ä»–äº‹ä»¶è°ƒç”¨ï¼ˆä¸æ˜¯ä» updateDimensionsï¼‰ï¼Œé‡è¿é€»è¾‘ä¼šåœ¨ finally å—ä¸­å¤„ç†
                    }
                }
                
                // ä½¿ç”¨å®é™…æ˜¾ç¤ºå°ºå¯¸ï¼Œè€Œä¸æ˜¯ dimensionsï¼ˆé¿å…å¾ªç¯ï¼‰
                const width = displayWidth;
                const height = displayHeight;
                
                // éªŒè¯å°ºå¯¸æœ‰æ•ˆæ€§
                if (width <= 0 || height <= 0 || !isFinite(width) || !isFinite(height)) {
                    return;
                }
                
                // è®¡ç®—å®½é«˜æ¯”ï¼Œç”¨äºè‡ªé€‚åº”è°ƒæ•´
                const aspectRatio = width / height;
                const isPortrait = height > width;
                const isUltraWide = aspectRatio > 2.5; // è¶…å®½å±ï¼ˆ21:9ç­‰ï¼‰
                const isSquare = aspectRatio > 0.9 && aspectRatio < 1.1; // æ¥è¿‘æ­£æ–¹å½¢
                
                // æ ¹æ®çª—å£æ¯”ä¾‹è‡ªé€‚åº”æ–‡å­—ä½ç½®
                let textY;
                if (isUltraWide) {
                    textY = height * 0.4; // è¶…å®½å±æ—¶ç¨å¾®ä¸Šç§»
                } else if (isPortrait) {
                    // å…³é”®ä¿®å¤ï¼šç§»åŠ¨ç«¯æ–‡å­—å¾€ä¸Šç§»åŠ¨ï¼Œé¿å…ä¸åº•éƒ¨LOGOé‡å 
                    textY = height * 0.35; // ä» 0.5 æ”¹ä¸º 0.35ï¼Œå¾€ä¸Šç§»åŠ¨ï¼Œé¿å…ä¸LOGOé‡å 
                } else if (isSquare) {
                    textY = height * 0.45; // æ­£æ–¹å½¢
                } else {
                    textY = height * 0.5; // æ ‡å‡†æ¨ªå±
                }
                
                // å­—ä½“å¤§å°è®¡ç®—
                const tempCanvas = document.createElement('canvas');
                // ä¼˜åŒ–ï¼šè®¾ç½® willReadFrequently å±æ€§ï¼Œæé«˜ getImageData æ€§èƒ½
                const tempCtx = tempCanvas.getContext('2d', { willReadFrequently: true });
                if (!tempCtx) return;
                
                // å…³é”®ä¿®å¤ï¼šç¡®ä¿ä¸´æ—¶ Canvas å°ºå¯¸æ­£ç¡®è®¾ç½®
                // Canvas çš„ width å’Œ height å¿…é¡»æ˜¯æ•´æ•°ï¼Œå¦‚æœä¼ å…¥æµ®ç‚¹æ•°ä¼šè¢«è½¬æ¢
                // å‚è€ƒä»£ç ï¼štempCanvas.width = width; tempCanvas.height = height;
                // ä½†æˆ‘ä»¬éœ€è¦ç¡®ä¿ width å’Œ height æ˜¯æ•´æ•°ï¼Œé¿å…æµ®ç‚¹æ•°å¯¼è‡´çš„é‡‡æ ·é—®é¢˜
                const canvasWidth = Math.floor(width);
                const canvasHeight = Math.floor(height);
                tempCanvas.width = canvasWidth;
                tempCanvas.height = canvasHeight;
                
                // å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ•´æ•°å°ºå¯¸è¿›è¡Œæ‰€æœ‰åç»­æ“ä½œ
                // è¿™æ ·å¯ä»¥é¿å…æµ®ç‚¹æ•°å¯¼è‡´çš„é‡‡æ ·é—®é¢˜
                const workingWidth = canvasWidth;
                const workingHeight = canvasHeight;
                
                // æ ¹æ®çª—å£æ¯”ä¾‹è‡ªé€‚åº”åˆå§‹å­—ä½“å¤§å°
                // å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ•´æ•°å°ºå¯¸è®¡ç®—å­—ä½“å¤§å°
                let baseFontSize;
                if (isUltraWide) {
                    baseFontSize = Math.min(workingWidth * 0.12, workingHeight * 0.7); // è¶…å®½å±ï¼šåŸºäºå®½åº¦ï¼Œé™åˆ¶é«˜åº¦
                } else if (isPortrait) {
                    baseFontSize = Math.min(workingWidth * 0.35, workingHeight * 0.3); // ç«–å±ï¼šåŸºäºå®½åº¦
                } else if (isSquare) {
                    baseFontSize = Math.min(workingWidth * 0.3, workingHeight * 0.5); // æ­£æ–¹å½¢ï¼šå¹³è¡¡
                } else {
                    baseFontSize = Math.min(workingWidth * 0.2, workingHeight * 0.55); // æ ‡å‡†æ¨ªå±ï¼šå¹³è¡¡
                }
                
                // ç¡®ä¿ baseFontSize æœ‰æ•ˆ
                if (!isFinite(baseFontSize) || baseFontSize <= 0) {
                    baseFontSize = 400; // é»˜è®¤å€¼
                }
                
                let fontSize = Math.max(100, Math.min(600, Math.floor(baseFontSize))); // é™åˆ¶åœ¨ 100-600 ä¹‹é—´ï¼ˆé™ä½æœ€å°å€¼ï¼‰
                
                // æ˜ç¡®è®¾ç½®å­—ä½“æ ·å¼ï¼Œé˜²æ­¢æ–œä½“
                tempCtx.font = `normal 700 ${fontSize}px 'Helvetica Neue', Helvetica, Arial, sans-serif`;
                
                // æ ¹æ®çª—å£æ¯”ä¾‹è‡ªé€‚åº”ç›®æ ‡å®½åº¦ï¼ˆè¾¹è·ï¼‰
                let targetWidthRatio;
                if (isUltraWide) {
                    targetWidthRatio = 0.65; // è¶…å®½å±ï¼šç•™æ›´å¤šè¾¹è·
                } else if (isPortrait) {
                    // å…³é”®ä¿®å¤ï¼šç§»åŠ¨ç«¯å¢åŠ è¾¹è·ï¼Œä½†ä¸è¦å¤ªå¤š
                    // ä» 0.85 æ”¹ä¸º 0.7ï¼Œå·¦å³å„ 15% è¾¹è·ï¼Œæ¯”åŸæ¥çš„ 7.5% å¢åŠ ä¸€å€
                    targetWidthRatio = 0.7; // å·¦å³å„ 15% è¾¹è·
                } else {
                    targetWidthRatio = 0.75; // æ ‡å‡†ï¼šå¹³è¡¡
                }
                
                const targetWidth = workingWidth * targetWidthRatio;
                let textMetrics = tempCtx.measureText(text);
                
                if (textMetrics.width > targetWidth && textMetrics.width > 0) {
                    fontSize = Math.floor(fontSize * (targetWidth / textMetrics.width));
                }
                
                // æ ¹æ®çª—å£æ¯”ä¾‹è‡ªé€‚åº”æœ€å¤§é«˜åº¦
                let maxHeightRatio;
                if (isUltraWide) {
                    maxHeightRatio = 0.5; // è¶…å®½å±ï¼šé™åˆ¶é«˜åº¦
                } else if (isPortrait) {
                    maxHeightRatio = 0.35; // ç«–å±
                } else {
                    maxHeightRatio = 0.6; // æ ‡å‡†æ¨ªå±
                }
                
                const maxH = workingHeight * maxHeightRatio;
                if (fontSize > maxH) {
                    fontSize = maxH;
                }
                
                // æœ€ç»ˆéªŒè¯ fontSize æœ‰æ•ˆæ€§ï¼ˆç¡®ä¿ä¸ä¼šå¤ªå°ï¼‰
                // å…¨å±æ—¶ï¼ŒCanvas å¯èƒ½å¾ˆå¤§ï¼Œä½†å­—ä½“ä¸èƒ½å¤ªå°ï¼Œå¦åˆ™æ— æ³•é‡‡æ ·åˆ°
                // å…³é”®ä¿®å¤ï¼šç§»åŠ¨ç«¯ä½¿ç”¨æ›´å°çš„é»˜è®¤å€¼ï¼Œé¿å…æ–‡å­—è¶…å‡ºç”»é¢
                const isMobileDevice = window.innerWidth <= 768;
                if (!isFinite(fontSize) || fontSize < 100) {
                    // ç§»åŠ¨ç«¯ä½¿ç”¨æ›´å°çš„é»˜è®¤å€¼ï¼Œé¿å…æ–‡å­—è¶…å‡ºç”»é¢
                    if (isMobileDevice) {
                        fontSize = Math.max(100, Math.min(workingWidth, workingHeight) * 0.15); // ç§»åŠ¨ç«¯ä½¿ç”¨ 15%
                    } else {
                        fontSize = Math.max(200, Math.min(workingWidth, workingHeight) * 0.1); // æ¡Œé¢ç«¯ä½¿ç”¨ 10%
                    }
                    console.warn('å­—ä½“å¤§å°æ— æ•ˆï¼Œä½¿ç”¨é»˜è®¤å€¼:', fontSize, 'width:', workingWidth, 'height:', workingHeight, 'isMobile:', isMobileDevice);
                }
                
                // é‡æ–°è®¾ç½®å­—ä½“ï¼ˆç¡®ä¿ä½¿ç”¨è®¡ç®—åçš„å­—ä½“å¤§å°ï¼Œå¹¶æ˜ç¡®æŒ‡å®š normalï¼‰
                tempCtx.font = `normal 700 ${fontSize}px 'Helvetica Neue', Helvetica, Arial, sans-serif`;
                tempCtx.fillStyle = 'white';
                tempCtx.textAlign = 'center';
                tempCtx.textBaseline = 'middle';
                
                // å…³é”®ä¿®å¤ï¼šç¡®ä¿æ–‡å­—å®½åº¦ä¸ä¼šè¶…å‡º Canvas
                textMetrics = tempCtx.measureText(text);
                const textWidth = textMetrics.width;
                
                // å¦‚æœæ–‡å­—å®½åº¦è¶…å‡º Canvasï¼Œè¿›ä¸€æ­¥ç¼©å°å­—ä½“
                // å…³é”®ä¿®å¤ï¼šç§»åŠ¨ç«¯ä½¿ç”¨ä¸ targetWidthRatio ä¸€è‡´çš„æ¯”ä¾‹
                const maxWidthRatio = isPortrait ? 0.7 : 0.95; // ç§»åŠ¨ç«¯ä½¿ç”¨ 0.7ï¼ˆä¸ targetWidthRatio ä¸€è‡´ï¼‰ï¼Œæ¡Œé¢ç«¯ä½¿ç”¨ 0.95
                if (textWidth > workingWidth * maxWidthRatio) {
                    fontSize = Math.floor(fontSize * (workingWidth * maxWidthRatio / textWidth));
                    tempCtx.font = `normal 700 ${fontSize}px 'Helvetica Neue', Helvetica, Arial, sans-serif`;
                    console.warn('æ–‡å­—å®½åº¦è¶…å‡º Canvasï¼Œç¼©å°å­—ä½“åˆ°:', fontSize, 'textWidth:', textWidth, 'workingWidth:', workingWidth, 'maxWidthRatio:', maxWidthRatio);
                }
                
                // ç¡®ä¿æ–‡å­—ä½ç½®åœ¨ Canvas èŒƒå›´å†…ï¼Œé˜²æ­¢è¶…å‡ºï¼ˆå§‹ç»ˆå±…ä¸­ï¼‰
                const textX = workingWidth / 2; // å§‹ç»ˆæ°´å¹³å±…ä¸­
                const finalTextY = Math.min(Math.max(textY, fontSize / 2), workingHeight - fontSize / 2);
                
                // æ¸…é™¤ä¸´æ—¶ Canvasï¼ˆç¡®ä¿å¹²å‡€ï¼‰
                tempCtx.clearRect(0, 0, workingWidth, workingHeight);
                
                // ç»˜åˆ¶æ–‡å­—
                tempCtx.fillText(text, textX, finalTextY);
                
                // å…³é”®ä¿®å¤ï¼šéªŒè¯æ–‡å­—æ˜¯å¦çœŸçš„è¢«ç»˜åˆ¶äº†ï¼ˆç®€å•æ£€æŸ¥ï¼‰
                // åœ¨æ–‡å­—ä¸­å¿ƒä½ç½®é‡‡æ ·å‡ ä¸ªåƒç´ ï¼Œç¡®ä¿æ–‡å­—è¢«ç»˜åˆ¶
                const checkX = Math.floor(textX);
                const checkY = Math.floor(finalTextY);
                const checkSize = 20; // æ£€æŸ¥ 20x20 çš„åŒºåŸŸ
                const checkData = tempCtx.getImageData(
                    Math.max(0, checkX - checkSize / 2),
                    Math.max(0, checkY - checkSize / 2),
                    Math.min(checkSize, workingWidth - Math.max(0, checkX - checkSize / 2)),
                    Math.min(checkSize, workingHeight - Math.max(0, checkY - checkSize / 2))
                );
                let maxAlphaInCheck = 0;
                for (let i = 3; i < checkData.data.length; i += 4) {
                    if (checkData.data[i] > maxAlphaInCheck) {
                        maxAlphaInCheck = checkData.data[i];
                    }
                }
                
                // å¦‚æœæ–‡å­—ä¸­å¿ƒåŒºåŸŸæ²¡æœ‰åƒç´ ï¼Œè¯´æ˜ç»˜åˆ¶å¤±è´¥
                if (maxAlphaInCheck < 100) {
                    console.error('æ–‡å­—å¯èƒ½æœªæ­£ç¡®ç»˜åˆ¶:', {
                        text, textX, finalTextY, fontSize, 
                        width: workingWidth, height: workingHeight,
                        maxAlpha: maxAlphaInCheck,
                        tempCanvasSize: { width: tempCanvas.width, height: tempCanvas.height }
                    });
                    // å°è¯•é‡æ–°ç»˜åˆ¶ä¸€æ¬¡
                    tempCtx.clearRect(0, 0, workingWidth, workingHeight);
                    tempCtx.font = `normal 700 ${fontSize}px 'Helvetica Neue', Helvetica, Arial, sans-serif`;
                    tempCtx.fillStyle = 'white';
                    tempCtx.textAlign = 'center';
                    tempCtx.textBaseline = 'middle';
                    tempCtx.fillText(text, textX, finalTextY);
                }
                
                // å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ•´æ•°å°ºå¯¸è·å– imageData
                // å‚è€ƒä»£ç ï¼šç›´æ¥ç»˜åˆ¶æ–‡å­—ï¼Œç„¶åç«‹å³é‡‡æ ·ï¼Œç®€å•å¯é 
                const imageData = tempCtx.getImageData(0, 0, workingWidth, workingHeight);
                const data = imageData.data;
                const newParticles = [];
                
                // æ£€æµ‹ç§»åŠ¨ç«¯ï¼Œä½¿ç”¨æ›´å°‘çš„ç²’å­
                const isMobile = window.innerWidth <= 768;
                const qualityFactor = density / 6;  // density = 12 æ—¶ï¼ŒqualityFactor = 2.0
                
                // å‚è€ƒä»£ç çš„æ­¥é•¿è®¡ç®—ï¼šæ›´ç®€å•ç›´æ¥
                // å‚è€ƒä»£ç ï¼šconst step = Math.max(2, Math.floor((fontSize / 35) * qualityFactor));
                const baseStep = fontSize / 35;  // å‚è€ƒä»£ç ä½¿ç”¨ 35ï¼Œè€Œä¸æ˜¯ 50/60
                let step = Math.max(2, Math.floor(baseStep * qualityFactor));  // å‚è€ƒä»£ç çš„æœ€å°å€¼æ˜¯ 2
                
                // ç¡®ä¿ step æœ‰æ•ˆ
                if (!isFinite(step) || step <= 0) {
                    step = 2; // ä½¿ç”¨å‚è€ƒä»£ç çš„æœ€å°å€¼
                }
                
                // å¦‚æœæ­¥é•¿å¤ªå¤§ï¼Œå¼ºåˆ¶é™ä½ï¼ˆç¡®ä¿èƒ½é‡‡æ ·åˆ°æ–‡å­—ï¼‰
                const maxStep = Math.max(2, Math.floor(fontSize / 20)); // ä¿ç•™ä½œä¸ºå®‰å…¨æªæ–½
                if (step > maxStep) {
                    step = maxStep;
                    console.log('æ­¥é•¿è¿‡å¤§ï¼Œå·²é™åˆ¶ä¸º:', step, 'fontSize:', fontSize);
                }
                
                // é‡‡æ ·å‡½æ•° - å‚è€ƒä»£ç çš„é€»è¾‘ï¼šç®€å•ç›´æ¥
                // å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ•´æ•°å°ºå¯¸è¿›è¡Œé‡‡æ ·
                const sampleParticles = (sampleStep, alphaThreshold) => {
                    const particles = [];
                    for (let y = 0; y < workingHeight; y += sampleStep) {
                        for (let x = 0; x < workingWidth; x += sampleStep) {
                            const index = (y * workingWidth + x) * 4;
                            if (data[index + 3] > alphaThreshold) {
                                particles.push(new Particle(x, y, workingWidth, workingHeight));
                            }
                        }
                    }
                    return particles;
                };
                
                // å‚è€ƒä»£ç ä½¿ç”¨å›ºå®šé˜ˆå€¼ 128ï¼Œæ›´å¯é 
                // å‚è€ƒä»£ç ï¼šif (data[index + 3] > 128)
                let sampledParticles = sampleParticles(step, 128); // ä½¿ç”¨å‚è€ƒä»£ç çš„é˜ˆå€¼ 128
                
                // å¦‚æœæœªç”Ÿæˆç²’å­ï¼Œå°è¯•æ›´å°çš„æ­¥é•¿å’Œæ›´ä½çš„é˜ˆå€¼ï¼ˆä¿ç•™é‡è¯•æœºåˆ¶ä½œä¸ºå¤‡ç”¨ï¼‰
                if (sampledParticles.length === 0) {
                    console.warn('ç¬¬ä¸€æ¬¡é‡‡æ ·å¤±è´¥ï¼Œå°è¯•æ›´å°çš„æ­¥é•¿å’Œæ›´ä½çš„é˜ˆå€¼');
                    const smallerStep = Math.max(1, Math.floor(step / 2));
                    sampledParticles = sampleParticles(smallerStep, 100); // é™ä½é˜ˆå€¼åˆ° 100
                    
                    // å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°è¯•æœ€å°æ­¥é•¿å’Œæ›´ä½é˜ˆå€¼
                    if (sampledParticles.length === 0) {
                        console.warn('ç¬¬äºŒæ¬¡é‡‡æ ·å¤±è´¥ï¼Œå°è¯•æœ€å°æ­¥é•¿');
                        sampledParticles = sampleParticles(1, 80); // è¿›ä¸€æ­¥é™ä½é˜ˆå€¼
                        
                        // å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°è¯•æœ€ä½é˜ˆå€¼
                        if (sampledParticles.length === 0) {
                            console.warn('ç¬¬ä¸‰æ¬¡é‡‡æ ·å¤±è´¥ï¼Œå°è¯•æœ€ä½é˜ˆå€¼');
                            sampledParticles = sampleParticles(1, 50); // æœ€ä½é˜ˆå€¼
                        }
                    }
                }
                
                // å°†é‡‡æ ·ç»“æœæ·»åŠ åˆ° newParticles
                newParticles.push(...sampledParticles);
                
                // å¦‚æœæœªç”Ÿæˆç²’å­ï¼Œæ¸…ç©ºç²’å­æ•°ç»„
                if (newParticles.length === 0) {
                    console.error('æœªç”Ÿæˆç²’å­ï¼Œå¯èƒ½æ–‡å­—å¤ªå°æˆ–æ— æ•ˆ:', text, 'fontSize:', fontSize, 'step:', step, 'width:', workingWidth, 'height:', workingHeight);
                    particles = [];
                    return;
                }
                
                console.log('ç”Ÿæˆç²’å­æ•°é‡:', newParticles.length); // è°ƒè¯•ä¿¡æ¯
                
                // é™åˆ¶æœ€å¤§ç²’å­æ•°é‡ï¼ˆç¨å¾®å‡å°‘ï¼Œè§†è§‰å½±å“å¾ˆå°ï¼‰
                if (newParticles.length > 800) {  // ä» 1000 å‡å°‘åˆ° 800
                    const sampleStep = Math.ceil(newParticles.length / 800);
                    const sampledParticles = [];
                    for (let i = 0; i < newParticles.length; i += sampleStep) {
                        sampledParticles.push(newParticles[i]);
                    }
                    particles = sampledParticles.slice(0, 800);
                } else {
                    particles = newParticles;
                }
                } finally {
                    isUpdatingParticles = false;
                    // æ¢å¤ resize å¤„ç†æ ‡å¿—ï¼ˆå»¶è¿Ÿæ¢å¤ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½å·²å®Œæˆï¼‰
                    setTimeout(() => {
                        window.__starryResizeDisabled = previousResizeDisabled;
                    }, 0);
                    
                    // å¦‚æœ ResizeObserver è¢«æ–­å¼€ï¼Œåœ¨ updateParticles æ‰§è¡Œå®Œæ¯•åé‡è¿
                    // ç»Ÿä¸€åœ¨è¿™é‡Œå¤„ç†ï¼Œæ— è®ºæ˜¯ä» updateDimensions è°ƒç”¨è¿˜æ˜¯ä»å…¶ä»–äº‹ä»¶è°ƒç”¨
                    if (isResizeObserverDisconnected) {
                        // ä½¿ç”¨ä¸‰é‡ requestAnimationFrame ç¡®ä¿å®Œå…¨æ‰§è¡Œå®Œæ¯•åå†é‡è¿
                        // ç¬¬ä¸€å±‚ï¼šç­‰å¾…å½“å‰å¸§å®Œæˆ
                        requestAnimationFrame(() => {
                            // ç¬¬äºŒå±‚ï¼šå†ç­‰ä¸€å¸§
                            requestAnimationFrame(() => {
                                // ç¬¬ä¸‰å±‚ï¼šå†ç­‰ä¸€å¸§ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½å·²å®Œæˆ
                                requestAnimationFrame(() => {
                                    // å†æ¬¡æ£€æŸ¥ï¼Œç¡®ä¿æ‰€æœ‰æ›´æ–°éƒ½å·²å®Œæˆ
                                    if (!isUpdatingDimensions && !isUpdatingParticles && isResizeObserverDisconnected) {
                                        resizeObserver.observe(header);
                                        isResizeObserverDisconnected = false;
                                    }
                                });
                            });
                        });
                    }
                }
            }
            
            // åŠ¨ç”»å¾ªç¯ - GPU ä¼˜åŒ–ç‰ˆæœ¬ï¼ˆä¿æŒè§†è§‰æ•ˆæœï¼‰
            let lastFrameTime = 0;
            const targetFPS = 50; // 50fpsï¼ˆè§†è§‰å‡ ä¹æ— å·®å¼‚ï¼Œä½†é™ä½ GPU è´Ÿæ‹…ï¼‰
            const frameInterval = 1000 / targetFPS;
            
            function getGradient(width, height) {
                if (cachedGradient && 
                    cachedGradientSize.width === width && 
                    cachedGradientSize.height === height) {
                    return cachedGradient;
                }
                
                const gradient = ctx.createRadialGradient(
                    width / 2, height / 2, width / 4,
                    width / 2, height / 2, Math.max(width, height)
                );
                gradient.addColorStop(0, 'rgba(0,0,0,0)');
                gradient.addColorStop(1, 'rgba(0,0,0,0.5)');
                
                cachedGradient = gradient;
                cachedGradientSize = { width, height };
                return gradient;
            }
            
            function animate(currentTime) {
                // å¸§ç‡é™åˆ¶ï¼ˆé™ä½ GPU è´Ÿæ‹…ï¼Œä½†ä¿æŒæµç•…ï¼‰
                const elapsed = currentTime - lastFrameTime;
                if (elapsed < frameInterval) {
                    animationId = requestAnimationFrame(animate);
                    return;
                }
                lastFrameTime = currentTime - (elapsed % frameInterval);
                
                // å…³é”®ä¿®å¤ï¼šä½¿ç”¨æ•´æ•°å°ºå¯¸ï¼Œç¡®ä¿ä¸ç²’å­åˆ›å»ºæ—¶çš„å°ºå¯¸ä¸€è‡´
                const canvasWidth = Math.floor(canvas.width);
                const canvasHeight = Math.floor(canvas.height);
                
                // æ¸…é™¤ç”»å¸ƒ
                ctx.fillStyle = 'rgba(0, 0, 0, 1.0)';
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                
                // ä½¿ç”¨ç¼“å­˜çš„æ¸æ™•æ•ˆæœï¼ˆä¸å½±å“è§†è§‰æ•ˆæœï¼‰
                const gradient = getGradient(canvasWidth, canvasHeight);
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                
                // ç»˜åˆ¶èƒŒæ™¯æ˜Ÿæ˜Ÿï¼ˆæ•°é‡å·²å¤§å¹…å‡å°‘ï¼‰
                bgStars.forEach(star => {
                    star.update(canvasWidth, canvasHeight);
                    star.draw(ctx);
                });
                
                // ç»˜åˆ¶å‰æ™¯ç²’å­
                ctx.globalCompositeOperation = 'lighter';
                particles.forEach(p => {
                    p.update(mouse, canvasWidth, canvasHeight);
                    p.draw(ctx);
                });
                
                // æ˜Ÿåº§è¿çº¿ - è¿›ä¸€æ­¥ä¼˜åŒ–ï¼ˆå‡å°‘è®¡ç®—é‡ï¼Œä½†ä¿æŒè¿çº¿æ•ˆæœï¼‰
                if (showConstellations && particles.length > 0) {
                    ctx.strokeStyle = 'rgba(130, 210, 255, 0.15)';
                    ctx.lineWidth = 0.5;
                    ctx.beginPath();
                    
                    const particleCount = particles.length;
                    const lookAhead = Math.min(18, Math.floor(particleCount / 12));  // ä» 10 æ”¹ä¸º 12ï¼Œç¨å¾®å‡å°‘æ£€æŸ¥èŒƒå›´
                    const maxDist = 50;
                    const maxDistSq = maxDist * maxDist;
                    
                    // ç¨å¾®å‡å°‘æ£€æŸ¥é¢‘ç‡
                    const checkInterval = Math.max(1, Math.floor(particleCount / 350));  // ä» 300 æ”¹ä¸º 350
                    
                    for (let i = 0; i < particleCount; i += checkInterval) {
                        const p1 = particles[i];
                        const endJ = Math.min(i + lookAhead, particleCount);
                        
                        for (let j = i + checkInterval; j < endJ; j += checkInterval) {
                            const p2 = particles[j];
                            
                            const dx = p1.x - p2.x;
                            const dy = p1.y - p2.y;
                            
                            if (Math.abs(dx) > maxDist || Math.abs(dy) > maxDist) continue;
                            
                            const distSq = dx * dx + dy * dy;
                            
                            if (distSq < maxDistSq) {
                                if ((i * j + i) % 9 === 0) {  // ä» 8 æ”¹ä¸º 9ï¼Œç¨å¾®å‡å°‘è¿çº¿
                                    ctx.moveTo(p1.x, p1.y);
                                    ctx.lineTo(p2.x, p2.y);
                                }
                            }
                        }
                    }
                    ctx.stroke();
                }
                
                ctx.globalCompositeOperation = 'source-over';
                animationId = requestAnimationFrame(animate);
            }
            
            // é¼ æ ‡/è§¦æ‘¸äº¤äº’
            function getRelativeCoords(clientX, clientY) {
                const rect = canvas.getBoundingClientRect();
                return {
                    x: clientX - rect.left,
                    y: clientY - rect.top
                };
            }
            
            function handleMouseMove(e) {
                mouse = getRelativeCoords(e.clientX, e.clientY);
            }
            
            function handleTouchMove(e) {
                if (e.touches.length > 0) {
                    mouse = getRelativeCoords(e.touches[0].clientX, e.touches[0].clientY);
                }
            }
            
            function handleMouseLeave() {
                mouse = { x: null, y: null };
            }
            
            function handleTouchEnd() {
                mouse = { x: null, y: null };
            }
            
            // ç»Ÿä¸€çš„å°ºå¯¸æ›´æ–°å‡½æ•°
            function updateDimensions() {
                // é˜²æ­¢å¾ªç¯è°ƒç”¨
                if (isUpdatingDimensions) {
                    console.warn('updateDimensions æ­£åœ¨æ‰§è¡Œï¼Œè·³è¿‡é‡å¤è°ƒç”¨');
                    return;
                }
                
                // å…³é”®ä¿®å¤ï¼šæ£€æŸ¥åµŒå¥—æ·±åº¦ï¼Œé˜²æ­¢æ— é™é€’å½’
                if (updateDimensionsDepth > 0) {
                    console.warn('updateDimensions åµŒå¥—è°ƒç”¨ï¼Œæ·±åº¦:', updateDimensionsDepth, 'è·³è¿‡');
                    return;
                }
                
                // å…³é”®ä¿®å¤ï¼šç«‹å³æ–­å¼€ ResizeObserverï¼Œé˜²æ­¢æ–°çš„å›è°ƒè¢«è§¦å‘
                // è¿™å¿…é¡»åœ¨è®¾ç½®ä»»ä½•æ ‡å¿—ä¹‹å‰å®Œæˆï¼Œç¡®ä¿ä¸ä¼šæœ‰æ–°çš„å›è°ƒè¢«è°ƒåº¦
                if (!isResizeObserverDisconnected) {
                    resizeObserver.disconnect();
                    isResizeObserverDisconnected = true;
                }
                
                // å…³é”®ä¿®å¤ï¼šç«‹å³å–æ¶ˆæ‰€æœ‰å¾…å¤„ç†çš„ resize ç›¸å…³çš„ requestAnimationFrame
                // è¿™å¿…é¡»åœ¨è®¾ç½®æ ‡å¿—ä¹‹å‰å®Œæˆï¼Œç¡®ä¿ä¸ä¼šæœ‰å¾…å¤„ç†çš„å›è°ƒæ‰§è¡Œ
                if (resizeRafId) {
                    cancelAnimationFrame(resizeRafId);
                    resizeRafId = null;
                }
                if (resizeTimeout) {
                    cancelAnimationFrame(resizeTimeout);
                    resizeTimeout = null;
                }
                
                updateDimensionsDepth++;
                
                // å…³é”®ä¿®å¤ï¼šç«‹å³è®¾ç½®æ‰€æœ‰æ ‡å¿—ï¼Œé˜²æ­¢æ–°çš„ requestAnimationFrame è¢«è°ƒåº¦
                // å³ä½¿å›è°ƒå·²ç»åœ¨æ‰§è¡Œé˜Ÿåˆ—ä¸­ï¼Œæ ‡å¿—ä¹Ÿå·²ç»è®¾ç½®ï¼Œå›è°ƒä¼šæ£€æŸ¥æ ‡å¿—å¹¶è¿”å›
                isUpdatingDimensions = true;
                window.__starryUpdatingDimensions = true;
                const previousResizeDisabled = window.__starryResizeDisabled || false;
                window.__starryResizeDisabled = true;
                
                try {
                    // ä½¿ç”¨ getBoundingClientRect è·å–å®é™…æ˜¾ç¤ºå°ºå¯¸ï¼Œæ›´å‡†ç¡®
                    const rect = header.getBoundingClientRect();
                    const width = rect.width;
                    const height = rect.height;
                    
                    if (width === 0 || height === 0) return;
                    
                    // å¦‚æœå°ºå¯¸æ²¡æœ‰å˜åŒ–ï¼Œä¸éœ€è¦æ›´æ–°ï¼ˆä½†å…è®¸ä» 0 æ›´æ–°åˆ°å®é™…å°ºå¯¸ï¼‰
                    // ä½¿ç”¨ Math.abs å…è®¸ 1px çš„è¯¯å·®ï¼ˆé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜å’Œå¾®å°å˜åŒ–ï¼‰
                    const widthDiff = Math.abs(dimensions.width - width);
                    const heightDiff = Math.abs(dimensions.height - height);
                    if (widthDiff < 1 && heightDiff < 1 && dimensions.width > 0) {
                        return; // å°ºå¯¸åŸºæœ¬æ²¡å˜åŒ–ï¼Œè·³è¿‡æ›´æ–°
                    }
                    
                    dimensions = { width, height };
                    
                    // æ¸…é™¤æ¸æ™•ç¼“å­˜ï¼ˆå°ºå¯¸æ”¹å˜æ—¶éœ€è¦é‡æ–°åˆ›å»ºï¼‰
                    cachedGradient = null;
                    cachedGradientSize = { width: 0, height: 0 };
                    
                    // æ³¨æ„ï¼šResizeObserver å·²ç»åœ¨ updateDimensions å¼€å§‹æ—¶æ–­å¼€äº†
                    // è¿™é‡Œä¸éœ€è¦å†æ¬¡æ–­å¼€
                    
                    // ç«‹å³æ›´æ–° Canvas å†…éƒ¨å°ºå¯¸ï¼Œç¡®ä¿åŒ¹é…ï¼ˆå…³é”®ï¼šå¿…é¡»åœ¨æ›´æ–°ç²’å­å‰è®¾ç½®ï¼‰
                    canvas.width = width;
                    canvas.height = height;
                    
                    // ä¸è¦åœ¨è¿™é‡Œé‡è¿ ResizeObserverï¼Œè®© finally å—ç»Ÿä¸€å¤„ç†
                    // ç§»é™¤è¿™é‡Œçš„ setTimeout é‡è¿é€»è¾‘ï¼Œé¿å…é‡å¤é‡è¿
                    
                    // é‡æ–°åˆå§‹åŒ–èƒŒæ™¯æ˜Ÿæ˜Ÿ
                    bgStars = [];
                    for (let i = 0; i < STARRY_CONFIG.bgStarCount; i++) {
                        bgStars.push(new BackgroundStar(width, height));
                    }
                    
                    // æ›´æ–°ç²’å­ï¼ˆä¼ å…¥å°ºå¯¸å‚æ•°ï¼Œé¿å…å†æ¬¡è·å– getBoundingClientRectï¼‰
                    updateParticles(width, height);
                } finally {
                    updateDimensionsDepth--;
                    isUpdatingDimensions = false;
                    // æ¸…é™¤ç‰¹æ®Šæ ‡å¿—
                    window.__starryUpdatingDimensions = false;
                    // æ¢å¤ resize å¤„ç†æ ‡å¿—ï¼ˆå»¶è¿Ÿæ¢å¤ï¼Œç¡®ä¿æ‰€æœ‰æ“ä½œéƒ½å·²å®Œæˆï¼‰
                    // æ³¨æ„ï¼šupdateParticles çš„ finally å—ä¹Ÿä¼šæ¢å¤æ ‡å¿—ï¼Œä½†è¿™é‡Œç¡®ä¿åœ¨ updateDimensions å®Œæˆåä¹Ÿæ¢å¤
                    setTimeout(() => {
                        // åªæœ‰åœ¨ updateParticles ä¹Ÿå®Œæˆåæ‰æ¢å¤ï¼ˆé€šè¿‡æ£€æŸ¥ isUpdatingParticlesï¼‰
                        if (!isUpdatingParticles) {
                            window.__starryResizeDisabled = previousResizeDisabled;
                        }
                    }, 0);
                }
            }
            
            // ResizeObserver ç›‘å¬å®¹å™¨å°ºå¯¸
            let resizeRafId = null;
            const resizeObserver = new ResizeObserver((entries) => {
                if (!entries || entries.length === 0) return;
                
                // å…³é”®ä¿®å¤ï¼šåœ¨è°ƒåº¦ requestAnimationFrame ä¹‹å‰å°±æ£€æŸ¥æ‰€æœ‰æ ‡å¿—å’ŒåµŒå¥—æ·±åº¦
                // è¿™æ ·å¯ä»¥é˜²æ­¢åœ¨ updateParticles æ‰§è¡ŒæœŸé—´è°ƒåº¦æ–°çš„ requestAnimationFrame
                if (window.__starryResizeDisabled || window.__starryUpdatingDimensions || isUpdatingDimensions || isUpdatingParticles || updateDimensionsDepth > 0) {
                    if (resizeRafId) {
                        cancelAnimationFrame(resizeRafId);
                        resizeRafId = null;
                    }
                    return;
                }
                
                // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿åœ¨ä¸‹ä¸€å¸§æ›´æ–°ï¼ˆæ›´å¯é ä¸”åŠæ—¶ï¼‰
                if (resizeRafId) {
                    cancelAnimationFrame(resizeRafId);
                }
                resizeRafId = requestAnimationFrame(() => {
                    resizeRafId = null; // ç«‹å³æ¸…ç©ºï¼Œé˜²æ­¢é‡å¤å–æ¶ˆ
                    // å…³é”®ä¿®å¤ï¼šç«‹å³æ£€æŸ¥æ‰€æœ‰æ ‡å¿—å’ŒåµŒå¥—æ·±åº¦ï¼Œå¦‚æœ updateDimensions æ­£åœ¨æ‰§è¡Œï¼Œç›´æ¥è¿”å›
                    // è¿™å¿…é¡»åœ¨ä»»ä½•å…¶ä»–æ“ä½œä¹‹å‰æ£€æŸ¥ï¼Œé˜²æ­¢åœ¨ updateParticles æ‰§è¡ŒæœŸé—´è°ƒç”¨ updateDimensions
                    if (window.__starryUpdatingDimensions || window.__starryResizeDisabled || isUpdatingDimensions || isUpdatingParticles || updateDimensionsDepth > 0) {
                        return;
                    }
                    updateDimensions();
                });
            });
            
            resizeObserver.observe(header);
            
            // æ·»åŠ  window resize äº‹ä»¶ä½œä¸ºå¤‡ç”¨ï¼ˆå¤„ç†å¼€å‘è€…å·¥å…·æ‰“å¼€/å…³é—­ç­‰æƒ…å†µï¼‰
            let resizeTimeout = null;
            function handleWindowResize() {
                // å…³é”®ä¿®å¤ï¼šæ£€æŸ¥æ‰€æœ‰æ ‡å¿—å’ŒåµŒå¥—æ·±åº¦ï¼Œå¦‚æœ resize å¤„ç†è¢«ç¦ç”¨æˆ–æ­£åœ¨æ›´æ–°ï¼Œç›´æ¥è¿”å›
                // åŒæ—¶å–æ¶ˆå¯èƒ½å·²è°ƒåº¦çš„ requestAnimationFrame
                if (window.__starryResizeDisabled || window.__starryUpdatingDimensions || isUpdatingDimensions || isUpdatingParticles || updateDimensionsDepth > 0) {
                    if (resizeTimeout) {
                        cancelAnimationFrame(resizeTimeout);
                        resizeTimeout = null;
                    }
                    return;
                }
                
                // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿åŠæ—¶å“åº”
                if (resizeTimeout) {
                    cancelAnimationFrame(resizeTimeout);
                }
                resizeTimeout = requestAnimationFrame(() => {
                    resizeTimeout = null; // ç«‹å³æ¸…ç©ºï¼Œé˜²æ­¢é‡å¤å–æ¶ˆ
                    // å…³é”®ä¿®å¤ï¼šç«‹å³æ£€æŸ¥æ‰€æœ‰æ ‡å¿—å’ŒåµŒå¥—æ·±åº¦ï¼Œå¦‚æœ updateDimensions æ­£åœ¨æ‰§è¡Œï¼Œç›´æ¥è¿”å›
                    // è¿™å¿…é¡»åœ¨ä»»ä½•å…¶ä»–æ“ä½œä¹‹å‰æ£€æŸ¥ï¼Œé˜²æ­¢åœ¨ updateParticles æ‰§è¡ŒæœŸé—´è°ƒç”¨ updateDimensions
                    if (window.__starryUpdatingDimensions || window.__starryResizeDisabled || isUpdatingDimensions || isUpdatingParticles || updateDimensionsDepth > 0) {
                        return;
                    }
                    updateDimensions();
                });
            }
            
            window.addEventListener('resize', handleWindowResize);
            
            // ç›‘å¬ç§»åŠ¨ç«¯å±å¹•æ—‹è½¬
            window.addEventListener('orientationchange', () => {
                // å±å¹•æ—‹è½¬åéœ€è¦ç­‰å¾…å¸ƒå±€å®Œæˆ
                setTimeout(() => {
                    // æ£€æŸ¥æ‰€æœ‰æ ‡å¿—å’ŒåµŒå¥—æ·±åº¦ï¼Œé¿å…åœ¨æ›´æ–°æœŸé—´è§¦å‘
                    if (!window.__starryUpdatingDimensions && !window.__starryResizeDisabled && !isUpdatingDimensions && !isUpdatingParticles && updateDimensionsDepth === 0) {
                        updateDimensions();
                    }
                }, 100);
            });
            
            // åˆå§‹åŒ–æ—¶å¼ºåˆ¶æ›´æ–°ä¸€æ¬¡å°ºå¯¸ï¼ˆç¡®ä¿é¦–æ¬¡åŠ è½½æ­£ç¡®ï¼‰
            setTimeout(() => {
                updateDimensions();
            }, 100);
            
            // ç»‘å®šäº‹ä»¶
            canvas.addEventListener('mousemove', handleMouseMove);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('mouseleave', handleMouseLeave);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            // å¯åŠ¨åŠ¨ç”»ï¼ˆä½¿ç”¨å¸§ç‡é™åˆ¶ï¼‰
            animate(performance.now());
            
            // æ§åˆ¶é¢æ¿äº‹ä»¶å¤„ç†
            const textInput = document.getElementById('starry-text');
            const headerTextInput = document.getElementById('header-text-input');
            const toggleConstellations = document.getElementById('toggle-constellations');
            const toggleDensity = document.getElementById('toggle-density');
            
            // é¡¶éƒ¨è¾“å…¥æ¡†äº‹ä»¶å¤„ç†
            if (headerTextInput) {
                headerTextInput.addEventListener('input', (e) => {
                    const inputValue = e.target.value.trim();
                    // ç¡®ä¿ text ä¸ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼
                    const newText = inputValue ? inputValue.toUpperCase() : 'MG-MANGO';
                    // åªæœ‰å½“æ–‡å­—çœŸæ­£æ”¹å˜æ—¶æ‰æ›´æ–°
                    if (newText !== text) {
                        text = newText;
                        console.log('è¾“å…¥æ¡†æ–‡å­—æ›´æ–°:', text); // è°ƒè¯•ä¿¡æ¯
                        // ç«‹å³æ›´æ–°ç²’å­
                        updateParticles();
                    }
                    // åŒæ­¥åˆ°æ§åˆ¶é¢æ¿è¾“å…¥æ¡†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                    if (textInput) {
                        textInput.value = text;
                    }
                });
            }
            
            // åŸæœ‰æ§åˆ¶é¢æ¿è¾“å…¥æ¡†ï¼ˆå¦‚æœæ˜¾ç¤ºçš„è¯ï¼‰
            if (textInput) {
                textInput.addEventListener('input', (e) => {
                    const inputValue = e.target.value.trim();
                    // ç¡®ä¿ text ä¸ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™ä½¿ç”¨é»˜è®¤å€¼
                    text = inputValue ? inputValue.toUpperCase() : 'MG-MANGO';
                    // ç«‹å³æ›´æ–°ç²’å­
                    updateParticles();
                    // åŒæ­¥åˆ°é¡¶éƒ¨è¾“å…¥æ¡†
                    if (headerTextInput) {
                        headerTextInput.value = text;
                    }
                });
            }
            
            if (toggleConstellations) {
                toggleConstellations.addEventListener('click', () => {
                    showConstellations = !showConstellations;
                    toggleConstellations.classList.toggle('active');
                });
            }
            
            if (toggleDensity) {
                toggleDensity.addEventListener('click', () => {
                    density = density === 6 ? 10 : 6;
                    toggleDensity.textContent = density === 6 ? 'HIGH' : 'LOW';
                    toggleDensity.classList.toggle('active');
                    updateParticles();
                });
            }
        }
        
        // ========================================================
        // ğŸ¬ è§†é¢‘æ’­æ”¾æ§åˆ¶å‡½æ•°ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
        // ========================================================
        
        // è°ƒè¯•æ¨¡å¼æ ‡å¿—ï¼ˆç”Ÿäº§ç¯å¢ƒè®¾ä¸º falseï¼‰
        const DEBUG = true;
        
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(...args) {
            if (DEBUG) console.log(...args);
        }
        
        function debugError(...args) {
            if (DEBUG) console.error(...args);
        }
        
        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
        function isMobileDevice() {
            return window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // ç”Ÿæˆå°é¢å›¾è·¯å¾„
        function getCoverImagePath(videoFile, coverFile, assetPath) {
            // å¦‚æœ JSON ä¸­æŒ‡å®šäº†å°é¢å›¾ï¼Œç›´æ¥ä½¿ç”¨
            if (coverFile && coverFile.trim() !== '') {
                return assetPath + coverFile;
            }
            
            // å¦åˆ™ä»è§†é¢‘æ–‡ä»¶åç”Ÿæˆå°é¢å›¾è·¯å¾„
            // æ”¯æŒå¤šç§æ ¼å¼ï¼šdemo_video.mp4 -> demo_video.jpg / demo_video_cover.jpg / demo_video.png
            const baseName = videoFile.replace(/\.[^/.]+$/, ''); // å»æ‰æ‰©å±•å
            
            // å°è¯•å¸¸è§çš„å°é¢å›¾å‘½åè§„åˆ™
            // ä¼˜å…ˆï¼šåŸæ–‡ä»¶å + _cover.jpg
            // å…¶æ¬¡ï¼šåŸæ–‡ä»¶å + .jpg
            return assetPath + baseName + '_cover.jpg';
        }
        
        // åŠ è½½å¹¶æ’­æ”¾è§†é¢‘ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ– - ç‚¹å‡»ååŠ è½½ï¼‰
        function loadAndPlayVideo(videoId, videoSrc, placeholderId) {
            const video = document.getElementById(videoId);
            const placeholder = placeholderId ? document.getElementById(placeholderId) : null;
            
            if (!video) {
                debugError('è§†é¢‘å…ƒç´ ä¸å­˜åœ¨:', videoId);
                return;
            }
            
            // å¦‚æœè§†é¢‘æ­£åœ¨åŠ è½½æˆ–æ’­æ”¾ï¼Œç›´æ¥è¿”å›
            if (video.classList.contains('loading') || (!video.paused && video.readyState >= 2)) {
                return;
            }
            
            // å¦‚æœè§†é¢‘è¿˜æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½è§†é¢‘æº
            const currentSrc = video.src || video.getAttribute('src') || '';
            if (!currentSrc || currentSrc !== videoSrc) {
                // æ ‡è®°ä¸ºåŠ è½½ä¸­
                video.classList.add('loading');
                
                // æ˜¾ç¤ºåŠ è½½æç¤ºï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
                if (placeholder) {
                    let loadingDiv = placeholder.querySelector('.video-loading');
                    if (!loadingDiv) {
                        loadingDiv = document.createElement('div');
                        loadingDiv.className = 'video-loading';
                        loadingDiv.textContent = 'åŠ è½½ä¸­...';
                        placeholder.appendChild(loadingDiv);
                    } else {
                        loadingDiv.textContent = 'åŠ è½½ä¸­...';
                        loadingDiv.style.display = 'block';
                    }
                    // éšè—æ’­æ”¾æŒ‰é’®
                    const playBtn = placeholder.querySelector('.play-button-large');
                    if (playBtn) {
                        playBtn.style.display = 'none';
                    }
                    placeholder.style.display = 'flex';
                }
                
                // è®¾ç½®è§†é¢‘æºå¹¶åŠ è½½
                video.setAttribute('src', videoSrc);
                video.load();
                
                // ç­‰å¾…è§†é¢‘å¯ä»¥æ’­æ”¾ï¼ˆcanplay æ¯” loadeddata æ›´å¥½ï¼Œç¡®ä¿å¯ä»¥æ’­æ”¾ï¼‰
                const onCanPlay = function() {
                    video.classList.remove('loading');
                    video.classList.add('playing');
                    
                    if (placeholder) {
                        const loadingDiv = placeholder.querySelector('.video-loading');
                        if (loadingDiv) {
                            loadingDiv.remove();
                        }
                        // éšè—å°é¢å›¾
                        const coverImg = placeholder.querySelector('.video-cover');
                        if (coverImg) {
                            coverImg.style.display = 'none';
                        }
                        placeholder.style.display = 'none';
                    }
                    video.style.display = 'block';
                    
                    // å¼€å§‹æ’­æ”¾
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            debugLog('è§†é¢‘æ’­æ”¾æˆåŠŸ');
                        }).catch(err => {
                            debugLog('æ’­æ”¾å¤±è´¥:', err);
                            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºæ’­æ”¾æŒ‰é’®
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                            const playBtn = placeholder.querySelector('.play-button-large');
                            if (playBtn) {
                                playBtn.style.display = 'flex';
                            }
                        }
                    });
                    }
                };
                
                video.addEventListener('canplay', onCanPlay, { once: true });
                
                // ä¹Ÿç›‘å¬ loadeddata ä½œä¸ºå¤‡é€‰
                const onLoadedData = function() {
                    if (video.readyState >= 2 && !video.classList.contains('playing')) {
                        // å¦‚æœ canplay è¿˜æ²¡è§¦å‘ï¼Œç­‰å¾…ä¸€ä¸‹
                        setTimeout(() => {
                            if (!video.classList.contains('playing') && video.readyState >= 2) {
                                onCanPlay();
                            }
                        }, 100);
                    }
                };
                video.addEventListener('loadeddata', onLoadedData, { once: true });
                
                // é”™è¯¯å¤„ç†
                const onError = function(e) {
                    debugError('è§†é¢‘åŠ è½½é”™è¯¯:', e, videoSrc);
                    video.classList.remove('loading');
                    if (placeholder) {
                        const loadingDiv = placeholder.querySelector('.video-loading');
                        if (loadingDiv) {
                            loadingDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                        } else {
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'video-loading';
                            errorDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                            placeholder.appendChild(errorDiv);
                        }
                        const playBtn = placeholder.querySelector('.play-button-large');
                        if (playBtn) {
                            playBtn.style.display = 'flex';
                        }
                        placeholder.style.display = 'flex';
                    }
                    // æ¸…é™¤é”™è¯¯çš„ src
                    video.removeAttribute('src');
                    video.load();
                };
                
                video.addEventListener('error', onError, { once: true });
            } else {
                // è§†é¢‘å·²åŠ è½½ï¼Œç›´æ¥æ’­æ”¾
                if (placeholder) {
                    // éšè—å°é¢å›¾
                    const coverImg = placeholder.querySelector('.video-cover');
                    if (coverImg) {
                        coverImg.style.display = 'none';
                    }
                    placeholder.style.display = 'none';
                }
                video.style.display = 'block';
                video.classList.add('playing');
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => {
                        debugLog('æ’­æ”¾å¤±è´¥:', err);
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                            const coverImg = placeholder.querySelector('.video-cover');
                            if (coverImg) {
                                coverImg.style.display = 'block';
                            }
                        }
                    });
                }
            }
        }
        
        // ========================================================
        // ğŸ”§ å·¥å…·å‡½æ•°ï¼šè§†é¢‘é«˜åº¦è®¡ç®—
        // ========================================================
        function calculateVideoHeight(video, container, placeholder, coverImg) {
            let targetHeight = 0;
            
            // ä¼˜å…ˆä½¿ç”¨è§†é¢‘çš„åŸå§‹é«˜åº¦ï¼Œå¹¶æ ¹æ®å®¹å™¨å®½åº¦è®¡ç®—æ˜¾ç¤ºé«˜åº¦ï¼ˆä¿æŒå®½é«˜æ¯”ï¼‰
            if (video.videoHeight > 0 && video.videoWidth > 0) {
                const containerWidth = container ? (container.offsetWidth || container.clientWidth) : window.innerWidth;
                const aspectRatio = video.videoHeight / video.videoWidth;
                targetHeight = containerWidth * aspectRatio;
                debugLog('ä½¿ç”¨è§†é¢‘åŸå§‹å°ºå¯¸:', video.videoWidth, 'x', video.videoHeight, 'å®½é«˜æ¯”:', aspectRatio, 'å®¹å™¨å®½åº¦:', containerWidth, 'è®¡ç®—é«˜åº¦:', targetHeight);
            }
            
            // å¦‚æœè§†é¢‘é«˜åº¦ä¸å¯ç”¨ï¼Œä½¿ç”¨å°é¢å›¾ç‰‡é«˜åº¦
            if (!targetHeight || targetHeight === 0) {
                if (coverImg) {
                    const imgHeight = coverImg.offsetHeight || coverImg.naturalHeight;
                    if (imgHeight > 0) {
                        targetHeight = imgHeight;
                        debugLog('ä½¿ç”¨å°é¢å›¾ç‰‡é«˜åº¦:', targetHeight);
                    }
                }
            }
            
            // å¦‚æœä»ç„¶æ²¡æœ‰é«˜åº¦ï¼Œä½¿ç”¨å ä½ç¬¦æˆ–å®¹å™¨é«˜åº¦
            if (!targetHeight || targetHeight === 0) {
                targetHeight = placeholder.offsetHeight || (container ? container.offsetHeight : 300);
                debugLog('ä½¿ç”¨å ä½ç¬¦/å®¹å™¨é«˜åº¦:', targetHeight);
            }
            
            debugLog('æœ€ç»ˆé«˜åº¦:', targetHeight, 'è§†é¢‘å°ºå¯¸:', video.videoWidth + 'x' + video.videoHeight, 'å°é¢å›¾ç‰‡é«˜åº¦:', coverImg ? (coverImg.offsetHeight || coverImg.naturalHeight) : 'æ— ');
            return targetHeight;
        }
        
        // ========================================================
        // ğŸ”§ å·¥å…·å‡½æ•°ï¼šæ·¡å…¥æ·¡å‡ºè¿‡æ¸¡
        // ========================================================
        function fadeInVideo(video, placeholder, container, targetHeight) {
            // å¼ºåˆ¶ä¼˜å…ˆä½¿ç”¨å ä½ç¬¦çš„å½“å‰å®é™…æ˜¾ç¤ºé«˜åº¦ï¼ˆå ä½ç¬¦å·²ç»åŒ…å«äº†å°é¢å›¾ï¼‰
            // è¿™æ˜¯æœ€å¯é çš„æ–¹æ³•ï¼Œå› ä¸ºå ä½ç¬¦çš„é«˜åº¦å°±æ˜¯å°é¢å›¾çš„å®é™…æ˜¾ç¤ºé«˜åº¦
            let finalHeight = 0;
            
            // ä¼˜å…ˆä½¿ç”¨å°é¢å›¾çš„å½“å‰æ˜¾ç¤ºé«˜åº¦ï¼ˆç¡®ä¿ä¸å°é¢å›¾ä¿æŒä¸€è‡´ï¼‰
            const coverImg = placeholder.querySelector('.video-cover');
            if (coverImg) {
                let coverCurrentHeight = coverImg.offsetHeight || coverImg.clientHeight;
                
                // å¦‚æœ offsetHeight ä¸å¯ç”¨ï¼Œä½¿ç”¨ getBoundingClientRect è·å–å°é¢å›¾çš„å®é™…æ˜¾ç¤ºå°ºå¯¸
                if (!coverCurrentHeight || coverCurrentHeight === 0) {
                    const coverRect = coverImg.getBoundingClientRect();
                    coverCurrentHeight = coverRect.height;
                }
                
                // å¦‚æœä»ç„¶ä¸º0ï¼Œä½¿ç”¨å°é¢å›¾çš„æ˜¾ç¤ºå®½åº¦å’Œå®½é«˜æ¯”è®¡ç®—
                if (!coverCurrentHeight || coverCurrentHeight === 0) {
                    const coverRect = coverImg.getBoundingClientRect();
                    const coverDisplayWidth = coverRect.width || coverImg.offsetWidth || (container ? container.offsetWidth : 0);
                    if (coverDisplayWidth > 0 && coverImg.naturalHeight > 0 && coverImg.naturalWidth > 0) {
                        const aspectRatio = coverImg.naturalHeight / coverImg.naturalWidth;
                        coverCurrentHeight = coverDisplayWidth * aspectRatio;
                        debugLog('ä½¿ç”¨å°é¢å›¾æ˜¾ç¤ºå®½åº¦è®¡ç®—é«˜åº¦:', coverCurrentHeight, 'æ˜¾ç¤ºå®½åº¦:', coverDisplayWidth, 'åŸå§‹å°ºå¯¸:', coverImg.naturalWidth + 'x' + coverImg.naturalHeight);
                    } else if (coverImg.naturalHeight > 0 && coverImg.naturalWidth > 0) {
                        // æœ€åå¤‡é€‰ï¼šä½¿ç”¨å®¹å™¨å®½åº¦å’Œå®½é«˜æ¯”è®¡ç®—
                        const containerWidth = container ? (container.offsetWidth || container.clientWidth) : window.innerWidth;
                        const aspectRatio = coverImg.naturalHeight / coverImg.naturalWidth;
                        coverCurrentHeight = containerWidth * aspectRatio;
                        debugLog('ä½¿ç”¨å®¹å™¨å®½åº¦è®¡ç®—é«˜åº¦ï¼ˆå¤‡é€‰ï¼‰:', coverCurrentHeight, 'å®¹å™¨å®½åº¦:', containerWidth);
                    }
                }
                
                if (coverCurrentHeight > 0) {
                    finalHeight = coverCurrentHeight;
                    debugLog('fadeInVideo: ä½¿ç”¨å°é¢å›¾å½“å‰é«˜åº¦:', finalHeight);
                }
            }
            
            // å¦‚æœå°é¢å›¾é«˜åº¦ä¸å¯ç”¨ï¼Œä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦ï¼ˆä½œä¸ºåå¤‡ï¼‰
            if (!finalHeight || finalHeight === 0) {
                const savedHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                if (savedHeight > 0) {
                    finalHeight = savedHeight;
                    debugLog('fadeInVideo: ä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦ï¼ˆåå¤‡ï¼‰:', finalHeight);
                }
            }
            
            // å¦‚æœä¿å­˜çš„é«˜åº¦ä¹Ÿä¸å¯ç”¨ï¼Œä½¿ç”¨å ä½ç¬¦çš„å½“å‰é«˜åº¦ï¼ˆåœ¨æ”¹å˜å®šä½ä¹‹å‰è·å–ï¼‰
            if (!finalHeight || finalHeight === 0) {
                let placeholderCurrentHeight = placeholder.offsetHeight || placeholder.clientHeight;
                
                // å¦‚æœ offsetHeight ä¸º0ï¼Œä½¿ç”¨ getBoundingClientRect è·å–å®é™…æ¸²æŸ“é«˜åº¦
                if (!placeholderCurrentHeight || placeholderCurrentHeight === 0) {
                    const rect = placeholder.getBoundingClientRect();
                    placeholderCurrentHeight = rect.height;
                    debugLog('fadeInVideo: ä½¿ç”¨ getBoundingClientRect è·å–å ä½ç¬¦é«˜åº¦:', placeholderCurrentHeight);
                }
                
                if (placeholderCurrentHeight > 0) {
                    finalHeight = placeholderCurrentHeight;
                    debugLog('fadeInVideo: ä½¿ç”¨å ä½ç¬¦å½“å‰é«˜åº¦:', finalHeight, 'è®¡ç®—é«˜åº¦:', targetHeight);
                }
            }
            
            // å¦‚æœä»ç„¶æ²¡æœ‰é«˜åº¦ï¼Œä½¿ç”¨ä¼ å…¥çš„ targetHeight
            if (!finalHeight || finalHeight === 0) {
                finalHeight = targetHeight || 300;
                debugLog('ä½¿ç”¨è®¡ç®—é«˜åº¦:', finalHeight);
            }
            
            // å…ˆè®¾ç½®å®¹å™¨é«˜åº¦ï¼Œé˜²æ­¢å¡Œé™·ï¼ˆå¿…é¡»åœ¨æ”¹å˜å ä½ç¬¦ä½ç½®ä¹‹å‰ï¼‰
            if (container && finalHeight > 0) {
                // åœ¨ç§»åŠ¨ç«¯ï¼Œcontainer å°±æ˜¯ .media-boxï¼Œæ‰€ä»¥éœ€è¦åŒæ—¶è®¾ç½®
                container.style.height = finalHeight + 'px';
                container.style.minHeight = finalHeight + 'px';
                container.style.maxHeight = finalHeight + 'px'; // æ·»åŠ æœ€å¤§é«˜åº¦é™åˆ¶ï¼Œé˜²æ­¢ç¼©å°
                container.style.position = 'relative'; // ç¡®ä¿å®¹å™¨æ˜¯å®šä½ä¸Šä¸‹æ–‡
                
                // å¦‚æœå®¹å™¨æœ‰ .media-box çˆ¶å…ƒç´ ï¼Œä¹Ÿè®¾ç½®å…¶é«˜åº¦ï¼ˆç§»åŠ¨ç«¯ container å°±æ˜¯ .media-boxï¼‰
                const mediaBox = container.closest('.media-box');
                if (mediaBox && mediaBox !== container) {
                    mediaBox.style.height = finalHeight + 'px';
                    mediaBox.style.minHeight = finalHeight + 'px';
                    mediaBox.style.maxHeight = finalHeight + 'px';
                }
            }
            
            // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿å®¹å™¨é«˜åº¦å·²è¢«æµè§ˆå™¨åº”ç”¨
            // ç„¶åå†æ”¹å˜å ä½ç¬¦ä½ç½®ï¼Œé¿å…ç¼©å°
            requestAnimationFrame(() => {
                // å†æ¬¡ç¡®è®¤å¹¶è®¾ç½®å®¹å™¨é«˜åº¦ï¼Œç¡®ä¿é«˜åº¦è¢«æ­£ç¡®åº”ç”¨
                if (container && finalHeight > 0) {
                    container.style.height = finalHeight + 'px';
                    container.style.minHeight = finalHeight + 'px';
                    container.style.maxHeight = finalHeight + 'px';
                    
                    // å¦‚æœå®¹å™¨æœ‰ .media-box çˆ¶å…ƒç´ ï¼Œä¹Ÿè®¾ç½®å…¶é«˜åº¦ï¼ˆç§»åŠ¨ç«¯ container å°±æ˜¯ .media-boxï¼‰
                    const mediaBox = container.closest('.media-box');
                    if (mediaBox && mediaBox !== container) {
                        mediaBox.style.height = finalHeight + 'px';
                        mediaBox.style.minHeight = finalHeight + 'px';
                        mediaBox.style.maxHeight = finalHeight + 'px';
                    }
                    
                    // å¼ºåˆ¶æµè§ˆå™¨åº”ç”¨å®¹å™¨é«˜åº¦æ ·å¼ï¼ˆé€šè¿‡è¯»å– offsetHeight è§¦å‘é‡æ’ï¼‰
                    void container.offsetHeight;
                }
                
                // å…ˆè®©å ä½ç¬¦æ”¹ä¸ºç»å¯¹å®šä½ï¼Œå‡†å¤‡æ·¡å‡ºï¼ˆä¿æŒå½“å‰é«˜åº¦ï¼‰
                // åœ¨æ”¹å˜ä½ç½®ä¹‹å‰ï¼Œå…ˆè®¾ç½®é«˜åº¦ï¼Œç¡®ä¿é«˜åº¦ä¸ä¼šä¸¢å¤±
                placeholder.style.height = finalHeight + 'px';
                placeholder.style.minHeight = finalHeight + 'px';
                placeholder.style.maxHeight = finalHeight + 'px';
                placeholder.style.position = 'absolute';
                placeholder.style.top = '0';
                placeholder.style.left = '0';
                placeholder.style.width = '100%';
                placeholder.style.pointerEvents = 'none';
                // ä½¿ç”¨æ›´å¹³æ»‘çš„ç¼“åŠ¨å‡½æ•°å’Œæ›´é•¿çš„è¿‡æ¸¡æ—¶é—´ï¼ˆ0.7s cubic-bezierï¼‰
                placeholder.style.transition = 'opacity 0.7s cubic-bezier(0.4, 0, 0.2, 1)';
                
                // è®¾ç½®è§†é¢‘å…ƒç´ çš„é«˜åº¦å’Œä½ç½®ï¼Œåˆå§‹é€æ˜åº¦ä¸º0ï¼ˆå‡†å¤‡æ·¡å…¥ï¼Œä½¿ç”¨ç›¸åŒé«˜åº¦ï¼‰
                video.style.position = 'absolute';
                video.style.top = '0';
                video.style.left = '0';
                video.style.width = '100%';
                video.style.height = finalHeight + 'px';
                video.style.minHeight = finalHeight + 'px'; // æ·»åŠ æœ€å°é«˜åº¦é™åˆ¶
                video.style.maxHeight = finalHeight + 'px'; // æ·»åŠ æœ€å¤§é«˜åº¦é™åˆ¶ï¼Œé˜²æ­¢ç¼©å°
                video.style.display = 'block';
                video.style.zIndex = '11';
                video.style.opacity = '0';
                // ä½¿ç”¨æ›´å¹³æ»‘çš„ç¼“åŠ¨å‡½æ•°å’Œæ›´é•¿çš„è¿‡æ¸¡æ—¶é—´ï¼ˆ0.7s cubic-bezierï¼‰
                video.style.transition = 'opacity 0.7s cubic-bezier(0.4, 0, 0.2, 1)';
                video.classList.add('playing');
                
                // å¼ºåˆ¶æµè§ˆå™¨åº”ç”¨æ‰€æœ‰æ ·å¼ï¼ˆé€šè¿‡è¯»å– offsetHeight è§¦å‘é‡æ’ï¼‰
                void placeholder.offsetHeight;
                void video.offsetHeight;
                
                // ç¡®ä¿è§†é¢‘å®Œå…¨å‡†å¤‡å¥½åå†å¼€å§‹æ·¡å…¥æ·¡å‡º
                // ä½¿ç”¨ requestAnimationFrame ç¡®ä¿æ ·å¼å·²åº”ç”¨ï¼Œç„¶åè§¦å‘äº¤å‰æ·¡å…¥æ·¡å‡º
                requestAnimationFrame(() => {
                    requestAnimationFrame(() => {
                        // å†ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿è§†é¢‘å¸§å·²å‡†å¤‡å¥½
                        setTimeout(() => {
                            // åŒæ—¶è§¦å‘å ä½ç¬¦æ·¡å‡ºå’Œè§†é¢‘æ·¡å…¥
                            placeholder.style.opacity = '0';
                            video.style.opacity = '1';
                        }, 50); // 50ms å»¶è¿Ÿç¡®ä¿è§†é¢‘å¸§å‡†å¤‡å¥½
                    });
                });
            });
        }
        
        // ========================================================
        // ğŸ”§ å·¥å…·å‡½æ•°ï¼šæ¢å¤è§†é¢‘çŠ¶æ€ï¼ˆé”™è¯¯å¤„ç†ï¼‰
        // ========================================================
        function resetVideoState(video, placeholder, container) {
            // æ¢å¤è§†é¢‘æ ·å¼
            video.style.display = 'none';
            video.style.position = '';
            video.style.top = '';
            video.style.left = '';
            video.style.width = '';
            video.style.height = '';
            video.style.minHeight = '';
            video.style.maxHeight = '';
            video.style.opacity = '';
            video.style.transition = '';
            video.classList.remove('playing');
            
            // æ¢å¤å®¹å™¨é«˜åº¦å’Œæ ·å¼
            if (container) {
                container.style.height = '';
                container.style.minHeight = '';
                container.style.maxHeight = '';
                container.style.position = '';
                
                // æ¢å¤ .media-box çš„é«˜åº¦ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
                const mediaBox = container.closest('.media-box');
                if (mediaBox && mediaBox !== container) {
                    mediaBox.style.height = '';
                    mediaBox.style.minHeight = '';
                    mediaBox.style.maxHeight = '';
                }
            }
            
            // æ¢å¤å ä½ç¬¦æ ·å¼
            placeholder.style.position = 'relative';
            placeholder.style.width = '100%';
            placeholder.style.height = 'auto';
            placeholder.style.minHeight = '';
            placeholder.style.maxHeight = '';
            placeholder.style.opacity = '1';
            placeholder.style.pointerEvents = 'auto';
            placeholder.style.display = 'block';
            placeholder.style.transition = '';
            
            // æ¸…é™¤ä¿å­˜çš„é«˜åº¦æ•°æ®
            if (placeholder.dataset.savedHeight) {
                delete placeholder.dataset.savedHeight;
            }
        }
        
        // ========================================================
        // ğŸ¬ ç§»åŠ¨ç«¯è§†é¢‘ç‚¹å‡»æ’­æ”¾å‡½æ•°
        // ========================================================
        function handleMobileVideoClick(videoId, videoSrc, placeholderId) {
            debugLog('ç‚¹å‡»æ’­æ”¾è§†é¢‘:', videoId, videoSrc);
            const video = document.getElementById(videoId);
            const placeholder = document.getElementById(placeholderId);
            
            if (!video || !placeholder) {
                debugError('æ‰¾ä¸åˆ°è§†é¢‘æˆ–å ä½ç¬¦:', { videoId, placeholderId });
                return;
            }
            
            // å¦‚æœè§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œä¸åšä»»ä½•æ“ä½œ
            if (!video.paused && video.readyState >= 2) {
                debugLog('è§†é¢‘å·²åœ¨æ’­æ”¾ï¼Œè·³è¿‡');
                return;
            }
            
            // ç¼“å­˜å¸¸ç”¨å…ƒç´ ï¼Œé¿å…é‡å¤æŸ¥è¯¢
            const container = placeholder.closest('.video-container');
            const coverImg = placeholder.querySelector('.video-cover');
            
            // æ·»åŠ ç‚¹å‡»æ ‡è®°ï¼Œè®©å°é¢å›¾å˜ä¸ºå½©è‰²
            placeholder.classList.add('clicked');
            
            // ç«‹å³ä¿å­˜å ä½ç¬¦å’Œå°é¢å›¾çš„å½“å‰é«˜åº¦ï¼ˆåœ¨æ”¹å˜ä»»ä½•æ ·å¼ä¹‹å‰ï¼‰
            // ä½¿ç”¨ data å±æ€§ä¿å­˜ï¼Œç¡®ä¿åç»­å¯ä»¥è·å–
            const placeholderHeight = placeholder.offsetHeight || placeholder.clientHeight;
            const placeholderRect = placeholder.getBoundingClientRect();
            const savedHeight = placeholderRect.height > 0 ? placeholderRect.height : placeholderHeight;
            
            // coverImg å·²åœ¨ä¸Šé¢å£°æ˜ï¼Œç›´æ¥ä½¿ç”¨
            let savedCoverHeight = 0;
            if (coverImg) {
                savedCoverHeight = coverImg.offsetHeight || coverImg.clientHeight;
                if (!savedCoverHeight || savedCoverHeight === 0) {
                    const coverRect = coverImg.getBoundingClientRect();
                    savedCoverHeight = coverRect.height;
                }
                // å¦‚æœä»ç„¶ä¸º0ï¼Œä½¿ç”¨ naturalHeightï¼ˆå¦‚æœå›¾ç‰‡å·²åŠ è½½ï¼‰
                if (!savedCoverHeight && coverImg.complete && coverImg.naturalHeight > 0) {
                    const coverRect = coverImg.getBoundingClientRect();
                    const coverWidth = coverRect.width || coverImg.offsetWidth || (container ? container.offsetWidth : 0);
                    if (coverWidth > 0 && coverImg.naturalWidth > 0) {
                        const aspectRatio = coverImg.naturalHeight / coverImg.naturalWidth;
                        savedCoverHeight = coverWidth * aspectRatio;
                    }
                }
            }
            
            // ä¿å­˜åˆ°å ä½ç¬¦çš„ data å±æ€§ä¸­
            const finalSavedHeight = savedCoverHeight > 0 ? savedCoverHeight : (savedHeight > 0 ? savedHeight : 0);
            if (finalSavedHeight > 0) {
                placeholder.dataset.savedHeight = finalSavedHeight.toString();
                debugLog('ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦:', finalSavedHeight, 'å ä½ç¬¦é«˜åº¦:', savedHeight, 'å°é¢å›¾é«˜åº¦:', savedCoverHeight);
            }
            
            // ä¸æ˜¾ç¤ºåŠ è½½æç¤ºï¼Œå°é¢å›¾ä¿æŒå¯è§ç›´åˆ°è§†é¢‘åŠ è½½å®Œæˆ
            // ç¡®ä¿å°é¢å›¾å¯è§ä¸”å¯ç‚¹å‡»çŠ¶æ€
            placeholder.style.opacity = '1';
            placeholder.style.pointerEvents = 'auto';
            
            // è®¾ç½®è§†é¢‘æºå¹¶åŠ è½½
            if (!video.src || video.src !== videoSrc) {
                debugLog('è®¾ç½®è§†é¢‘æº:', videoSrc);
                video.src = videoSrc;
                video.load();
                
                // æ·»åŠ é”™è¯¯å¤„ç†
                const onError = function(e) {
                    debugError('è§†é¢‘åŠ è½½é”™è¯¯:', e, videoSrc);
                    video.removeEventListener('error', onError);
                    // ä»…åœ¨å‡ºé”™æ—¶æ˜¾ç¤ºé”™è¯¯æç¤º
                    let errorDiv = placeholder.querySelector('.video-loading');
                    if (!errorDiv) {
                        errorDiv = document.createElement('div');
                        errorDiv.className = 'video-loading';
                        errorDiv.style.cssText = 'position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: white; background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 5px; z-index: 100; font-size: 14px;';
                        placeholder.appendChild(errorDiv);
                    }
                    errorDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                    errorDiv.style.display = 'block';
                    // ä½¿ç”¨å·¥å…·å‡½æ•°æ¢å¤çŠ¶æ€
                    resetVideoState(video, placeholder, container);
                };
                
                video.addEventListener('error', onError, { once: true });
                
                // ç­‰å¾…è§†é¢‘å®Œå…¨åŠ è½½å¥½ï¼ˆcanplaythrough ç¡®ä¿å¯ä»¥æµç•…æ’­æ”¾åˆ°ç»“å°¾ï¼‰
                const onCanPlayThrough = function() {
                    debugLog('è§†é¢‘å®Œå…¨åŠ è½½å¥½:', video.id, 'readyState:', video.readyState);
                    video.removeEventListener('canplaythrough', onCanPlayThrough);
                    video.removeEventListener('error', onError);
                    
                    // ç¡®ä¿è§†é¢‘çš„ readyState è¶³å¤Ÿé«˜ï¼ˆHAVE_ENOUGH_DATA = 4ï¼‰
                    if (video.readyState >= 4) {
                        // ä¼˜å…ˆä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦ï¼ˆæœ€å¯é ï¼‰
                        let placeholderActualHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                        
                        if (placeholderActualHeight > 0) {
                            debugLog('onCanPlayThrough: ä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦:', placeholderActualHeight);
                        } else {
                            // å¦‚æœä¿å­˜çš„é«˜åº¦ä¸å¯ç”¨ï¼Œè·å–å ä½ç¬¦çš„å®é™…æ˜¾ç¤ºé«˜åº¦ï¼ˆåœ¨æ”¹å˜ä»»ä½•æ ·å¼ä¹‹å‰ï¼‰
                            placeholderActualHeight = placeholder.offsetHeight || placeholder.clientHeight;
                            
                            // å¦‚æœ offsetHeight ä¸º0ï¼Œä½¿ç”¨ getBoundingClientRect è·å–å®é™…æ¸²æŸ“é«˜åº¦
                            if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                const rect = placeholder.getBoundingClientRect();
                                placeholderActualHeight = rect.height;
                                debugLog('ä½¿ç”¨ getBoundingClientRect è·å–å ä½ç¬¦é«˜åº¦:', placeholderActualHeight);
                            }
                            
                            // å¦‚æœä»ç„¶æ²¡æœ‰é«˜åº¦ï¼Œä½¿ç”¨å°é¢å›¾çš„é«˜åº¦
                            if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                if (coverImg) {
                                    placeholderActualHeight = coverImg.offsetHeight || coverImg.clientHeight;
                                    if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                        // ä½¿ç”¨ getBoundingClientRect è·å–å°é¢å›¾çš„å®é™…æ˜¾ç¤ºå°ºå¯¸
                                        const coverRect = coverImg.getBoundingClientRect();
                                        const coverDisplayHeight = coverRect.height;
                                        const coverDisplayWidth = coverRect.width;
                                        
                                        if (coverDisplayHeight > 0) {
                                            // å¦‚æœ getBoundingClientRect èƒ½è·å–åˆ°é«˜åº¦ï¼Œç›´æ¥ä½¿ç”¨
                                            placeholderActualHeight = coverDisplayHeight;
                                            debugLog('ä½¿ç”¨å°é¢å›¾ getBoundingClientRect é«˜åº¦:', placeholderActualHeight);
                                        } else if (coverDisplayWidth > 0 && coverImg.naturalHeight > 0 && coverImg.naturalWidth > 0) {
                                            // å¦‚æœé«˜åº¦ä¸º0ï¼Œä½¿ç”¨å°é¢å›¾çš„å®é™…æ˜¾ç¤ºå®½åº¦å’Œå®½é«˜æ¯”è®¡ç®—
                                            const aspectRatio = coverImg.naturalHeight / coverImg.naturalWidth;
                                            placeholderActualHeight = coverDisplayWidth * aspectRatio;
                                            debugLog('ä½¿ç”¨å°é¢å›¾æ˜¾ç¤ºå®½åº¦è®¡ç®—é«˜åº¦:', placeholderActualHeight, 'æ˜¾ç¤ºå®½åº¦:', coverDisplayWidth);
                                        }
                                    }
                                    debugLog('ä½¿ç”¨å°é¢å›¾é«˜åº¦:', placeholderActualHeight);
                                }
                            }
                        }
                        
                        // ä½¿ç”¨å·¥å…·å‡½æ•°è®¡ç®—é«˜åº¦ï¼ˆä½œä¸ºåå¤‡ï¼‰
                        const targetHeight = calculateVideoHeight(video, container, placeholder, coverImg);
                        
                        // ä¼˜å…ˆä½¿ç”¨å ä½ç¬¦çš„å®é™…é«˜åº¦ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨è®¡ç®—é«˜åº¦
                        const finalTargetHeight = placeholderActualHeight > 0 ? placeholderActualHeight : targetHeight;
                        debugLog('æœ€ç»ˆä½¿ç”¨é«˜åº¦:', finalTargetHeight, 'å ä½ç¬¦é«˜åº¦:', placeholderActualHeight, 'è®¡ç®—é«˜åº¦:', targetHeight);
                        
                        // ä½¿ç”¨å·¥å…·å‡½æ•°æ‰§è¡Œæ·¡å…¥æ·¡å‡ºè¿‡æ¸¡
                        fadeInVideo(video, placeholder, container, finalTargetHeight);
                        
                        // å¼€å§‹æ’­æ”¾
                        const playPromise = video.play();
                        if (playPromise !== undefined) {
                            playPromise.then(() => {
                                debugLog('ç§»åŠ¨ç«¯è§†é¢‘æ’­æ”¾æˆåŠŸ:', video.id);
                            }).catch(err => {
                                debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                                // ä½¿ç”¨å·¥å…·å‡½æ•°æ¢å¤çŠ¶æ€
                                resetVideoState(video, placeholder, container);
                                // æ’­æ”¾å¤±è´¥æ—¶ï¼Œå°é¢å›¾ä¼šæ¢å¤æ˜¾ç¤ºï¼Œç”¨æˆ·å¯å†æ¬¡ç‚¹å‡»é‡è¯•
                            });
                        }
                    } else {
                        // å¦‚æœ readyState è¿˜ä¸å¤Ÿï¼Œç­‰å¾…ä¸€ä¸‹å†è¯•
                        debugLog('è§†é¢‘ readyState ä¸å¤Ÿï¼Œç­‰å¾…ä¸­...', video.readyState);
                        setTimeout(() => {
                            if (video.readyState >= 4) {
                                // ä¼˜å…ˆä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦
                                let placeholderActualHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                                if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                    placeholderActualHeight = placeholder.offsetHeight || placeholder.clientHeight;
                                    if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                        const rect = placeholder.getBoundingClientRect();
                                        placeholderActualHeight = rect.height;
                                    }
                                }
                                const targetHeight = calculateVideoHeight(video, container, placeholder, coverImg);
                                const finalTargetHeight = placeholderActualHeight > 0 ? placeholderActualHeight : targetHeight;
                                fadeInVideo(video, placeholder, container, finalTargetHeight);
                video.play().catch(err => {
                                    debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                                    resetVideoState(video, placeholder, container);
                                });
                            }
                        }, 100);
                    }
                };
                
                // ä¼˜å…ˆä½¿ç”¨ canplaythroughï¼Œå¦‚æœæµè§ˆå™¨ä¸æ”¯æŒåˆ™é™çº§åˆ° canplay
                if ('canplaythrough' in video) {
                    video.addEventListener('canplaythrough', onCanPlayThrough, { once: true });
                } else {
                    // é™çº§æ–¹æ¡ˆï¼šä½¿ç”¨ canplayï¼Œä½†ç­‰å¾…æ›´é•¿æ—¶é—´ç¡®ä¿è§†é¢‘åŠ è½½æ›´å¤šæ•°æ®
                    const onCanPlay = function() {
                        debugLog('è§†é¢‘å¯ä»¥æ’­æ”¾ï¼ˆé™çº§æ–¹æ¡ˆï¼‰:', video.id);
                        video.removeEventListener('canplay', onCanPlay);
                        video.removeEventListener('error', onError);
                        // ç­‰å¾…é¢å¤–æ—¶é—´ç¡®ä¿è§†é¢‘åŠ è½½æ›´å¤šæ•°æ®
                        setTimeout(() => {
                            if (video.readyState >= 3) {
                                // ä¼˜å…ˆä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦
                                let placeholderActualHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                                if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                    placeholderActualHeight = placeholder.offsetHeight || placeholder.clientHeight;
                                    if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                        const rect = placeholder.getBoundingClientRect();
                                        placeholderActualHeight = rect.height;
                                    }
                                }
                                const targetHeight = calculateVideoHeight(video, container, placeholder, coverImg);
                                const finalTargetHeight = placeholderActualHeight > 0 ? placeholderActualHeight : targetHeight;
                                fadeInVideo(video, placeholder, container, finalTargetHeight);
                                video.play().catch(err => {
                                    debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                                    resetVideoState(video, placeholder, container);
                                });
                            }
                        }, 300);
                    };
                    video.addEventListener('canplay', onCanPlay, { once: true });
                }
            } else {
                // è§†é¢‘å·²åŠ è½½ï¼Œç¡®ä¿è§†é¢‘å®Œå…¨å‡†å¤‡å¥½åå†æ’­æ”¾
                debugLog('è§†é¢‘å·²åŠ è½½ï¼Œæ£€æŸ¥å‡†å¤‡çŠ¶æ€:', video.id, 'readyState:', video.readyState);
                
                // ç¡®ä¿è§†é¢‘çš„ readyState è¶³å¤Ÿé«˜ï¼ˆHAVE_ENOUGH_DATA = 4ï¼‰
                if (video.readyState >= 4) {
                    // ä¼˜å…ˆä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦
                    let placeholderActualHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                    if (!placeholderActualHeight || placeholderActualHeight === 0) {
                        placeholderActualHeight = placeholder.offsetHeight || placeholder.clientHeight;
                        if (!placeholderActualHeight || placeholderActualHeight === 0) {
                            const rect = placeholder.getBoundingClientRect();
                            placeholderActualHeight = rect.height;
                        }
                    }
                    // è§†é¢‘å·²å®Œå…¨å‡†å¤‡å¥½ï¼Œç›´æ¥æ‰§è¡Œæ·¡å…¥æ·¡å‡º
                    const targetHeight = calculateVideoHeight(video, container, placeholder, coverImg);
                    const finalTargetHeight = placeholderActualHeight > 0 ? placeholderActualHeight : targetHeight;
                    fadeInVideo(video, placeholder, container, finalTargetHeight);
                    
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            debugLog('ç§»åŠ¨ç«¯è§†é¢‘æ’­æ”¾æˆåŠŸ:', video.id);
                        }).catch(err => {
                            debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                            // ä½¿ç”¨å·¥å…·å‡½æ•°æ¢å¤çŠ¶æ€
                            resetVideoState(video, placeholder, container);
                            // æ’­æ”¾å¤±è´¥æ—¶ï¼Œå°é¢å›¾ä¼šæ¢å¤æ˜¾ç¤ºï¼Œç”¨æˆ·å¯å†æ¬¡ç‚¹å‡»é‡è¯•
                        });
                    }
                } else {
                    // è§†é¢‘è¿˜æœªå®Œå…¨å‡†å¤‡å¥½ï¼Œç­‰å¾… canplaythrough äº‹ä»¶
                    debugLog('è§†é¢‘æœªå®Œå…¨å‡†å¤‡å¥½ï¼Œç­‰å¾… canplaythrough äº‹ä»¶:', video.id, 'readyState:', video.readyState);
                    const onCanPlayThrough = function() {
                        debugLog('è§†é¢‘å·²å®Œå…¨å‡†å¤‡å¥½ï¼Œå¼€å§‹æ’­æ”¾:', video.id);
                        video.removeEventListener('canplaythrough', onCanPlayThrough);
                        // ä¼˜å…ˆä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦
                        let placeholderActualHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                        if (!placeholderActualHeight || placeholderActualHeight === 0) {
                            placeholderActualHeight = placeholder.offsetHeight || placeholder.clientHeight;
                            if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                const rect = placeholder.getBoundingClientRect();
                                placeholderActualHeight = rect.height;
                            }
                        }
                        const targetHeight = calculateVideoHeight(video, container, placeholder, coverImg);
                        const finalTargetHeight = placeholderActualHeight > 0 ? placeholderActualHeight : targetHeight;
                        fadeInVideo(video, placeholder, container, finalTargetHeight);
                        
                        video.play().catch(err => {
                            debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                            resetVideoState(video, placeholder, container);
                        });
                    };
                    
                    if ('canplaythrough' in video) {
                        video.addEventListener('canplaythrough', onCanPlayThrough, { once: true });
                    } else {
                        // é™çº§æ–¹æ¡ˆï¼šç­‰å¾…ä¸€æ®µæ—¶é—´åæ£€æŸ¥ readyState
                        setTimeout(() => {
                            if (video.readyState >= 3) {
                                // ä¼˜å…ˆä½¿ç”¨ç‚¹å‡»æ—¶ä¿å­˜çš„é«˜åº¦
                                let placeholderActualHeight = placeholder.dataset.savedHeight ? parseFloat(placeholder.dataset.savedHeight) : 0;
                                if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                    placeholderActualHeight = placeholder.offsetHeight || placeholder.clientHeight;
                                    if (!placeholderActualHeight || placeholderActualHeight === 0) {
                                        const rect = placeholder.getBoundingClientRect();
                                        placeholderActualHeight = rect.height;
                                    }
                                }
                                const targetHeight = calculateVideoHeight(video, container, placeholder, coverImg);
                                const finalTargetHeight = placeholderActualHeight > 0 ? placeholderActualHeight : targetHeight;
                                fadeInVideo(video, placeholder, container, finalTargetHeight);
                                video.play().catch(err => {
                                    debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                                    resetVideoState(video, placeholder, container);
                                });
                            }
                        }, 300);
                    }
                }
            }
        }
        
        // ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾è®¾ç½®ï¼ˆä½¿ç”¨ Intersection Observerï¼‰
        function setupMobileVideoAutoplay(videoId, videoSrc) {
            const video = document.getElementById(videoId);
            if (!video) {
                debugError('æ‰¾ä¸åˆ°è§†é¢‘:', videoId);
                return;
            }
            
            // è®¾ç½®è§†é¢‘æºï¼ˆå¦‚æœè¿˜æ²¡æœ‰è®¾ç½®ï¼‰
            if (!video.src || video.src !== videoSrc) {
                video.src = videoSrc;
                video.load();
            }
            
            // ç¡®ä¿è§†é¢‘åŠ è½½ç¬¬ä¸€å¸§ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
            video.addEventListener('loadedmetadata', function() {
                video.currentTime = 0.1; // è®¾ç½®åˆ° 0.1 ç§’ï¼Œç¡®ä¿æœ‰ç”»é¢
            }, { once: true });
            
            let isPlaying = false;
            let playTimeout = null;
            let pauseTimeout = null;
            
            // åˆ›å»º Intersection Observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // è¿›å…¥è§†å£ï¼Œè‡ªåŠ¨æ’­æ”¾
                        if (!isPlaying && !video.paused) return; // å¦‚æœå·²ç»åœ¨æ’­æ”¾ï¼Œè·³è¿‡
                        
                        if (playTimeout) clearTimeout(playTimeout);
                        playTimeout = setTimeout(() => {
                            video.play().then(() => {
                                isPlaying = true;
                                debugLog('ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾:', videoId);
                            }).catch(err => {
                                debugLog('ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', err);
                            });
                        }, 200); // 200ms å»¶è¿Ÿï¼Œé¿å…é¢‘ç¹è§¦å‘
                    } else {
                        // ç¦»å¼€è§†å£ï¼Œæš‚åœè§†é¢‘
                        if (isPlaying || !video.paused) {
                            if (pauseTimeout) clearTimeout(pauseTimeout);
                            pauseTimeout = setTimeout(() => {
                                video.pause();
                                video.currentTime = 0; // é‡ç½®åˆ°å¼€å¤´
                                isPlaying = false;
                                debugLog('ç§»åŠ¨ç«¯è§†é¢‘æš‚åœ:', videoId);
                            }, 200);
                        }
                    }
                });
            }, {
                threshold: 0.5, // å½“ 50% è¿›å…¥è§†å£æ—¶è§¦å‘
                rootMargin: '0px'
            });
            
            observer.observe(video);
            
            // è¿”å›æ¸…ç†å‡½æ•°
            return () => {
                observer.disconnect();
                if (playTimeout) clearTimeout(playTimeout);
                if (pauseTimeout) clearTimeout(pauseTimeout);
            };
        }
        
        // ç§»åŠ¨ç«¯å›¾ç‰‡æ»‘åŠ¨å˜å½©è‰²ï¼ˆä½¿ç”¨ Intersection Observerï¼‰
        function setupMobileImageColor(imgElement) {
            if (!imgElement) {
                debugError('æ‰¾ä¸åˆ°å›¾ç‰‡å…ƒç´ ');
                return;
            }
            
            debugLog('è®¾ç½®ç§»åŠ¨ç«¯å›¾ç‰‡å˜å½©è‰²:', imgElement.src, imgElement);
            
            let isInView = false;
            let colorTimeout = null;
            let grayscaleTimeout = null;
            
            // æ£€æŸ¥å›¾ç‰‡æ˜¯å¦å·²ç»åœ¨è§†å£ä¸­
            const checkInitialView = () => {
                const rect = imgElement.getBoundingClientRect();
                const isVisible = rect.top < window.innerHeight && rect.bottom > 0;
                if (isVisible && !isInView) {
                    imgElement.classList.add('in-view');
                    isInView = true;
                    debugLog('å›¾ç‰‡åˆå§‹å·²åœ¨è§†å£ï¼Œç›´æ¥å˜ä¸ºå½©è‰²:', imgElement.src);
                }
            };
            
            // å»¶è¿Ÿæ£€æŸ¥ï¼Œç¡®ä¿å›¾ç‰‡å·²æ¸²æŸ“
            setTimeout(checkInitialView, 100);
            
            // åˆ›å»º Intersection Observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    debugLog('Intersection Observer è§¦å‘:', entry.isIntersecting, entry.intersectionRatio, imgElement.src);
                    if (entry.isIntersecting) {
                        // è¿›å…¥è§†å£ï¼Œå˜ä¸ºå½©è‰²
                        if (!isInView) {
                            if (colorTimeout) clearTimeout(colorTimeout);
                            colorTimeout = setTimeout(() => {
                                imgElement.classList.add('in-view');
                                isInView = true;
                                debugLog('ç§»åŠ¨ç«¯å›¾ç‰‡å˜ä¸ºå½©è‰²:', imgElement.src);
                            }, 100); // å‡å°‘å»¶è¿Ÿåˆ° 100ms
                        }
                    } else {
                        // ç¦»å¼€è§†å£ï¼Œå˜å›é»‘ç™½
                        if (isInView) {
                            if (grayscaleTimeout) clearTimeout(grayscaleTimeout);
                            grayscaleTimeout = setTimeout(() => {
                                imgElement.classList.remove('in-view');
                                isInView = false;
                                debugLog('ç§»åŠ¨ç«¯å›¾ç‰‡å˜å›é»‘ç™½:', imgElement.src);
                            }, 100);
                        }
                    }
                });
            }, {
                threshold: 0.3, // é™ä½åˆ° 30%ï¼Œæ›´å®¹æ˜“è§¦å‘
                rootMargin: '50px' // æå‰ 50px è§¦å‘ï¼Œè®©ä½“éªŒæ›´æµç•…
            });
            
            observer.observe(imgElement);
            
            // è¿”å›æ¸…ç†å‡½æ•°
            return () => {
                observer.disconnect();
                if (colorTimeout) clearTimeout(colorTimeout);
                if (grayscaleTimeout) clearTimeout(grayscaleTimeout);
            };
        }
        
        // ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾å‡½æ•°ï¼ˆè¿”å› Promiseï¼‰
        function autoPlayMobileVideo(video, videoSrc, placeholder) {
            return new Promise((resolve, reject) => {
                debugLog('å°è¯•è‡ªåŠ¨æ’­æ”¾è§†é¢‘:', video.id, 'å½“å‰çŠ¶æ€:', {
                    paused: video.paused,
                    readyState: video.readyState,
                    src: video.src
                });
                
                // å¦‚æœè§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œç›´æ¥è¿”å›æˆåŠŸ
                if (!video.paused && video.readyState >= 2) {
                    debugLog('è§†é¢‘å·²åœ¨æ’­æ”¾ï¼Œè·³è¿‡');
                    resolve();
                    return;
                }
                
                // å¦‚æœè§†é¢‘å…ƒç´ è¢«æ ‡è®°ä¸ºå¤„ç†ä¸­ï¼Œç›´æ¥è¿”å›
                if (video.dataset.processing === 'true') {
                    debugLog('è§†é¢‘æ­£åœ¨å¤„ç†ä¸­ï¼Œè·³è¿‡');
                    resolve();
                    return;
                }
                
                video.dataset.processing = 'true';
            
            // ä½¿ç”¨ä¼ å…¥çš„ videoSrc å‚æ•°ï¼Œç¡®ä¿æœ‰å€¼
            if (!videoSrc) {
                debugError('videoSrc å‚æ•°ä¸ºç©º:', video.id);
                video.dataset.processing = 'false';
                reject(new Error('videoSrc å‚æ•°ä¸ºç©º'));
                return;
            }
            
            // ç›´æ¥æ£€æŸ¥ video.src æ˜¯å¦ä¸ºç©ºæˆ–ä¸ videoSrc ä¸åŒï¼Œç¡®ä¿è®¾ç½®è§†é¢‘æº
            debugLog('è§†é¢‘æºæ£€æŸ¥:', {
                videoId: video.id,
                videoSrcParam: videoSrc,
                videoSrcAttr: video.src,
                dataSrc: video.getAttribute('data-src')
            });
            
            if (!video.src || video.src !== videoSrc) {
                debugLog('è®¾ç½®è§†é¢‘æº:', videoSrc);
                video.src = videoSrc;
                video.load();
                
                // ç­‰å¾…è§†é¢‘å¯ä»¥æ’­æ”¾
                const onCanPlay = function() {
                    video.removeEventListener('canplay', onCanPlay);
                    
                    // å…ˆéšè—å°é¢å›¾
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                    
                    // æ˜¾ç¤ºè§†é¢‘å¹¶æ·»åŠ playingç±»
                    video.style.display = 'block';
                    video.classList.add('playing');
                    
                    // å¼€å§‹æ’­æ”¾
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            debugLog('ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾æˆåŠŸ:', video.id);
                            video.dataset.processing = 'false';
                            resolve();
                        }).catch(err => {
                            debugLog('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', err, video.id);
                            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºå°é¢å›¾ï¼Œéšè—è§†é¢‘
                            video.style.display = 'none';
                            video.classList.remove('playing');
                            video.dataset.processing = 'false';
                            if (placeholder) {
                                placeholder.style.display = 'block';
                            }
                            reject(err);
                        });
                    } else {
                        video.dataset.processing = 'false';
                        resolve();
                    }
                };
                
                video.addEventListener('canplay', onCanPlay, { once: true });
            } else {
                // è§†é¢‘å·²åŠ è½½ï¼Œç›´æ¥æ’­æ”¾
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                
                video.style.display = 'block';
                video.classList.add('playing');
                
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        debugLog('ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾æˆåŠŸ:', video.id);
                        video.dataset.processing = 'false';
                        resolve();
                    }).catch(err => {
                        debugLog('æ’­æ”¾å¤±è´¥:', err, video.id);
                        // å¦‚æœæ’­æ”¾å¤±è´¥ï¼Œæ¢å¤å°é¢å›¾æ˜¾ç¤ºï¼Œéšè—è§†é¢‘
                        video.style.display = 'none';
                        video.classList.remove('playing');
                        video.dataset.processing = 'false';
                        if (placeholder) {
                            placeholder.style.position = 'relative';
                            placeholder.style.width = '100%';
                            placeholder.style.height = 'auto';
                            placeholder.style.opacity = '1';
                            placeholder.style.pointerEvents = 'auto';
                            placeholder.style.display = 'block';
                        }
                        reject(err);
                    });
                } else {
                    video.dataset.processing = 'false';
                    resolve();
                }
            }
            });
        }
        
        // æ’­æ”¾è§†é¢‘ï¼ˆæ¡Œé¢ç«¯æˆ–å·²åŠ è½½çš„è§†é¢‘ï¼‰
        function playVideo(videoId) {
            const video = document.getElementById(videoId);
            if (video) {
                const playButton = video.closest('.video-container').querySelector('.play-button');
                video.classList.add('playing');
                video.play().then(() => {
                    if (playButton) {
                        playButton.style.display = 'none';
                    }
                }).catch(err => {
                    debugLog('æ’­æ”¾å¤±è´¥:', err);
                });
            }
        }

        // å¤„ç†è§†é¢‘ç‚¹å‡»ï¼ˆç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯ï¼‰
        function handleVideoClick(video, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ä¸”è§†é¢‘æœªåŠ è½½ï¼Œå°è¯•åŠ è½½
            if (isMobileDevice() && (!video.src || video.src === '')) {
                const container = video.closest('.video-container');
                const placeholder = container ? container.querySelector('.video-placeholder') : null;
                const placeholderId = placeholder ? placeholder.id : null;
                const videoSrc = container ? container.getAttribute('data-video-src') : null;
                if (videoSrc && placeholderId) {
                    loadAndPlayVideo(video.id, videoSrc, placeholderId);
                }
                return;
            }
            
            const container = video.closest('.video-container');
            const playButton = container ? container.querySelector('.play-button') : null;
            
            if (video.paused) {
                // éšè—å°é¢å›¾
                const placeholder = container ? container.querySelector('.video-placeholder') : null;
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                video.classList.add('playing');
                video.play().then(() => {
                    if (playButton) {
                        playButton.style.display = 'none';
                    }
                }).catch(err => {
                    debugLog('æ’­æ”¾å¤±è´¥:', err);
                    // æ’­æ”¾å¤±è´¥æ—¶æ˜¾ç¤ºå°é¢å›¾
                    if (placeholder) {
                        placeholder.style.display = 'flex';
                    }
                });
            } else {
                video.classList.remove('playing');
                video.pause();
                // å¦‚æœå›åˆ°å¼€å¤´ï¼Œæ˜¾ç¤ºå°é¢å›¾
                if (video.currentTime === 0) {
                    const placeholder = container ? container.querySelector('.video-placeholder') : null;
                    if (placeholder) {
                        placeholder.style.display = 'flex';
                    }
                }
                if (playButton && window.innerWidth <= 768) {
                    playButton.style.display = 'flex';
                }
            }
        }

        // å¤„ç†è§¦æ‘¸å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ï¼‰
        let touchStartTime = 0;
        function handleVideoTouchStart(video) {
            touchStartTime = Date.now();
        }

        // å¤„ç†è§¦æ‘¸ç»“æŸï¼ˆç§»åŠ¨ç«¯ï¼‰
        function handleVideoTouchEnd(video, event) {
            const touchDuration = Date.now() - touchStartTime;
            // çŸ­æŒ‰ï¼ˆå°äº300msï¼‰è§†ä¸ºç‚¹å‡»ï¼Œæ’­æ”¾è§†é¢‘
            if (touchDuration < 300) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ä¸”è§†é¢‘æœªåŠ è½½ï¼Œå…ˆåŠ è½½å†æ’­æ”¾
                if (isMobileDevice() && (!video.src || video.src === '')) {
                    const container = video.closest('.video-container');
                    const placeholder = container ? container.querySelector('.video-placeholder') : null;
                    const placeholderId = placeholder ? placeholder.id : null;
                    const videoSrc = container ? container.getAttribute('data-video-src') : null;
                    if (videoSrc && placeholderId) {
                        loadAndPlayVideo(video.id, videoSrc, placeholderId);
                    }
                } else {
                handleVideoClick(video);
                }
            }
        }
        
        // å¤„ç†è§†é¢‘æ‚¬åœï¼ˆæ¡Œé¢ç«¯ä¼˜åŒ–ï¼‰
        function handleVideoHover(video) {
            debugLog('handleVideoHover è§¦å‘', {
                paused: video.paused,
                currentTime: video.currentTime,
                readyState: video.readyState
            });
            
            // å¦‚æœè§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œä¸åšä»»ä½•æ“ä½œ
            if (!video.paused && video.currentTime > 0.5) {
                debugLog('è§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œè·³è¿‡');
                return;
            }
            
            const container = video.closest('.video-container');
            const placeholder = container ? container.querySelector('.video-placeholder') : null;
            
            // ç«‹å³éšè—å ä½ç¬¦ï¼Œå¹¶ç¦ç”¨æŒ‡é’ˆäº‹ä»¶
            if (placeholder) {
                placeholder.style.display = 'none';
                placeholder.style.setProperty('display', 'none', 'important');
                placeholder.style.pointerEvents = 'none';
                placeholder.style.zIndex = '1'; // é™ä½å ä½ç¬¦å±‚çº§
                debugLog('å ä½ç¬¦å·²éšè—');
            }
            
            // ç¡®ä¿è§†é¢‘å…ƒç´ å¯è§ä¸”åœ¨ä¸Šå±‚
            video.style.display = 'block';
            video.style.zIndex = '11';
            video.style.pointerEvents = 'auto';
            
            // å¼ºåˆ¶é‡ç½®è§†é¢‘çŠ¶æ€ï¼šå…ˆæš‚åœï¼Œå†é‡ç½®æ—¶é—´
            video.pause();
            video.currentTime = 0;
            
            // ç­‰å¾…é‡ç½®å®Œæˆåå†å°è¯•æ’­æ”¾
            const tryPlay = () => {
                // ç¡®ä¿å ä½ç¬¦å·²éšè—ä¸”ä¸ä¼šé˜»æŒ¡é¼ æ ‡äº‹ä»¶
                if (placeholder) {
                    placeholder.style.display = 'none';
                    placeholder.style.setProperty('display', 'none', 'important');
                    placeholder.style.pointerEvents = 'none';
                    placeholder.style.zIndex = '1';
                }
                
                // ç¡®ä¿è§†é¢‘å¯è§ä¸”å¯ä»¥æ¥æ”¶é¼ æ ‡äº‹ä»¶
                video.style.display = 'block';
                video.style.zIndex = '11';
                video.style.pointerEvents = 'auto';
                
                // å†æ¬¡å¼ºåˆ¶é‡ç½®çŠ¶æ€
                if (!video.paused) {
                    video.pause();
                }
                if (video.currentTime > 0.1) {
                    video.currentTime = 0;
                }
                
                console.log('å°è¯•æ’­æ”¾ï¼Œè§†é¢‘çŠ¶æ€:', {
                    paused: video.paused,
                    currentTime: video.currentTime,
                    readyState: video.readyState,
                    display: video.style.display,
                    zIndex: video.style.zIndex
                });
                
                // å°è¯•æ’­æ”¾
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        // æ’­æ”¾æˆåŠŸ
                        console.log('æ’­æ”¾æˆåŠŸï¼');
                        video.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                            placeholder.style.setProperty('display', 'none', 'important');
                            placeholder.style.pointerEvents = 'none';
                        }
                    }).catch(err => {
                        console.log('æ’­æ”¾å¤±è´¥:', err, 'è§†é¢‘çŠ¶æ€:', {
                            paused: video.paused,
                            readyState: video.readyState,
                            currentTime: video.currentTime,
                            networkState: video.networkState
                        });
                        
                        // ä¸ç«‹å³æ˜¾ç¤ºå ä½ç¬¦ï¼Œå…ˆå°è¯•é‡è¯•
                        // é‡ç½®è§†é¢‘çŠ¶æ€å¹¶é‡è¯•æ’­æ”¾
                        video.currentTime = 0;
                        
                        // ç¬¬ä¸€æ¬¡é‡è¯•
                        setTimeout(() => {
                            const retryPromise = video.play();
                            if (retryPromise !== undefined) {
                                retryPromise.then(() => {
                                    // é‡è¯•æˆåŠŸ
                                    console.log('ç¬¬ä¸€æ¬¡é‡è¯•æˆåŠŸï¼');
                                    video.classList.add('playing');
                                    if (placeholder) {
                                        placeholder.style.display = 'none';
                                        placeholder.style.setProperty('display', 'none', 'important');
                                        placeholder.style.pointerEvents = 'none';
                                    }
                                }).catch(retryErr => {
                                    console.log('ç¬¬ä¸€æ¬¡é‡è¯•å¤±è´¥:', retryErr, 'è§†é¢‘çŠ¶æ€:', {
                                        paused: video.paused,
                                        readyState: video.readyState,
                                        currentTime: video.currentTime
                                    });
                                    // å†æ¬¡é‡è¯•
                                    setTimeout(() => {
                                        video.currentTime = 0;
                                        const secondRetryPromise = video.play();
                                        if (secondRetryPromise !== undefined) {
                                            secondRetryPromise.then(() => {
                                                console.log('ç¬¬äºŒæ¬¡é‡è¯•æˆåŠŸï¼');
                                                video.classList.add('playing');
                                                if (placeholder) {
                                                    placeholder.style.display = 'none';
                                                    placeholder.style.setProperty('display', 'none', 'important');
                                                    placeholder.style.pointerEvents = 'none';
                                                }
                                            }).catch(() => {
                                                console.log('æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œæœ€ç»ˆè§†é¢‘çŠ¶æ€:', {
                                                    paused: video.paused,
                                                    readyState: video.readyState,
                                                    currentTime: video.currentTime,
                                                    networkState: video.networkState
                                                });
                                                // æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œæ‰æ˜¾ç¤ºå ä½ç¬¦
                                                if (placeholder) {
                                                    placeholder.style.display = 'flex';
                                                    video.style.zIndex = '1';
                                                }
                                                video.classList.remove('playing');
                                            });
                                        }
                                    }, 200);
                                });
                            }
                        }, 100);
                    });
                } else {
                    // ç›´æ¥æ’­æ”¾ï¼ˆæ—§æµè§ˆå™¨ï¼‰
                    try {
                        video.play();
                        video.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                    } catch (e) {
                        console.log('æ’­æ”¾å¤±è´¥:', e);
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                        }
                    }
                }
            };
            
            // ç­‰å¾…è§†é¢‘çŠ¶æ€é‡ç½®å®Œæˆåå†å°è¯•æ’­æ”¾
            // ä½¿ç”¨ seeked äº‹ä»¶ç¡®ä¿æ—¶é—´é‡ç½®å®Œæˆ
            const onSeeked = () => {
                video.removeEventListener('seeked', onSeeked);
                setTimeout(() => {
                    tryPlay();
                }, 50);
            };
            
            // å¦‚æœè§†é¢‘å·²ç»åœ¨å¼€å¤´ï¼Œç›´æ¥å°è¯•æ’­æ”¾
            if (video.currentTime < 0.1) {
                setTimeout(() => {
                    tryPlay();
                }, 50);
            } else {
                // éœ€è¦ç­‰å¾… seeked äº‹ä»¶
                video.addEventListener('seeked', onSeeked, { once: true });
                video.currentTime = 0;
            }
        }
        
        // å¤„ç†è§†é¢‘æ‚¬åœç¦»å¼€ï¼ˆæ¡Œé¢ç«¯ï¼‰
        function handleVideoHoverOut(video) {
            // æš‚åœè§†é¢‘
            if (!video.paused) {
                video.pause();
            }
            // ç§»é™¤æ’­æ”¾çŠ¶æ€ç±»
            video.classList.remove('playing');
            
            // é‡ç½®åˆ°å¼€å¤´ï¼ˆä¸é‡æ–°åŠ è½½è§†é¢‘ï¼Œä¿æŒè§†é¢‘å·²åŠ è½½çŠ¶æ€ï¼‰
            if (video.currentTime > 0.1) {
                video.currentTime = 0;
            }
            
            // æ˜¾ç¤ºå°é¢å›¾å’Œå ä½ç¬¦
            setTimeout(() => {
                const container = video.closest('.video-container');
                if (container) {
                    const placeholder = container.querySelector('.video-placeholder');
                    if (placeholder) {
                        // æ˜¾ç¤ºå ä½ç¬¦ï¼Œä½†ä¸è®©å®ƒé˜»æŒ¡é¼ æ ‡äº‹ä»¶ï¼ˆå› ä¸ºæ¡Œé¢ç«¯æ‚¬åœäº‹ä»¶åœ¨è§†é¢‘ä¸Šï¼‰
                        // æ¡Œé¢ç«¯å ä½ç¬¦åªæ˜¯è§†è§‰æ˜¾ç¤ºï¼Œå®é™…é¼ æ ‡äº‹ä»¶ç”±è§†é¢‘å…ƒç´ æ¥æ”¶
                        placeholder.style.display = 'flex';
                        placeholder.style.setProperty('display', 'flex', 'important');
                        placeholder.style.pointerEvents = 'none'; // å…³é”®ï¼šä¸é˜»æŒ¡é¼ æ ‡äº‹ä»¶
                        placeholder.style.zIndex = '10';
                        // ç¡®ä¿å°é¢å›¾ä¹Ÿæ˜¾ç¤º
                        const coverImg = placeholder.querySelector('.video-cover');
                        if (coverImg) {
                            coverImg.style.display = 'block';
                        }
                    }
                    // é™ä½è§†é¢‘ z-indexï¼Œä½†ä»ä¿æŒå¯æ¥æ”¶é¼ æ ‡äº‹ä»¶
                    video.style.zIndex = '1';
                    video.style.pointerEvents = 'auto';
                }
            }, 50); // çŸ­å»¶è¿Ÿç¡®ä¿é‡ç½®å®Œæˆ
        }
        
        // å¤„ç†è§†é¢‘å¯ä»¥æ’­æ”¾ï¼ˆä¼˜åŒ–ç¼“å†²ï¼‰
        function handleVideoCanPlay(video) {
            // ç¡®ä¿è§†é¢‘ç¼“å†²è¶³å¤Ÿå†å…è®¸æ’­æ”¾
            if (video.buffered.length > 0 && video.buffered.end(0) > 1) {
                video.classList.add('ready');
            }
        }
        
        // å¤„ç†è§†é¢‘æ’­æ”¾æ—¶éšè—å°é¢å›¾
        function handleVideoPlay(video, placeholderId) {
            const placeholder = placeholderId ? document.getElementById(placeholderId) : null;
            if (placeholder) {
                placeholder.style.display = 'none';
                const coverImg = placeholder.querySelector('.video-cover');
                if (coverImg) {
                    coverImg.style.display = 'none';
                }
            }
            // ç¡®ä¿è§†é¢‘åœ¨ä¸Šå±‚
            if (video && video.style) {
                video.style.zIndex = '11';
            }
        }
        
        // å¤„ç†è§†é¢‘æš‚åœæ—¶æ˜¾ç¤ºå°é¢å›¾ï¼ˆæ¡Œé¢ç«¯ï¼‰
        function handleVideoPause(video, placeholderId) {
            const placeholder = placeholderId ? document.getElementById(placeholderId) : null;
            if (placeholder && video.currentTime === 0) {
                placeholder.style.display = 'flex';
            }
        }
        
        // å¤„ç†å°é¢å›¾åŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ ¼å¼
        function handleCoverError(img, videoFile) {
            const src = img.src;
            const baseName = videoFile.replace(/\.[^/.]+$/, '');
            const assetPath = getAssetPath();
            
            console.log('å°é¢å›¾åŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ ¼å¼:', src);
            
            // å¦‚æœå½“å‰æ˜¯ _cover.jpgï¼Œå°è¯• .jpg
            if (src.includes('_cover.jpg')) {
                img.src = assetPath + baseName + '.jpg';
                img.onerror = function() {
                    // .jpg ä¹Ÿå¤±è´¥äº†ï¼Œå°è¯• .png
                    this.src = assetPath + baseName + '.png';
                    this.onerror = function() {
                        // æ‰€æœ‰æ ¼å¼éƒ½å¤±è´¥ï¼Œéšè—å›¾ç‰‡ï¼Œæ˜¾ç¤ºå ä½èƒŒæ™¯
                        console.log('æ‰€æœ‰å°é¢å›¾æ ¼å¼éƒ½åŠ è½½å¤±è´¥');
                        this.style.display = 'none';
                        // ç¡®ä¿å ä½ç¬¦ä»ç„¶æ˜¾ç¤º
                        const placeholder = this.closest('.video-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                            placeholder.style.background = '#222';
                        }
                    };
                };
                return;
            }
            
            // å¦‚æœå½“å‰æ˜¯ .jpgï¼Œå°è¯• .png
            if (src.includes('.jpg')) {
                img.src = assetPath + baseName + '.png';
                img.onerror = function() {
                    // .png ä¹Ÿå¤±è´¥äº†
                    console.log('æ‰€æœ‰å°é¢å›¾æ ¼å¼éƒ½åŠ è½½å¤±è´¥');
                    this.style.display = 'none';
                    const placeholder = this.closest('.video-placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'flex';
                        placeholder.style.background = '#222';
                    }
                };
                return;
            }
            
            // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œéšè—å›¾ç‰‡ï¼Œæ˜¾ç¤ºé»˜è®¤èƒŒæ™¯
            img.style.display = 'none';
            const placeholder = img.closest('.video-placeholder');
            if (placeholder) {
                placeholder.style.display = 'flex';
                placeholder.style.background = '#222';
            }
        }

        // ========================================================
        // ğŸ·ï¸ åˆ†ç±»ç­›é€‰åŠŸèƒ½
        // ========================================================
        
        // ç­›é€‰ä½œå“
        function filterWorks(category) {
            const items = document.querySelectorAll('.item');
            let visibleCount = 0;
            
            items.forEach(item => {
                if (category === 'all') {
                    item.style.display = '';
                    visibleCount++;
                } else {
                    const itemCategory = item.getAttribute('data-category');
                    if (itemCategory === category) {
                        item.style.display = '';
                        visibleCount++;
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
            
            // å¦‚æœæ²¡æœ‰ä½œå“ï¼Œæ˜¾ç¤ºæç¤º
            const gallery = document.getElementById('app');
            let noResults = gallery.querySelector('.no-results');
            
            if (visibleCount === 0 && category !== 'all') {
                if (!noResults) {
                    noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.textContent = `æš‚æ— "${category}"ç±»åˆ«çš„ä½œå“`;
                    gallery.appendChild(noResults);
                } else {
                    noResults.textContent = `æš‚æ— "${category}"ç±»åˆ«çš„ä½œå“`;
                }
            } else {
                if (noResults) {
                    noResults.remove();
                }
            }
        }
        
        // åˆå§‹åŒ–åˆ†ç±»ç­›é€‰å™¨
        function initFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    filterButtons.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    
                    // è·å–åˆ†ç±»å¹¶ç­›é€‰
                    const category = this.getAttribute('data-category');
                    filterWorks(category);
                });
            });
        }

        // ========================================================
        // ğŸŒ CDN é…ç½®ï¼ˆè§£å†³ä¸­å›½è®¿é—® GitHub Pages æ…¢çš„é—®é¢˜ï¼‰
        // ========================================================
        const CDN_CONFIG = {
            // ========== ä¸ƒç‰›äº‘ CDN é…ç½®ï¼ˆä¼˜å…ˆä½¿ç”¨ï¼‰ ==========
            // GitHub Pages ç¯å¢ƒè‡ªåŠ¨ç¦ç”¨ä¸ƒç‰›äº‘ï¼Œä½¿ç”¨ jsDelivrï¼›æœ¬åœ°æˆ–ä¸ƒç‰›äº‘éƒ¨ç½²æ—¶å¯ç”¨ä¸ƒç‰›äº‘
            useQiniuCDN: !window.location.hostname.includes('github.io'),
            
            // ä¸ƒç‰›äº‘ CDN åŸŸåï¼ˆè¯·æ›¿æ¢ä¸ºä½ çš„å®é™…åŸŸåï¼‰
            // æ–¹å¼ä¸€ï¼šä½¿ç”¨é»˜è®¤æµ‹è¯•åŸŸåï¼ˆæ ¼å¼ï¼šhttps://ä½ çš„ç©ºé—´å.bkt.clouddn.com/ï¼‰
            // æ–¹å¼äºŒï¼šä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼ˆéœ€è¦åŸŸåå·²å¤‡æ¡ˆï¼Œæ ¼å¼ï¼šhttps://ä½ çš„åŸŸå.com/ï¼‰
            // æ³¨æ„ï¼šåŸŸåæœ«å°¾éœ€è¦å¸¦æ–œæ  /
            // âš ï¸ ä¸Šä¼ æ–‡ä»¶åˆ°ä¸ƒç‰›äº‘åï¼Œè¯·åœ¨æ­¤å¤„å¡«å…¥ä½ çš„ CDN åŸŸå
            qiniuCDNBase: 'http://t67uxf1bp.hd-bkt.clouddn.com/',  // ä¸ƒç‰›äº‘æµ‹è¯•åŸŸå
            
            // ========== GitHub ä»“åº“ä¿¡æ¯ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰ ==========
            githubUser: 'mangguo001',
            githubRepo: 'mg-portfolio',
            githubBranch: 'main',
            
            // æ˜¯å¦ä½¿ç”¨ CDNï¼ˆè‡ªåŠ¨æ£€æµ‹ï¼šGitHub Pages ç¯å¢ƒä½¿ç”¨ CDNï¼Œæœ¬åœ°å¼€å‘ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼‰
            useCDN: window.location.hostname.includes('github.io') || 
                    window.location.hostname.includes('netlify.app') ||
                    window.location.hostname.includes('vercel.app')
        };
        
        // ç”Ÿæˆèµ„æºè·¯å¾„ï¼ˆassets æ–‡ä»¶å¤¹ï¼‰
        function getAssetPath() {
            // ä¼˜å…ˆä½¿ç”¨ä¸ƒç‰›äº‘ CDNï¼ˆå¦‚æœå·²é…ç½®ï¼Œæ— è®ºæœ¬åœ°è¿˜æ˜¯æœåŠ¡å™¨éƒ½ä½¿ç”¨ï¼‰
            if (CDN_CONFIG.useQiniuCDN && CDN_CONFIG.qiniuCDNBase && !CDN_CONFIG.qiniuCDNBase.includes('ä½ çš„ä¸ƒç‰›äº‘åŸŸå')) {
                return CDN_CONFIG.qiniuCDNBase + 'assets/';
            }
            
            // å¦‚æœé…ç½®äº†ä½¿ç”¨ CDNï¼ˆGitHub Pages ç­‰ç¯å¢ƒï¼‰ï¼Œä½¿ç”¨ jsDelivr å¤‡ç”¨æ–¹æ¡ˆ
            if (CDN_CONFIG.useCDN) {
                return `https://cdn.jsdelivr.net/gh/${CDN_CONFIG.githubUser}/${CDN_CONFIG.githubRepo}@${CDN_CONFIG.githubBranch}/assets/`;
            }
            
            // æœ¬åœ°å¼€å‘ä¸”æœªé…ç½®ä¸ƒç‰›äº‘ CDN æ—¶ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„
            return './assets/';
        }
        
        // ç”Ÿæˆ JSON æ•°æ®è·¯å¾„
        function getDataPath(filename) {
            // ä¼˜å…ˆä½¿ç”¨ä¸ƒç‰›äº‘ CDNï¼ˆå¦‚æœå·²é…ç½®ï¼Œæ— è®ºæœ¬åœ°è¿˜æ˜¯æœåŠ¡å™¨éƒ½ä½¿ç”¨ï¼‰
            if (CDN_CONFIG.useQiniuCDN && CDN_CONFIG.qiniuCDNBase && !CDN_CONFIG.qiniuCDNBase.includes('ä½ çš„ä¸ƒç‰›äº‘åŸŸå')) {
                // ç¡®ä¿è·¯å¾„æ­£ç¡®ï¼šqiniuCDNBase æœ«å°¾æœ‰æ–œæ ï¼Œç›´æ¥æ‹¼æ¥ _data/
                const base = CDN_CONFIG.qiniuCDNBase.endsWith('/') ? CDN_CONFIG.qiniuCDNBase : CDN_CONFIG.qiniuCDNBase + '/';
                return base + '_data/' + filename;
            }
            
            // å¦‚æœé…ç½®äº†ä½¿ç”¨ CDNï¼ˆGitHub Pages ç­‰ç¯å¢ƒï¼‰ï¼Œä½¿ç”¨ jsDelivr å¤‡ç”¨æ–¹æ¡ˆ
            if (CDN_CONFIG.useCDN) {
                return `https://cdn.jsdelivr.net/gh/${CDN_CONFIG.githubUser}/${CDN_CONFIG.githubRepo}@${CDN_CONFIG.githubBranch}/_data/${filename}`;
            }
            
            // æœ¬åœ°å¼€å‘ä¸”æœªé…ç½®ä¸ƒç‰›äº‘ CDN æ—¶ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„
            return `./_data/${filename}`;
        }

        // ========================================================
        // ğŸ“¦ æ•°æ®åŠ è½½åŠŸèƒ½ï¼ˆä»JSONæ–‡ä»¶åŠ è½½ï¼‰
        // ========================================================
        
        // é»˜è®¤æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
        const defaultWorks = [
            {
                // ç¬¬ä¸€ä¸ªä½œå“
                type: 'video',               // ç±»å‹: 'video' æˆ– 'image'
                file: 'demo_video.mp4',      // assets æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å
                title: 'UE5.6/MetaHuman å…¨èŒçŒäººå°¼é£å½¼å¤š',          // æ ‡é¢˜
                desc: 'Blender / ue5.6 ', // æè¿°
                category: 'åŠ¨ç”»',  // åˆ†ç±»: åŠ¨ç”»ã€ç»˜ç”»ã€äº¤äº’ã€è®¾è®¡
                link: 'https://www.bilibili.com/video/BV1zhCTB4Ebx' // ç‚¹å‡»è·³è½¬é“¾æ¥
            },
            {
                type: 'video',
                file: 'my_animation.mp4',  
                title: 'å‡å¦‚æˆ‘å®¶çš„çŒ«COSå…¨èŒçŒäººé‡Œçš„è§’è‰²ä¹‹å°¼é£å½¼å¤š',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV1Kb1jBqEdM'
            },
            // --- å¤åˆ¶ä¸‹é¢è¿™ä¸€å—æ¥æ·»åŠ æ–°ä½œå“ ---
            {
                type: 'video',
                file: 'my_animation2.mp4',  
                title: 'ä¹å¤©æ½æœˆ|è‡ªåˆ¶åŠ¨ç”»',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV1Q7xVzBEyh'
            },
            // ----------------------------------
            {
                type: 'video',
                file: 'å™¬é‡‘è™«.mp4',  
                title: 'å™¬é‡‘è™«|ä½åˆ—äººç•Œå¥‡è™«æ¦œç¬¬åäºŒä½ï¼Œç»ˆæˆé“ç¥–',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV1FrHnzaEB1'
            },
            // ----------------------------------
            {
                type: 'video',
                file: 'å…¨èŒçŒäººå‡¯ç‰¹.mp4',  
                title: 'å…¨èŒçŒäººå‡¯ç‰¹çœŸäººç‰ˆ',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV13mW4zzEVW'
            },
            
             // ----------------------------------
            {
                type: 'image',
                file: '2021 (2).JPG',  
                title: 'æ— é¢˜',
                desc: 'æ¿ç»˜',
                category: 'ç»˜ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV13mW4zzEVW'
            }
        ];
        
        const defaultSettings = {
            siteTitle: "MY WORK",
            headerTitle: "MG-mango\nPortfolio.",
            intro: {
                line1: "æ…¢å·¥è‰ºæœ¯.",
                line2: "å¹³PING & èŠ’æœå°å­.",
                line3: "æ•°å­—è‰ºæœ¯åˆ›ä½œè€….",
                line4: "æ¹–åŒ—æ­¦æ±‰.",
                line5: "ğŸ›°VXï¼šmango130p"
            },
            categories: ["åŠ¨ç”»", "ç»˜ç”»", "äº¤äº’", "è®¾è®¡"]
        };
        
        // åŠ è½½ä½œå“æ•°æ®
        async function loadWorks() {
            try {
                const response = await fetch(getDataPath('works.json'));
                if (!response.ok) {
                    throw new Error('æ— æ³•åŠ è½½ä½œå“æ•°æ®');
                }
                const data = await response.json();
                // æŒ‰orderæ’åº
                const works = (data.works || []).sort((a, b) => (a.order || 0) - (b.order || 0));
                return works;
            } catch (error) {
                console.error('åŠ è½½ä½œå“æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', error);
                return defaultWorks;
            }
        }
        
        // åŠ è½½é¡µé¢è®¾ç½®
        async function loadSettings() {
            try {
                const response = await fetch(getDataPath('settings.json'));
                if (!response.ok) {
                    throw new Error('æ— æ³•åŠ è½½é¡µé¢è®¾ç½®');
                }
                const data = await response.json();
                return data.settings || defaultSettings;
            } catch (error) {
                console.error('åŠ è½½é¡µé¢è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®:', error);
                return defaultSettings;
            }
        }
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œä»‹ç»
        function updatePageSettings(settings) {
            // æ›´æ–°ç½‘ç«™æ ‡é¢˜
            if (settings.siteTitle) {
                document.title = settings.siteTitle;
            }
            
            // æ›´æ–°å¤´éƒ¨æ ‡é¢˜
            const headerTitle = document.querySelector('h1');
            if (headerTitle && settings.headerTitle) {
                headerTitle.innerHTML = settings.headerTitle.replace(/\n/g, '<br>');
            }
            
            // æ›´æ–°ä»‹ç»æ–‡å­—
            const introDiv = document.querySelector('.intro');
            if (introDiv && settings.intro) {
                const intro = settings.intro;
                introDiv.innerHTML = `
                    ${intro.line1 || ''}<br>
                    ${intro.line2 || ''}<br>
                    ${intro.line3 || ''}<br>
                    ${intro.line4 || ''}<br>
                    ${intro.line5 || ''}
                `;
            }
            
            // æ›´æ–°åˆ†ç±»æŒ‰é’®ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if (settings.categories && settings.categories.length > 0) {
                updateCategoryButtons(settings.categories);
            }
        }
        
        // æ›´æ–°åˆ†ç±»æŒ‰é’®
        function updateCategoryButtons(categories) {
            const filterButtons = document.querySelector('.filter-buttons');
            if (!filterButtons) return;
            
            let buttonsHTML = '<button class="filter-btn active" data-category="all">å…¨éƒ¨</button>';
            categories.forEach(category => {
                buttonsHTML += `<button class="filter-btn" data-category="${category}">${category}</button>`;
            });
            
            filterButtons.innerHTML = buttonsHTML;
            
            // é‡æ–°åˆå§‹åŒ–ç­›é€‰å™¨
            initFilterButtons();
        }
        
        // å…¨å±€å˜é‡ï¼Œå­˜å‚¨åŠ è½½çš„æ•°æ®
        let works = [];
        let settings = {};

        // ========================================================
        // ğŸ‘‡ ä¸‹é¢çš„ä»£ç è´Ÿè´£ç”Ÿæˆç½‘é¡µï¼Œéœ€è¦ä¿®æ”¹ä¸ºå¼‚æ­¥åŠ è½½ ğŸ‘‡
        // ========================================================
        
        // ç”Ÿæˆä½œå“åˆ—è¡¨
        async function generateWorks() {
            const gallery = document.getElementById('app');
            const assetPath = getAssetPath(); // è‡ªåŠ¨ä½¿ç”¨ CDN æˆ–æœ¬åœ°è·¯å¾„
            
            // åŠ è½½æ•°æ®å’Œè®¾ç½®
            works = await loadWorks();
            settings = await loadSettings();
            
            // æ›´æ–°é¡µé¢è®¾ç½®
            updatePageSettings(settings);
            
            // æ¸…ç©ºç”»å»Š
            gallery.innerHTML = '';

            works.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'item';
            // æ·»åŠ åˆ†ç±»å±æ€§ï¼Œå¦‚æœæ²¡æœ‰åˆ†ç±»åˆ™é»˜è®¤ä¸º"å…¶ä»–"
            card.setAttribute('data-category', item.category || 'å…¶ä»–');
            
            // åœ¨å¾ªç¯å¼€å§‹æ—¶å°±æ£€æµ‹ç§»åŠ¨ç«¯ï¼ˆå¯¹æ‰€æœ‰ç±»å‹éƒ½æœ‰æ•ˆï¼‰
            const isMobile = isMobileDevice();
            
            let mediaHTML = '';
            
            // åœ¨å¾ªç¯å¤–éƒ¨å®šä¹‰å˜é‡ï¼Œç¡®ä¿ä½œç”¨åŸŸæ­£ç¡®
            let videoId = '';
            let placeholderId = '';
            let videoSrc = '';
            let coverSrc = '';

            if (item.type === 'video') {
                // è§†é¢‘ï¼šç§»åŠ¨ç«¯æ‡’åŠ è½½ä¼˜åŒ–ï¼Œæ¡Œé¢ç«¯æ­£å¸¸åŠ è½½
                videoId = `video-${Date.now()}-${index}-${Math.random().toString(36).substr(2, 9)}`;
                placeholderId = `placeholder-${videoId}`;
                videoSrc = assetPath + item.file;
                coverSrc = getCoverImagePath(item.file, item.cover, assetPath);
                
                if (isMobile) {
                    // ç§»åŠ¨ç«¯ï¼šæ»‘åŠ¨åˆ°å¡ç‰‡æ—¶è‡ªåŠ¨æ’­æ”¾ï¼Œä¸æ˜¾ç¤ºå°é¢å›¾ï¼Œä½¿ç”¨è§†é¢‘ç¬¬ä¸€å¸§
                    mediaHTML = `
                        <div class="media-box video-container mobile-video-item" data-video-id="${videoId}" data-video-src="${videoSrc}">
                            <span class="badge">VIDEO</span>
                            <video 
                                id="${videoId}"
                                src="${videoSrc}"
                                muted 
                                loop 
                                playsinline
                                preload="metadata"
                                webkit-playsinline="true"
                                x5-playsinline="true"
                                style="width: 100%; height: auto; display: block; object-fit: cover;"
                            ></video>
                        </div>
                    `;
                } else {
                    // æ¡Œé¢ç«¯ï¼šä¼˜åŒ–é¢„åŠ è½½ï¼Œä½¿ç”¨å°é¢å›¾å’Œ poster å±æ€§
                    mediaHTML = `
                        <div class="media-box video-container">
                            <span class="badge">VIDEO</span>
                            <div class="video-placeholder" id="${placeholderId}" style="display: flex;">
                                <img class="video-cover" src="${coverSrc}" alt="${item.title}" onerror="handleCoverError(this, '${item.file}');" loading="lazy">
                                <div class="play-button-large" style="display: none;"></div>
                            </div>
                            <video 
                                id="${videoId}"
                                src="${videoSrc}" 
                                poster="${coverSrc}"
                                muted 
                                loop 
                                playsinline
                                preload="auto"
                                onmouseover="handleVideoHover(this);" 
                                onmouseout="handleVideoHoverOut(this);"
                                onclick="handleVideoClick(this, event);"
                                oncanplay="handleVideoCanPlay(this);"
                                onplay="handleVideoPlay(this, '${placeholderId}');"
                            ></video>
                            <div class="play-button" style="display: none;">
                                â–¶
                            </div>
                        </div>
                    `;
                }
            } else {
                // å›¾ç‰‡
                mediaHTML = `
                    <div class="media-box">
                        <img src="${assetPath + item.file}" loading="lazy" alt="${item.title}">
                    </div>
                `;
            }

            // ä¼˜åŒ–ï¼šè§†é¢‘åŒºåŸŸç‚¹å‡»æ’­æ”¾ï¼Œæ–‡å­—åŒºåŸŸç‚¹å‡»è·³è½¬
            if (item.type === 'video') {
                card.innerHTML = `
                    ${mediaHTML}
                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" style="text-decoration:none; color:inherit;">
                        <div class="meta">
                            <div class="work-title">${item.title}</div>
                            <div class="work-desc">${item.desc}</div>
                        </div>
                    </a>
                `;
            } else {
                card.innerHTML = `
                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" style="text-decoration:none; color:inherit;">
                        ${mediaHTML}
                        <div class="meta">
                            <div class="work-title">${item.title}</div>
                            <div class="work-desc">${item.desc}</div>
                        </div>
                    </a>
                `;
            }

            gallery.appendChild(card);
            
            // ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾ï¼ˆæ»šåŠ¨åˆ°è§†å£æ—¶ï¼‰
            if (item.type === 'video' && isMobile) {
                // ç§»åŠ¨ç«¯è§†é¢‘ï¼šè®¾ç½®è‡ªåŠ¨æ’­æ”¾
                setTimeout(() => {
                    setupMobileVideoAutoplay(videoId, videoSrc);
                }, 100);
            }
            
            // ä¸ºè§†é¢‘æ·»åŠ åŠ è½½å®Œæˆäº‹ä»¶å¤„ç†ï¼ˆæ¡Œé¢ç«¯ä¼˜åŒ–ï¼‰
            if (item.type === 'video' && !isMobile) {
                const cardElement = gallery.lastElementChild;
                const video = cardElement.querySelector('video');
                const playButton = cardElement.querySelector('.play-button');
                const placeholder = cardElement.querySelector('.video-placeholder');
                
                if (video) {
                    // è§†é¢‘åŠ è½½æ•°æ®å®Œæˆ
                    video.addEventListener('loadeddata', function() {
                        this.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        this.style.display = 'block';
                    });
                    
                    // è§†é¢‘æ’­æ”¾æ—¶éšè—å ä½ç¬¦å’ŒæŒ‰é’®
                    video.addEventListener('play', function() {
                        this.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        if (playButton) {
                            playButton.style.display = 'none';
                        }
                        this.style.display = 'block';
                    });
                    
                    // è§†é¢‘åŠ è½½é”™è¯¯å¤„ç†
                    video.addEventListener('error', function() {
                        console.error('è§†é¢‘åŠ è½½é”™è¯¯:', this.src);
                        if (placeholder) {
                            const loadingDiv = placeholder.querySelector('.video-loading');
                            if (loadingDiv) {
                                loadingDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                            }
                        }
                    });
                }
            }
            });
            
            // åœ¨æ‰€æœ‰ä½œå“ç”Ÿæˆå®Œæˆåï¼Œç»Ÿä¸€è®¾ç½®æ‰€æœ‰ç§»åŠ¨ç«¯å›¾ç‰‡æ»‘åŠ¨å˜å½©è‰²
            if (isMobileDevice()) {
                setTimeout(() => {
                    const allImages = gallery.querySelectorAll('.item .media-box img:not(.video-cover)');
                    debugLog('æ‰¾åˆ°æ‰€æœ‰ç§»åŠ¨ç«¯å›¾ç‰‡:', allImages.length);
                    allImages.forEach((img, index) => {
                        debugLog(`è®¾ç½®ç¬¬ ${index + 1} å¼ å›¾ç‰‡å˜å½©è‰²:`, img.src);
                        setupMobileImageColor(img);
                    });
                }, 300);
            }
            
            // åˆå§‹åŒ–åˆ†ç±»ç­›é€‰åŠŸèƒ½
            initFilterButtons();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ– StarryCanvas
            initStarryCanvas();
            
            // ç”Ÿæˆä½œå“åˆ—è¡¨
            generateWorks();
        });
    </script>
    
    <!-- Decap CMS Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>

</body>
</html>