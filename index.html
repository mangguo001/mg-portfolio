<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MY WORK</title>
    <style>
        /* --- æç®€å·¥ä¸šé£æ ¼è®¾ç½® --- */
        :root {
            --bg-color: #F0F0F0;
            --text-color: #111;
            --card-bg: #FFF;
            --font-main: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            --font-mono: 'Courier New', Courier, monospace;
        }

        body {
            margin: 0;
            padding: 40px;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-main);
            overflow-x: hidden;
        }

        /* é¡¶éƒ¨ä»‹ç»åŒº */
 /* ========================================= */
        /* âœ… æ–°çš„ï¼šå¤´éƒ¨èƒŒæ™¯è§†é¢‘æ ·å¼ (æ›¿æ¢å¼€å§‹)       */
        /* ========================================= */
        
        header {
            position: relative; /* å…³é”®å®šä½ */
            height: 75vh;       /* é«˜åº¦å å±å¹• 75% */
            min-height: 500px;
            margin-bottom: 50px;
            overflow: hidden;   /* è£æ‰å¤šä½™è§†é¢‘ */
            display: flex;
            align-items: flex-end; /* å†…å®¹æ²‰åº• */
            color: white;       /* å¼ºåˆ¶æ–‡å­—å˜ç™½ */
        }

        /* 1. è§†é¢‘å±‚ (æœ€åº•å±‚) */
        .bg-video {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%); /* å±…ä¸­ */
            min-width: 100%; 
            min-height: 100%;
            width: auto; height: auto;
            z-index: 0;
            object-fit: cover; /* é“ºæ»¡ä¸å˜å½¢ */
        }

        /* 2. é®ç½©å±‚ (ä¸­é—´å±‚) - è®©æ–‡å­—æ›´æ¸…æ™° */
        .overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); /* 0.4 æ˜¯é»‘è‰²é€æ˜åº¦ï¼Œå¯è°ƒ */
            z-index: 1;
        }

        /* 3. å†…å®¹å±‚ (æœ€ä¸Šå±‚) */
        .header-content {
            position: relative;
            z-index: 2;
            width: 100%;
            padding: 40px; /* æ–‡å­—ç¦»è¾¹ç¼˜çš„è·ç¦» */
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            flex-wrap: wrap; /* æ‰‹æœºä¸Šå…è®¸æ¢è¡Œ */
            gap: 20px;
        }

        /* å¤´éƒ¨å¤§æ ‡é¢˜ */
        h1 {
            font-size: 6rem; /* å­—ä½“æ”¹å¤§ä¸€ç‚¹æ›´éœ¸æ°” */
            line-height: 0.85;
            margin: 0;
            letter-spacing: -3px;
            text-transform: uppercase;
            text-shadow: 0 10px 30px rgba(0,0,0,0.5); /* åŠ ç‚¹é˜´å½± */
        }

        /* å¤´éƒ¨ä»‹ç»æ–‡å­— */
        .intro {
            font-family: var(--font-mono);
            font-size: 1rem;
            max-width: 400px;
            line-height: 1.5;
            color: #eee; /* æµ…ç°ç™½ */
            text-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }

        /* æ‰‹æœºé€‚é…è°ƒæ•´ */
        @media (max-width: 768px) {
            header { height: 60vh; }
            h1 { font-size: 3.5rem; }
            .header-content { flex-direction: column; align-items: flex-start; }
        }

        /* ========================================= */
        /* âœ… æ–°çš„æ ·å¼ (æ›¿æ¢ç»“æŸ)                    */
        /* ========================================= */
        .intro {
            font-family: var(--font-mono);
            font-size: 0.9rem;
            max-width: 400px;
            line-height: 1.5;
        }

        /* åˆ†ç±»ç­›é€‰å™¨ */
        .filter-container {
            margin-bottom: 50px;
            padding: 0;
            width: 100%;
            max-width: 100%;
        }

        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            justify-content: flex-start;
            align-items: center;
            width: 100%;
        }

        .filter-btn {
            padding: 10px 20px;
            background: var(--card-bg);
            color: var(--text-color);
            border: 2px solid var(--text-color);
            border-radius: 8px;
            font-family: var(--font-mono);
            font-size: 0.85rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            backface-visibility: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            background: var(--text-color);
            color: var(--card-bg);
            border-color: var(--text-color);
        }

        .filter-btn.active {
            background: var(--text-color);
            color: var(--card-bg);
            border-color: var(--text-color);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
            font-weight: 700;
        }

        .filter-btn:active {
            transform: translateY(0);
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1);
        }

        /* æ— ç»“æœæç¤º */
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #999;
            font-family: var(--font-mono);
            grid-column: 1 / -1;
            font-size: 0.9rem;
        }

        /* ç€‘å¸ƒæµå¸ƒå±€ */
        .gallery {
            column-count: 3; /* ç”µè„‘æ˜¾ç¤º3åˆ— */
            column-gap: 20px;
        }

        /* å•ä¸ªä½œå“å¡ç‰‡ */
        .item {
            break-inside: avoid;
            background: var(--card-bg);
            margin-bottom: 20px;
            padding: 10px;
            box-shadow: 4px 4px 0 rgba(0,0,0,0.1); /* ç¡¬é˜´å½±æ›´æœ‰è®¾è®¡æ„Ÿ */
            transition: transform 0.2s ease;
            cursor: pointer;
        }

        .item:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0 rgba(0,0,0,0.2);
        }

        /* å›¾ç‰‡/è§†é¢‘å®¹å™¨ */
        .media-box {
            position: relative;
            width: 100%;
            background: #ddd; /* åŠ è½½å‰çš„å ä½è‰² */
            overflow: hidden;
        }
        
        /* æ¡Œé¢ç«¯ï¼šä¿æŒè‡ªé€‚åº”é«˜åº¦ï¼Œä½†è®¾ç½®æœ€å°é«˜åº¦é˜²æ­¢å¡Œé™· */
        @media (min-width: 769px) {
            .media-box {
                min-height: 200px; /* æœ€å°é«˜åº¦ï¼Œä½†ä¸å¼ºåˆ¶æ¯”ä¾‹ */
            }
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šç§»é™¤å›ºå®šæ¯”ä¾‹ï¼Œä½¿ç”¨è§†é¢‘åŸå§‹æ¯”ä¾‹ */
        @media (max-width: 768px) {
            .media-box {
                /* å®Œå…¨ç§»é™¤é«˜åº¦é™åˆ¶ï¼Œè®©è§†é¢‘å†…å®¹å†³å®šé«˜åº¦ */
                min-height: 0;
            }
            
            /* è§†é¢‘å®¹å™¨ä¸é™åˆ¶é«˜åº¦ */
            .video-container {
                min-height: 0;
            }
            
            /* éšè—ç§»åŠ¨ç«¯æ’­æ”¾æŒ‰é’® */
            .play-button-large {
                display: none !important;
            }
        }

        /* è§†é¢‘å®¹å™¨ç‰¹æ®Šå¤„ç† */
        .video-container {
            cursor: pointer;
        }

        /* æ’­æ”¾æŒ‰é’®ï¼ˆç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ */
        .play-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex; /* é»˜è®¤æ˜¾ç¤ºï¼Œæ¡Œé¢ç«¯éšè— */
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            z-index: 15; /* æé«˜å±‚çº§ç¡®ä¿å¯è§ */
            transition: all 0.3s ease;
            pointer-events: auto;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        .play-button:active {
            transform: translate(-50%, -50%) scale(0.95);
            background: rgba(0, 0, 0, 0.9);
        }

        /* è§†é¢‘å ä½ç¬¦ */
        .video-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #222;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            overflow: hidden;
        }
        
        /* å°é¢å›¾ */
        .video-cover {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            display: block; /* ç¡®ä¿å°é¢å›¾æ˜¾ç¤º */
        }
        
        /* å°é¢å›¾åŠ è½½å¤±è´¥æ—¶çš„å¤„ç† */
        .video-cover[src=""],
        .video-cover:not([src]) {
            display: none;
        }
        
        .video-placeholder .play-button-large {
            position: relative;
            z-index: 2;
        }

        .play-button-large {
            width: 80px;
            height: 80px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .play-button-large:active {
            transform: scale(0.95);
            background: rgba(0, 0, 0, 0.9);
        }

        /* è§†é¢‘åŠ è½½ä¸­æ˜¾ç¤º */
        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            z-index: 12;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .video-loading::before {
            content: '';
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .video-container video.ready {
            opacity: 1;
        }
        
        .video-container video.loading {
            opacity: 0.7;
        }

        /* è§†é¢‘æ’­æ”¾æ—¶éšè—å ä½ç¬¦å’ŒæŒ‰é’® */
        .video-container video.playing {
            z-index: 11;
        }

        .video-container video.playing ~ .video-placeholder,
        .video-container video.playing ~ .play-button {
            display: none !important;
            pointer-events: none !important;
        }
        
        /* æ¡Œé¢ç«¯ï¼šç¡®ä¿å ä½ç¬¦ä¸ä¼šé˜»æŒ¡è§†é¢‘å…ƒç´ çš„é¼ æ ‡äº‹ä»¶ */
        @media (min-width: 769px) {
            .video-placeholder {
                pointer-events: none !important;
            }
        }

        /* ç¡®ä¿å›¾ç‰‡è§†é¢‘é“ºæ»¡ */
        .media-box img,
        .media-box video {
            width: 100%;
            display: block;
            object-fit: cover;
            filter: grayscale(100%); /* é»˜è®¤é»‘ç™½ */
            transition: filter 0.3s;
        }
        
        /* æ¡Œé¢ç«¯ï¼šå›¾ç‰‡å’Œè§†é¢‘ä¿æŒè‡ªç„¶é«˜åº¦ */
        @media (min-width: 769px) {
            .media-box img,
            .media-box video {
                height: auto; /* æ¡Œé¢ç«¯è‡ªé€‚åº”é«˜åº¦ */
            }
        }
        
        /* ç§»åŠ¨ç«¯ï¼šå›¾ç‰‡å’Œè§†é¢‘ä¿æŒåŸå§‹æ¯”ä¾‹ */
        @media (max-width: 768px) {
            /* è§†é¢‘å®¹å™¨å†…çš„è§†é¢‘ä¿æŒåŸå§‹æ¯”ä¾‹ */
            .video-container {
                position: relative;
                min-height: 0;
            }
            
            .video-container video {
                position: relative;
                width: 100%;
                height: auto;
                display: block;
                object-fit: contain; /* ä¿æŒæ¯”ä¾‹ï¼Œä¸è£å‰ª */
            }
            
            /* å›¾ç‰‡ä¿æŒåŸå§‹æ¯”ä¾‹ */
            .media-box > img:not(.video-cover) {
                position: relative;
                height: auto;
                width: 100%;
            }
            
            /* å°é¢å›¾å ä½ç¬¦ */
            .video-placeholder {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .video-placeholder .video-cover {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            /* å½“è§†é¢‘æ’­æ”¾æ—¶ï¼Œç¡®ä¿è§†é¢‘åœ¨ä¸Šå±‚ */
            .video-container video[style*="display: block"],
            .video-container video.playing {
                position: relative;
                z-index: 2;
            }
        }

        /* é¼ æ ‡æ‚¬åœå˜å½©è‰² */
        .item:hover img, .item:hover video {
            filter: grayscale(0%);
        }

        /* è§†é¢‘æ ‡è¯†å°æ ‡ç­¾ */
        .badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #FF3333;
            color: white;
            font-size: 10px;
            padding: 3px 6px;
            font-weight: bold;
            font-family: var(--font-mono);
            z-index: 10;
            pointer-events: none;
        }

        /* æ–‡å­—ä¿¡æ¯ */
        .meta {
            margin-top: 12px;
        }
        .work-title {
            font-weight: 700;
            font-size: 1.1rem;
            text-transform: uppercase;
        }
        .work-desc {
            font-family: var(--font-mono);
            font-size: 0.8rem;
            color: #666;
            margin-top: 4px;
        }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 768px) {
            .filter-container {
                margin-bottom: 30px;
                padding: 0;
            }
            
            .filter-buttons {
                gap: 8px;
                justify-content: flex-start;
            }
            
            .filter-btn {
                padding: 8px 16px;
                font-size: 0.75rem;
                border-radius: 6px;
            }
            
            .gallery { column-count: 1; } /* æ‰‹æœºå˜1åˆ— */
            h1 { font-size: 3rem; }
            body { padding: 20px; }
            
            /* ç§»åŠ¨ç«¯æ˜¾ç¤ºæ’­æ”¾æŒ‰é’® */
            .play-button {
                display: flex;
            }
            
            /* ç§»åŠ¨ç«¯ç‚¹å‡»æ—¶è§†é¢‘æ’­æ”¾ï¼Œéšè—æŒ‰é’® */
            .video-container:active .play-button {
                opacity: 0;
                transition: opacity 0.2s;
            }
            
            /* ç§»åŠ¨ç«¯è§†é¢‘ç‚¹å‡»æ’­æ”¾ */
            .video-container video {
                cursor: pointer;
            }
        }

        /* æ¡Œé¢ç«¯éšè—æ’­æ”¾æŒ‰é’® */
        @media (min-width: 769px) {
            .play-button {
                display: none !important;
            }
            
            .video-placeholder {
                display: none;
            }
        }
        
        /* ç§»åŠ¨ç«¯ï¼šç¡®ä¿å ä½ç¬¦å’Œå°é¢å›¾æ˜¾ç¤º */
        @media (max-width: 768px) {
            .video-placeholder {
                display: flex !important;
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 10;
                background: #222; /* ç¡®ä¿æœ‰èƒŒæ™¯è‰² */
            }
            
            .video-container video {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            
            .video-cover {
                display: block !important;
                width: 100% !important;
                height: 100% !important;
                object-fit: cover;
            }
            
            /* ç¡®ä¿ç§»åŠ¨ç«¯å›¾ç‰‡ä¹Ÿèƒ½æ­£ç¡®æ˜¾ç¤º */
            .media-box img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }
        }
        
        
    </style>
</head>
<body>

    <!-- ========================================= -->
    <!-- âœ… æ–°çš„ï¼šå¤´éƒ¨ç»“æ„ (æ›¿æ¢å¼€å§‹)               -->
    <!-- ========================================= -->
    <header>
        <!-- 1. èƒŒæ™¯è§†é¢‘ (å¿…é¡»é™éŸ³ muted æ‰èƒ½è‡ªåŠ¨æ’­æ”¾) -->
        <video class="bg-video" autoplay muted loop playsinline>
            <!-- âš ï¸ ç¡®ä¿ä½ çš„ assets æ–‡ä»¶å¤¹é‡Œæœ‰ header-bg.mp4 -->
            <source src="./assets/header-bg.mp4" type="video/mp4">
        </video>

        <!-- 2. é»‘è‰²é®ç½© -->
        <div class="overlay"></div>

        <!-- 3. æ–‡å­—å†…å®¹ -->
        <div class="header-content">
            <!-- ğŸ‘‡ è¿™é‡Œæ”¹å¤§æ ‡é¢˜ -->
            <h1>
                MG-mango<br>Portfolio.
            </h1>
            
            <!-- ğŸ‘‡ è¿™é‡Œæ”¹å³ä¸‹è§’çš„ä»‹ç» -->
            <div class="intro">
                æ…¢å·¥è‰ºæœ¯.<br>
                å¹³PING & èŠ’æœå°å­.<br>
                æ•°å­—è‰ºæœ¯åˆ›ä½œè€….<br>
                æ¹–åŒ—æ­¦æ±‰.<br>
                ğŸ›°VXï¼šmango130p<br>
            </div>
        </div>
    </header>
    <!-- ========================================= -->
    <!-- âœ… æ–°çš„ç»“æ„ (æ›¿æ¢ç»“æŸ)                    -->
    <!-- ========================================= -->

    <!-- åˆ†ç±»ç­›é€‰å™¨ -->
    <div class="filter-container">
        <div class="filter-buttons">
            <button class="filter-btn active" data-category="all">å…¨éƒ¨</button>
            <button class="filter-btn" data-category="åŠ¨ç”»">åŠ¨ç”»</button>
            <button class="filter-btn" data-category="ç»˜ç”»">ç»˜ç”»</button>
            <button class="filter-btn" data-category="äº¤äº’">äº¤äº’</button>
            <button class="filter-btn" data-category="è®¾è®¡">è®¾è®¡</button>
        </div>
    </div>

    <!-- ä½œå“å±•ç¤ºåŒº -->
    <div class="gallery" id="app"></div>

    <script>
        // ========================================================
        // ğŸ¬ è§†é¢‘æ’­æ”¾æ§åˆ¶å‡½æ•°ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
        // ========================================================
        
        // æ£€æµ‹æ˜¯å¦ä¸ºç§»åŠ¨ç«¯
        function isMobileDevice() {
            return window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        // ç”Ÿæˆå°é¢å›¾è·¯å¾„
        function getCoverImagePath(videoFile, coverFile, assetPath) {
            // å¦‚æœ JSON ä¸­æŒ‡å®šäº†å°é¢å›¾ï¼Œç›´æ¥ä½¿ç”¨
            if (coverFile && coverFile.trim() !== '') {
                return assetPath + coverFile;
            }
            
            // å¦åˆ™ä»è§†é¢‘æ–‡ä»¶åç”Ÿæˆå°é¢å›¾è·¯å¾„
            // æ”¯æŒå¤šç§æ ¼å¼ï¼šdemo_video.mp4 -> demo_video.jpg / demo_video_cover.jpg / demo_video.png
            const baseName = videoFile.replace(/\.[^/.]+$/, ''); // å»æ‰æ‰©å±•å
            
            // å°è¯•å¸¸è§çš„å°é¢å›¾å‘½åè§„åˆ™
            // ä¼˜å…ˆï¼šåŸæ–‡ä»¶å + _cover.jpg
            // å…¶æ¬¡ï¼šåŸæ–‡ä»¶å + .jpg
            return assetPath + baseName + '_cover.jpg';
        }
        
        // åŠ è½½å¹¶æ’­æ”¾è§†é¢‘ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ– - ç‚¹å‡»ååŠ è½½ï¼‰
        function loadAndPlayVideo(videoId, videoSrc, placeholderId) {
            const video = document.getElementById(videoId);
            const placeholder = placeholderId ? document.getElementById(placeholderId) : null;
            
            if (!video) {
                console.error('è§†é¢‘å…ƒç´ ä¸å­˜åœ¨:', videoId);
                return;
            }
            
            // å¦‚æœè§†é¢‘æ­£åœ¨åŠ è½½æˆ–æ’­æ”¾ï¼Œç›´æ¥è¿”å›
            if (video.classList.contains('loading') || (!video.paused && video.readyState >= 2)) {
                return;
            }
            
            // å¦‚æœè§†é¢‘è¿˜æ²¡æœ‰åŠ è½½ï¼Œå…ˆåŠ è½½è§†é¢‘æº
            const currentSrc = video.src || video.getAttribute('src') || '';
            if (!currentSrc || currentSrc !== videoSrc) {
                // æ ‡è®°ä¸ºåŠ è½½ä¸­
                video.classList.add('loading');
                
                // æ˜¾ç¤ºåŠ è½½æç¤ºï¼ˆå¦‚æœè¿˜æ²¡æœ‰ï¼‰
                if (placeholder) {
                    let loadingDiv = placeholder.querySelector('.video-loading');
                    if (!loadingDiv) {
                        loadingDiv = document.createElement('div');
                        loadingDiv.className = 'video-loading';
                        loadingDiv.textContent = 'åŠ è½½ä¸­...';
                        placeholder.appendChild(loadingDiv);
                    } else {
                        loadingDiv.textContent = 'åŠ è½½ä¸­...';
                        loadingDiv.style.display = 'block';
                    }
                    // éšè—æ’­æ”¾æŒ‰é’®
                    const playBtn = placeholder.querySelector('.play-button-large');
                    if (playBtn) {
                        playBtn.style.display = 'none';
                    }
                    placeholder.style.display = 'flex';
                }
                
                // è®¾ç½®è§†é¢‘æºå¹¶åŠ è½½
                video.setAttribute('src', videoSrc);
                video.load();
                
                // ç­‰å¾…è§†é¢‘å¯ä»¥æ’­æ”¾ï¼ˆcanplay æ¯” loadeddata æ›´å¥½ï¼Œç¡®ä¿å¯ä»¥æ’­æ”¾ï¼‰
                const onCanPlay = function() {
                    video.classList.remove('loading');
                    video.classList.add('playing');
                    
                    if (placeholder) {
                        const loadingDiv = placeholder.querySelector('.video-loading');
                        if (loadingDiv) {
                            loadingDiv.remove();
                        }
                        // éšè—å°é¢å›¾
                        const coverImg = placeholder.querySelector('.video-cover');
                        if (coverImg) {
                            coverImg.style.display = 'none';
                        }
                        placeholder.style.display = 'none';
                    }
                    video.style.display = 'block';
                    
                    // å¼€å§‹æ’­æ”¾
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('è§†é¢‘æ’­æ”¾æˆåŠŸ');
                        }).catch(err => {
                            console.log('æ’­æ”¾å¤±è´¥:', err);
                            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºæ’­æ”¾æŒ‰é’®
                            if (placeholder) {
                                placeholder.style.display = 'flex';
                                const playBtn = placeholder.querySelector('.play-button-large');
                                if (playBtn) {
                                    playBtn.style.display = 'flex';
                                }
                            }
                        });
                    }
                };
                
                video.addEventListener('canplay', onCanPlay, { once: true });
                
                // ä¹Ÿç›‘å¬ loadeddata ä½œä¸ºå¤‡é€‰
                const onLoadedData = function() {
                    if (video.readyState >= 2 && !video.classList.contains('playing')) {
                        // å¦‚æœ canplay è¿˜æ²¡è§¦å‘ï¼Œç­‰å¾…ä¸€ä¸‹
                        setTimeout(() => {
                            if (!video.classList.contains('playing') && video.readyState >= 2) {
                                onCanPlay();
                            }
                        }, 100);
                    }
                };
                video.addEventListener('loadeddata', onLoadedData, { once: true });
                
                // é”™è¯¯å¤„ç†
                const onError = function(e) {
                    console.error('è§†é¢‘åŠ è½½é”™è¯¯:', e, videoSrc);
                    video.classList.remove('loading');
                    if (placeholder) {
                        const loadingDiv = placeholder.querySelector('.video-loading');
                        if (loadingDiv) {
                            loadingDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                        } else {
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'video-loading';
                            errorDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                            placeholder.appendChild(errorDiv);
                        }
                        const playBtn = placeholder.querySelector('.play-button-large');
                        if (playBtn) {
                            playBtn.style.display = 'flex';
                        }
                        placeholder.style.display = 'flex';
                    }
                    // æ¸…é™¤é”™è¯¯çš„ src
                    video.removeAttribute('src');
                    video.load();
                };
                
                video.addEventListener('error', onError, { once: true });
            } else {
                // è§†é¢‘å·²åŠ è½½ï¼Œç›´æ¥æ’­æ”¾
                if (placeholder) {
                    // éšè—å°é¢å›¾
                    const coverImg = placeholder.querySelector('.video-cover');
                    if (coverImg) {
                        coverImg.style.display = 'none';
                    }
                    placeholder.style.display = 'none';
                }
                video.style.display = 'block';
                video.classList.add('playing');
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.catch(err => {
                        console.log('æ’­æ”¾å¤±è´¥:', err);
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                            const coverImg = placeholder.querySelector('.video-cover');
                            if (coverImg) {
                                coverImg.style.display = 'block';
                            }
                        }
                    });
                }
            }
        }
        
        // ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾è®¾ç½®ï¼ˆä½¿ç”¨ Intersection Observerï¼‰
        function setupMobileVideoAutoplay(videoId, videoSrc, placeholderId) {
            console.log('è®¾ç½®ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾:', videoId);
            const container = document.querySelector(`[data-video-id="${videoId}"]`);
            if (!container) {
                console.error('æ‰¾ä¸åˆ°å®¹å™¨:', videoId);
                return;
            }
            
            const video = document.getElementById(videoId);
            const placeholder = document.getElementById(placeholderId);
            
            if (!video || !placeholder) {
                console.error('æ‰¾ä¸åˆ°è§†é¢‘æˆ–å ä½ç¬¦:', { videoId, placeholderId });
                return;
            }
            
            console.log('å¼€å§‹ç›‘å¬è§†é¢‘:', videoId);
            
            // åˆ›å»º Intersection Observer
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // è¿›å…¥è§†å£ï¼Œè‡ªåŠ¨æ’­æ”¾
                        autoPlayMobileVideo(video, videoSrc, placeholder);
                    } else {
                        // ç¦»å¼€è§†å£ï¼Œæš‚åœè§†é¢‘
                        if (!video.paused) {
                            video.pause();
                            video.currentTime = 0;
                            // æ˜¾ç¤ºå°é¢å›¾
                            if (placeholder) {
                                placeholder.style.display = 'flex';
                                const coverImg = placeholder.querySelector('.video-cover');
                                if (coverImg) {
                                    coverImg.style.display = 'block';
                                }
                            }
                            video.style.display = 'none';
                        }
                    }
                });
            }, {
                threshold: 0.2, // å½“20%çš„è§†é¢‘åŒºåŸŸè¿›å…¥è§†å£æ—¶è§¦å‘ï¼ˆæ›´å®¹æ˜“è§¦å‘ï¼‰
                rootMargin: '100px' // æå‰100pxå¼€å§‹åŠ è½½ï¼Œæå‡ä½“éªŒ
            });
            
            observer.observe(container);
        }
        
        // ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾å‡½æ•°
        function autoPlayMobileVideo(video, videoSrc, placeholder) {
            console.log('å°è¯•è‡ªåŠ¨æ’­æ”¾è§†é¢‘:', video.id, 'å½“å‰çŠ¶æ€:', {
                paused: video.paused,
                readyState: video.readyState,
                src: video.src
            });
            
            // å¦‚æœè§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œç›´æ¥è¿”å›
            if (!video.paused && video.readyState >= 2) {
                console.log('è§†é¢‘å·²åœ¨æ’­æ”¾ï¼Œè·³è¿‡');
                return;
            }
            
            // å¦‚æœè§†é¢‘è¿˜æ²¡åŠ è½½ï¼Œå…ˆåŠ è½½è§†é¢‘æº
            const currentSrc = video.src || video.getAttribute('data-src') || '';
            if (!currentSrc || currentSrc !== videoSrc) {
                video.src = videoSrc;
                video.load();
                
                // ç­‰å¾…è§†é¢‘å¯ä»¥æ’­æ”¾
                const onCanPlay = function() {
                    video.removeEventListener('canplay', onCanPlay);
                    
                    // å…ˆæ˜¾ç¤ºè§†é¢‘ï¼Œç¡®ä¿å¯è§
                    video.style.display = 'block';
                    video.style.position = 'relative';
                    video.style.zIndex = '2';
                    
                    // éšè—å°é¢å›¾
                    if (placeholder) {
                        placeholder.style.display = 'none';
                        placeholder.style.zIndex = '1';
                    }
                    
                    // å¼€å§‹æ’­æ”¾
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
                        }).catch(err => {
                            console.log('è‡ªåŠ¨æ’­æ”¾å¤±è´¥:', err);
                            // å¦‚æœè‡ªåŠ¨æ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºå°é¢å›¾
                            if (placeholder) {
                                placeholder.style.display = 'flex';
                            }
                            video.style.display = 'none';
                        });
                    }
                };
                
                video.addEventListener('canplay', onCanPlay, { once: true });
            } else {
                // è§†é¢‘å·²åŠ è½½ï¼Œç›´æ¥æ’­æ”¾
                video.style.display = 'block';
                video.style.position = 'relative';
                video.style.zIndex = '2';
                
                if (placeholder) {
                    placeholder.style.display = 'none';
                    placeholder.style.zIndex = '1';
                }
                
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        console.log('ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
                    }).catch(err => {
                        console.log('æ’­æ”¾å¤±è´¥:', err);
                        // å¦‚æœæ’­æ”¾å¤±è´¥ï¼Œæ˜¾ç¤ºå°é¢å›¾
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                        }
                        video.style.display = 'none';
                    });
                }
            }
        }
        
        // æ’­æ”¾è§†é¢‘ï¼ˆæ¡Œé¢ç«¯æˆ–å·²åŠ è½½çš„è§†é¢‘ï¼‰
        function playVideo(videoId) {
            const video = document.getElementById(videoId);
            if (video) {
                const playButton = video.closest('.video-container').querySelector('.play-button');
                video.classList.add('playing');
                video.play().then(() => {
                    if (playButton) {
                        playButton.style.display = 'none';
                    }
                }).catch(err => {
                    console.log('æ’­æ”¾å¤±è´¥:', err);
                });
            }
        }

        // å¤„ç†è§†é¢‘ç‚¹å‡»ï¼ˆç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯ï¼‰
        function handleVideoClick(video, event) {
            if (event) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ä¸”è§†é¢‘æœªåŠ è½½ï¼Œå°è¯•åŠ è½½
            if (isMobileDevice() && (!video.src || video.src === '')) {
                const container = video.closest('.video-container');
                const placeholder = container ? container.querySelector('.video-placeholder') : null;
                const placeholderId = placeholder ? placeholder.id : null;
                const videoSrc = container ? container.getAttribute('data-video-src') : null;
                if (videoSrc && placeholderId) {
                    loadAndPlayVideo(video.id, videoSrc, placeholderId);
                }
                return;
            }
            
            const container = video.closest('.video-container');
            const playButton = container ? container.querySelector('.play-button') : null;
            
            if (video.paused) {
                // éšè—å°é¢å›¾
                const placeholder = container ? container.querySelector('.video-placeholder') : null;
                if (placeholder) {
                    placeholder.style.display = 'none';
                }
                video.classList.add('playing');
                video.play().then(() => {
                    if (playButton) {
                        playButton.style.display = 'none';
                    }
                }).catch(err => {
                    console.log('æ’­æ”¾å¤±è´¥:', err);
                    // æ’­æ”¾å¤±è´¥æ—¶æ˜¾ç¤ºå°é¢å›¾
                    if (placeholder) {
                        placeholder.style.display = 'flex';
                    }
                });
            } else {
                video.classList.remove('playing');
                video.pause();
                // å¦‚æœå›åˆ°å¼€å¤´ï¼Œæ˜¾ç¤ºå°é¢å›¾
                if (video.currentTime === 0) {
                    const placeholder = container ? container.querySelector('.video-placeholder') : null;
                    if (placeholder) {
                        placeholder.style.display = 'flex';
                    }
                }
                if (playButton && window.innerWidth <= 768) {
                    playButton.style.display = 'flex';
                }
            }
        }

        // å¤„ç†è§¦æ‘¸å¼€å§‹ï¼ˆç§»åŠ¨ç«¯ï¼‰
        let touchStartTime = 0;
        function handleVideoTouchStart(video) {
            touchStartTime = Date.now();
        }

        // å¤„ç†è§¦æ‘¸ç»“æŸï¼ˆç§»åŠ¨ç«¯ï¼‰
        function handleVideoTouchEnd(video, event) {
            const touchDuration = Date.now() - touchStartTime;
            // çŸ­æŒ‰ï¼ˆå°äº300msï¼‰è§†ä¸ºç‚¹å‡»ï¼Œæ’­æ”¾è§†é¢‘
            if (touchDuration < 300) {
                if (event) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ä¸”è§†é¢‘æœªåŠ è½½ï¼Œå…ˆåŠ è½½å†æ’­æ”¾
                if (isMobileDevice() && (!video.src || video.src === '')) {
                    const container = video.closest('.video-container');
                    const placeholder = container ? container.querySelector('.video-placeholder') : null;
                    const placeholderId = placeholder ? placeholder.id : null;
                    const videoSrc = container ? container.getAttribute('data-video-src') : null;
                    if (videoSrc && placeholderId) {
                        loadAndPlayVideo(video.id, videoSrc, placeholderId);
                    }
                } else {
                    handleVideoClick(video);
                }
            }
        }
        
        // å¤„ç†è§†é¢‘æ‚¬åœï¼ˆæ¡Œé¢ç«¯ä¼˜åŒ–ï¼‰
        function handleVideoHover(video) {
            console.log('handleVideoHover è§¦å‘', {
                paused: video.paused,
                currentTime: video.currentTime,
                readyState: video.readyState
            });
            
            // å¦‚æœè§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œä¸åšä»»ä½•æ“ä½œ
            if (!video.paused && video.currentTime > 0.5) {
                console.log('è§†é¢‘æ­£åœ¨æ’­æ”¾ï¼Œè·³è¿‡');
                return;
            }
            
            const container = video.closest('.video-container');
            const placeholder = container ? container.querySelector('.video-placeholder') : null;
            
            // ç«‹å³éšè—å ä½ç¬¦ï¼Œå¹¶ç¦ç”¨æŒ‡é’ˆäº‹ä»¶
            if (placeholder) {
                placeholder.style.display = 'none';
                placeholder.style.setProperty('display', 'none', 'important');
                placeholder.style.pointerEvents = 'none';
                placeholder.style.zIndex = '1'; // é™ä½å ä½ç¬¦å±‚çº§
                console.log('å ä½ç¬¦å·²éšè—');
            }
            
            // ç¡®ä¿è§†é¢‘å…ƒç´ å¯è§ä¸”åœ¨ä¸Šå±‚
            video.style.display = 'block';
            video.style.zIndex = '11';
            video.style.pointerEvents = 'auto';
            
            // å¼ºåˆ¶é‡ç½®è§†é¢‘çŠ¶æ€ï¼šå…ˆæš‚åœï¼Œå†é‡ç½®æ—¶é—´
            video.pause();
            video.currentTime = 0;
            
            // ç­‰å¾…é‡ç½®å®Œæˆåå†å°è¯•æ’­æ”¾
            const tryPlay = () => {
                // ç¡®ä¿å ä½ç¬¦å·²éšè—ä¸”ä¸ä¼šé˜»æŒ¡é¼ æ ‡äº‹ä»¶
                if (placeholder) {
                    placeholder.style.display = 'none';
                    placeholder.style.setProperty('display', 'none', 'important');
                    placeholder.style.pointerEvents = 'none';
                    placeholder.style.zIndex = '1';
                }
                
                // ç¡®ä¿è§†é¢‘å¯è§ä¸”å¯ä»¥æ¥æ”¶é¼ æ ‡äº‹ä»¶
                video.style.display = 'block';
                video.style.zIndex = '11';
                video.style.pointerEvents = 'auto';
                
                // å†æ¬¡å¼ºåˆ¶é‡ç½®çŠ¶æ€
                if (!video.paused) {
                    video.pause();
                }
                if (video.currentTime > 0.1) {
                    video.currentTime = 0;
                }
                
                console.log('å°è¯•æ’­æ”¾ï¼Œè§†é¢‘çŠ¶æ€:', {
                    paused: video.paused,
                    currentTime: video.currentTime,
                    readyState: video.readyState,
                    display: video.style.display,
                    zIndex: video.style.zIndex
                });
                
                // å°è¯•æ’­æ”¾
                const playPromise = video.play();
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        // æ’­æ”¾æˆåŠŸ
                        console.log('æ’­æ”¾æˆåŠŸï¼');
                        video.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                            placeholder.style.setProperty('display', 'none', 'important');
                            placeholder.style.pointerEvents = 'none';
                        }
                    }).catch(err => {
                        console.log('æ’­æ”¾å¤±è´¥:', err, 'è§†é¢‘çŠ¶æ€:', {
                            paused: video.paused,
                            readyState: video.readyState,
                            currentTime: video.currentTime,
                            networkState: video.networkState
                        });
                        
                        // ä¸ç«‹å³æ˜¾ç¤ºå ä½ç¬¦ï¼Œå…ˆå°è¯•é‡è¯•
                        // é‡ç½®è§†é¢‘çŠ¶æ€å¹¶é‡è¯•æ’­æ”¾
                        video.currentTime = 0;
                        
                        // ç¬¬ä¸€æ¬¡é‡è¯•
                        setTimeout(() => {
                            const retryPromise = video.play();
                            if (retryPromise !== undefined) {
                                retryPromise.then(() => {
                                    // é‡è¯•æˆåŠŸ
                                    console.log('ç¬¬ä¸€æ¬¡é‡è¯•æˆåŠŸï¼');
                                    video.classList.add('playing');
                                    if (placeholder) {
                                        placeholder.style.display = 'none';
                                        placeholder.style.setProperty('display', 'none', 'important');
                                        placeholder.style.pointerEvents = 'none';
                                    }
                                }).catch(retryErr => {
                                    console.log('ç¬¬ä¸€æ¬¡é‡è¯•å¤±è´¥:', retryErr, 'è§†é¢‘çŠ¶æ€:', {
                                        paused: video.paused,
                                        readyState: video.readyState,
                                        currentTime: video.currentTime
                                    });
                                    // å†æ¬¡é‡è¯•
                                    setTimeout(() => {
                                        video.currentTime = 0;
                                        const secondRetryPromise = video.play();
                                        if (secondRetryPromise !== undefined) {
                                            secondRetryPromise.then(() => {
                                                console.log('ç¬¬äºŒæ¬¡é‡è¯•æˆåŠŸï¼');
                                                video.classList.add('playing');
                                                if (placeholder) {
                                                    placeholder.style.display = 'none';
                                                    placeholder.style.setProperty('display', 'none', 'important');
                                                    placeholder.style.pointerEvents = 'none';
                                                }
                                            }).catch(() => {
                                                console.log('æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œæœ€ç»ˆè§†é¢‘çŠ¶æ€:', {
                                                    paused: video.paused,
                                                    readyState: video.readyState,
                                                    currentTime: video.currentTime,
                                                    networkState: video.networkState
                                                });
                                                // æ‰€æœ‰é‡è¯•éƒ½å¤±è´¥ï¼Œæ‰æ˜¾ç¤ºå ä½ç¬¦
                                                if (placeholder) {
                                                    placeholder.style.display = 'flex';
                                                    video.style.zIndex = '1';
                                                }
                                                video.classList.remove('playing');
                                            });
                                        }
                                    }, 200);
                                });
                            }
                        }, 100);
                    });
                } else {
                    // ç›´æ¥æ’­æ”¾ï¼ˆæ—§æµè§ˆå™¨ï¼‰
                    try {
                        video.play();
                        video.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                    } catch (e) {
                        console.log('æ’­æ”¾å¤±è´¥:', e);
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                        }
                    }
                }
            };
            
            // ç­‰å¾…è§†é¢‘çŠ¶æ€é‡ç½®å®Œæˆåå†å°è¯•æ’­æ”¾
            // ä½¿ç”¨ seeked äº‹ä»¶ç¡®ä¿æ—¶é—´é‡ç½®å®Œæˆ
            const onSeeked = () => {
                video.removeEventListener('seeked', onSeeked);
                setTimeout(() => {
                    tryPlay();
                }, 50);
            };
            
            // å¦‚æœè§†é¢‘å·²ç»åœ¨å¼€å¤´ï¼Œç›´æ¥å°è¯•æ’­æ”¾
            if (video.currentTime < 0.1) {
                setTimeout(() => {
                    tryPlay();
                }, 50);
            } else {
                // éœ€è¦ç­‰å¾… seeked äº‹ä»¶
                video.addEventListener('seeked', onSeeked, { once: true });
                video.currentTime = 0;
            }
        }
        
        // å¤„ç†è§†é¢‘æ‚¬åœç¦»å¼€ï¼ˆæ¡Œé¢ç«¯ï¼‰
        function handleVideoHoverOut(video) {
            // æš‚åœè§†é¢‘
            if (!video.paused) {
                video.pause();
            }
            // ç§»é™¤æ’­æ”¾çŠ¶æ€ç±»
            video.classList.remove('playing');
            
            // é‡ç½®åˆ°å¼€å¤´ï¼ˆä¸é‡æ–°åŠ è½½è§†é¢‘ï¼Œä¿æŒè§†é¢‘å·²åŠ è½½çŠ¶æ€ï¼‰
            if (video.currentTime > 0.1) {
                video.currentTime = 0;
            }
            
            // æ˜¾ç¤ºå°é¢å›¾å’Œå ä½ç¬¦
            setTimeout(() => {
                const container = video.closest('.video-container');
                if (container) {
                    const placeholder = container.querySelector('.video-placeholder');
                    if (placeholder) {
                        // æ˜¾ç¤ºå ä½ç¬¦ï¼Œä½†ä¸è®©å®ƒé˜»æŒ¡é¼ æ ‡äº‹ä»¶ï¼ˆå› ä¸ºæ¡Œé¢ç«¯æ‚¬åœäº‹ä»¶åœ¨è§†é¢‘ä¸Šï¼‰
                        // æ¡Œé¢ç«¯å ä½ç¬¦åªæ˜¯è§†è§‰æ˜¾ç¤ºï¼Œå®é™…é¼ æ ‡äº‹ä»¶ç”±è§†é¢‘å…ƒç´ æ¥æ”¶
                        placeholder.style.display = 'flex';
                        placeholder.style.setProperty('display', 'flex', 'important');
                        placeholder.style.pointerEvents = 'none'; // å…³é”®ï¼šä¸é˜»æŒ¡é¼ æ ‡äº‹ä»¶
                        placeholder.style.zIndex = '10';
                        // ç¡®ä¿å°é¢å›¾ä¹Ÿæ˜¾ç¤º
                        const coverImg = placeholder.querySelector('.video-cover');
                        if (coverImg) {
                            coverImg.style.display = 'block';
                        }
                    }
                    // é™ä½è§†é¢‘ z-indexï¼Œä½†ä»ä¿æŒå¯æ¥æ”¶é¼ æ ‡äº‹ä»¶
                    video.style.zIndex = '1';
                    video.style.pointerEvents = 'auto';
                }
            }, 50); // çŸ­å»¶è¿Ÿç¡®ä¿é‡ç½®å®Œæˆ
        }
        
        // å¤„ç†è§†é¢‘å¯ä»¥æ’­æ”¾ï¼ˆä¼˜åŒ–ç¼“å†²ï¼‰
        function handleVideoCanPlay(video) {
            // ç¡®ä¿è§†é¢‘ç¼“å†²è¶³å¤Ÿå†å…è®¸æ’­æ”¾
            if (video.buffered.length > 0 && video.buffered.end(0) > 1) {
                video.classList.add('ready');
            }
        }
        
        // å¤„ç†è§†é¢‘æ’­æ”¾æ—¶éšè—å°é¢å›¾
        function handleVideoPlay(video, placeholderId) {
            const placeholder = placeholderId ? document.getElementById(placeholderId) : null;
            if (placeholder) {
                placeholder.style.display = 'none';
                const coverImg = placeholder.querySelector('.video-cover');
                if (coverImg) {
                    coverImg.style.display = 'none';
                }
            }
            // ç¡®ä¿è§†é¢‘åœ¨ä¸Šå±‚
            if (video && video.style) {
                video.style.zIndex = '11';
            }
        }
        
        // å¤„ç†è§†é¢‘æš‚åœæ—¶æ˜¾ç¤ºå°é¢å›¾ï¼ˆæ¡Œé¢ç«¯ï¼‰
        function handleVideoPause(video, placeholderId) {
            const placeholder = placeholderId ? document.getElementById(placeholderId) : null;
            if (placeholder && video.currentTime === 0) {
                placeholder.style.display = 'flex';
            }
        }
        
        // å¤„ç†å°é¢å›¾åŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ ¼å¼
        function handleCoverError(img, videoFile) {
            const src = img.src;
            const baseName = videoFile.replace(/\.[^/.]+$/, '');
            const assetPath = './assets/';
            
            console.log('å°é¢å›¾åŠ è½½å¤±è´¥ï¼Œå°è¯•å…¶ä»–æ ¼å¼:', src);
            
            // å¦‚æœå½“å‰æ˜¯ _cover.jpgï¼Œå°è¯• .jpg
            if (src.includes('_cover.jpg')) {
                img.src = assetPath + baseName + '.jpg';
                img.onerror = function() {
                    // .jpg ä¹Ÿå¤±è´¥äº†ï¼Œå°è¯• .png
                    this.src = assetPath + baseName + '.png';
                    this.onerror = function() {
                        // æ‰€æœ‰æ ¼å¼éƒ½å¤±è´¥ï¼Œéšè—å›¾ç‰‡ï¼Œæ˜¾ç¤ºå ä½èƒŒæ™¯
                        console.log('æ‰€æœ‰å°é¢å›¾æ ¼å¼éƒ½åŠ è½½å¤±è´¥');
                        this.style.display = 'none';
                        // ç¡®ä¿å ä½ç¬¦ä»ç„¶æ˜¾ç¤º
                        const placeholder = this.closest('.video-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'flex';
                            placeholder.style.background = '#222';
                        }
                    };
                };
                return;
            }
            
            // å¦‚æœå½“å‰æ˜¯ .jpgï¼Œå°è¯• .png
            if (src.includes('.jpg')) {
                img.src = assetPath + baseName + '.png';
                img.onerror = function() {
                    // .png ä¹Ÿå¤±è´¥äº†
                    console.log('æ‰€æœ‰å°é¢å›¾æ ¼å¼éƒ½åŠ è½½å¤±è´¥');
                    this.style.display = 'none';
                    const placeholder = this.closest('.video-placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'flex';
                        placeholder.style.background = '#222';
                    }
                };
                return;
            }
            
            // å¦‚æœéƒ½å¤±è´¥äº†ï¼Œéšè—å›¾ç‰‡ï¼Œæ˜¾ç¤ºé»˜è®¤èƒŒæ™¯
            img.style.display = 'none';
            const placeholder = img.closest('.video-placeholder');
            if (placeholder) {
                placeholder.style.display = 'flex';
                placeholder.style.background = '#222';
            }
        }

        // ========================================================
        // ğŸ·ï¸ åˆ†ç±»ç­›é€‰åŠŸèƒ½
        // ========================================================
        
        // ç­›é€‰ä½œå“
        function filterWorks(category) {
            const items = document.querySelectorAll('.item');
            let visibleCount = 0;
            
            items.forEach(item => {
                if (category === 'all') {
                    item.style.display = '';
                    visibleCount++;
                } else {
                    const itemCategory = item.getAttribute('data-category');
                    if (itemCategory === category) {
                        item.style.display = '';
                        visibleCount++;
                    } else {
                        item.style.display = 'none';
                    }
                }
            });
            
            // å¦‚æœæ²¡æœ‰ä½œå“ï¼Œæ˜¾ç¤ºæç¤º
            const gallery = document.getElementById('app');
            let noResults = gallery.querySelector('.no-results');
            
            if (visibleCount === 0 && category !== 'all') {
                if (!noResults) {
                    noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.textContent = `æš‚æ— "${category}"ç±»åˆ«çš„ä½œå“`;
                    gallery.appendChild(noResults);
                } else {
                    noResults.textContent = `æš‚æ— "${category}"ç±»åˆ«çš„ä½œå“`;
                }
            } else {
                if (noResults) {
                    noResults.remove();
                }
            }
        }
        
        // åˆå§‹åŒ–åˆ†ç±»ç­›é€‰å™¨
        function initFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-btn');
            
            filterButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    filterButtons.forEach(b => b.classList.remove('active'));
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€åˆ°å½“å‰æŒ‰é’®
                    this.classList.add('active');
                    
                    // è·å–åˆ†ç±»å¹¶ç­›é€‰
                    const category = this.getAttribute('data-category');
                    filterWorks(category);
                });
            });
        }

        // ========================================================
        // ğŸ“¦ æ•°æ®åŠ è½½åŠŸèƒ½ï¼ˆä»JSONæ–‡ä»¶åŠ è½½ï¼‰
        // ========================================================
        
        // é»˜è®¤æ•°æ®ï¼ˆå¤‡ç”¨ï¼‰
        const defaultWorks = [
            {
                // ç¬¬ä¸€ä¸ªä½œå“
                type: 'video',               // ç±»å‹: 'video' æˆ– 'image'
                file: 'demo_video.mp4',      // assets æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶å
                title: 'UE5.6/MetaHuman å…¨èŒçŒäººå°¼é£å½¼å¤š',          // æ ‡é¢˜
                desc: 'Blender / ue5.6 ', // æè¿°
                category: 'åŠ¨ç”»',  // åˆ†ç±»: åŠ¨ç”»ã€ç»˜ç”»ã€äº¤äº’ã€è®¾è®¡
                link: 'https://www.bilibili.com/video/BV1zhCTB4Ebx' // ç‚¹å‡»è·³è½¬é“¾æ¥
            },
            {
                type: 'video',
                file: 'my_animation.mp4',  
                title: 'å‡å¦‚æˆ‘å®¶çš„çŒ«COSå…¨èŒçŒäººé‡Œçš„è§’è‰²ä¹‹å°¼é£å½¼å¤š',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV1Kb1jBqEdM'
            },
            // --- å¤åˆ¶ä¸‹é¢è¿™ä¸€å—æ¥æ·»åŠ æ–°ä½œå“ ---
            {
                type: 'video',
                file: 'my_animation2.mp4',  
                title: 'ä¹å¤©æ½æœˆ|è‡ªåˆ¶åŠ¨ç”»',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV1Q7xVzBEyh'
            },
            // ----------------------------------
            {
                type: 'video',
                file: 'å™¬é‡‘è™«.mp4',  
                title: 'å™¬é‡‘è™«|ä½åˆ—äººç•Œå¥‡è™«æ¦œç¬¬åäºŒä½ï¼Œç»ˆæˆé“ç¥–',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV1FrHnzaEB1'
            },
            // ----------------------------------
            {
                type: 'video',
                file: 'å…¨èŒçŒäººå‡¯ç‰¹.mp4',  
                title: 'å…¨èŒçŒäººå‡¯ç‰¹çœŸäººç‰ˆ',
                desc: 'Blender',
                category: 'åŠ¨ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV13mW4zzEVW'
            },
            
             // ----------------------------------
            {
                type: 'image',
                file: '2021 (2).JPG',  
                title: 'æ— é¢˜',
                desc: 'æ¿ç»˜',
                category: 'ç»˜ç”»',  // åˆ†ç±»
                link: 'https://www.bilibili.com/video/BV13mW4zzEVW'
            }
        ];
        
        const defaultSettings = {
            siteTitle: "MY WORK",
            headerTitle: "MG-mango\nPortfolio.",
            intro: {
                line1: "æ…¢å·¥è‰ºæœ¯.",
                line2: "å¹³PING & èŠ’æœå°å­.",
                line3: "æ•°å­—è‰ºæœ¯åˆ›ä½œè€….",
                line4: "æ¹–åŒ—æ­¦æ±‰.",
                line5: "ğŸ›°VXï¼šmango130p"
            },
            categories: ["åŠ¨ç”»", "ç»˜ç”»", "äº¤äº’", "è®¾è®¡"]
        };
        
        // åŠ è½½ä½œå“æ•°æ®
        async function loadWorks() {
            try {
                const response = await fetch('./_data/works.json');
                if (!response.ok) {
                    throw new Error('æ— æ³•åŠ è½½ä½œå“æ•°æ®');
                }
                const data = await response.json();
                // æŒ‰orderæ’åº
                const works = (data.works || []).sort((a, b) => (a.order || 0) - (b.order || 0));
                return works;
            } catch (error) {
                console.error('åŠ è½½ä½œå“æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤æ•°æ®:', error);
                return defaultWorks;
            }
        }
        
        // åŠ è½½é¡µé¢è®¾ç½®
        async function loadSettings() {
            try {
                const response = await fetch('./_data/settings.json');
                if (!response.ok) {
                    throw new Error('æ— æ³•åŠ è½½é¡µé¢è®¾ç½®');
                }
                const data = await response.json();
                return data.settings || defaultSettings;
            } catch (error) {
                console.error('åŠ è½½é¡µé¢è®¾ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤è®¾ç½®:', error);
                return defaultSettings;
            }
        }
        
        // æ›´æ–°é¡µé¢æ ‡é¢˜å’Œä»‹ç»
        function updatePageSettings(settings) {
            // æ›´æ–°ç½‘ç«™æ ‡é¢˜
            if (settings.siteTitle) {
                document.title = settings.siteTitle;
            }
            
            // æ›´æ–°å¤´éƒ¨æ ‡é¢˜
            const headerTitle = document.querySelector('h1');
            if (headerTitle && settings.headerTitle) {
                headerTitle.innerHTML = settings.headerTitle.replace(/\n/g, '<br>');
            }
            
            // æ›´æ–°ä»‹ç»æ–‡å­—
            const introDiv = document.querySelector('.intro');
            if (introDiv && settings.intro) {
                const intro = settings.intro;
                introDiv.innerHTML = `
                    ${intro.line1 || ''}<br>
                    ${intro.line2 || ''}<br>
                    ${intro.line3 || ''}<br>
                    ${intro.line4 || ''}<br>
                    ${intro.line5 || ''}
                `;
            }
            
            // æ›´æ–°åˆ†ç±»æŒ‰é’®ï¼ˆå¦‚æœéœ€è¦ï¼‰
            if (settings.categories && settings.categories.length > 0) {
                updateCategoryButtons(settings.categories);
            }
        }
        
        // æ›´æ–°åˆ†ç±»æŒ‰é’®
        function updateCategoryButtons(categories) {
            const filterButtons = document.querySelector('.filter-buttons');
            if (!filterButtons) return;
            
            let buttonsHTML = '<button class="filter-btn active" data-category="all">å…¨éƒ¨</button>';
            categories.forEach(category => {
                buttonsHTML += `<button class="filter-btn" data-category="${category}">${category}</button>`;
            });
            
            filterButtons.innerHTML = buttonsHTML;
            
            // é‡æ–°åˆå§‹åŒ–ç­›é€‰å™¨
            initFilterButtons();
        }
        
        // å…¨å±€å˜é‡ï¼Œå­˜å‚¨åŠ è½½çš„æ•°æ®
        let works = [];
        let settings = {};

        // ========================================================
        // ğŸ‘‡ ä¸‹é¢çš„ä»£ç è´Ÿè´£ç”Ÿæˆç½‘é¡µï¼Œéœ€è¦ä¿®æ”¹ä¸ºå¼‚æ­¥åŠ è½½ ğŸ‘‡
        // ========================================================
        
        // ç”Ÿæˆä½œå“åˆ—è¡¨
        async function generateWorks() {
            const gallery = document.getElementById('app');
            const assetPath = './assets/'; // è‡ªåŠ¨æŒ‡å‘ assets æ–‡ä»¶å¤¹
            
            // åŠ è½½æ•°æ®å’Œè®¾ç½®
            works = await loadWorks();
            settings = await loadSettings();
            
            // æ›´æ–°é¡µé¢è®¾ç½®
            updatePageSettings(settings);
            
            // æ¸…ç©ºç”»å»Š
            gallery.innerHTML = '';

            works.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'item';
            // æ·»åŠ åˆ†ç±»å±æ€§ï¼Œå¦‚æœæ²¡æœ‰åˆ†ç±»åˆ™é»˜è®¤ä¸º"å…¶ä»–"
            card.setAttribute('data-category', item.category || 'å…¶ä»–');
            
            let mediaHTML = '';
            
            // åœ¨å¾ªç¯å¤–éƒ¨å®šä¹‰å˜é‡ï¼Œç¡®ä¿ä½œç”¨åŸŸæ­£ç¡®
            let isMobile = false;
            let videoId = '';
            let placeholderId = '';
            let videoSrc = '';
            let coverSrc = '';

            if (item.type === 'video') {
                // è§†é¢‘ï¼šç§»åŠ¨ç«¯æ‡’åŠ è½½ä¼˜åŒ–ï¼Œæ¡Œé¢ç«¯æ­£å¸¸åŠ è½½
                isMobile = isMobileDevice();
                videoId = `video-${Date.now()}-${index}-${Math.random().toString(36).substr(2, 9)}`;
                placeholderId = `placeholder-${videoId}`;
                videoSrc = assetPath + item.file;
                coverSrc = getCoverImagePath(item.file, item.cover, assetPath);
                
                if (isMobile) {
                    // ç§»åŠ¨ç«¯ï¼šè‡ªåŠ¨æ’­æ”¾ï¼ˆæ»šåŠ¨åˆ°è§†å£æ—¶ï¼‰
                    mediaHTML = `
                        <div class="media-box video-container mobile-video-item" data-video-id="${videoId}" data-video-src="${videoSrc}" data-placeholder-id="${placeholderId}">
                            <span class="badge">VIDEO</span>
                            <div class="video-placeholder" id="${placeholderId}">
                                <img class="video-cover" src="${coverSrc}" alt="${item.title}" onerror="handleCoverError(this, '${item.file}');" loading="lazy">
                            </div>
                            <video 
                                id="${videoId}"
                                data-src="${videoSrc}"
                                muted 
                                loop 
                                playsinline
                                preload="none"
                                style="display: none;"
                                webkit-playsinline="true"
                                x5-playsinline="true"
                            ></video>
                        </div>
                    `;
                } else {
                    // æ¡Œé¢ç«¯ï¼šä¼˜åŒ–é¢„åŠ è½½ï¼Œä½¿ç”¨å°é¢å›¾å’Œ poster å±æ€§
                    mediaHTML = `
                        <div class="media-box video-container">
                            <span class="badge">VIDEO</span>
                            <div class="video-placeholder" id="${placeholderId}" style="display: flex;">
                                <img class="video-cover" src="${coverSrc}" alt="${item.title}" onerror="handleCoverError(this, '${item.file}');" loading="lazy">
                                <div class="play-button-large" style="display: none;"></div>
                            </div>
                            <video 
                                id="${videoId}"
                                src="${videoSrc}" 
                                poster="${coverSrc}"
                                muted 
                                loop 
                                playsinline
                                preload="auto"
                                onmouseover="handleVideoHover(this);" 
                                onmouseout="handleVideoHoverOut(this);"
                                onclick="handleVideoClick(this, event);"
                                oncanplay="handleVideoCanPlay(this);"
                                onplay="handleVideoPlay(this, '${placeholderId}');"
                            ></video>
                            <div class="play-button" style="display: none;">
                                â–¶
                            </div>
                        </div>
                    `;
                }
            } else {
                // å›¾ç‰‡
                mediaHTML = `
                    <div class="media-box">
                        <img src="${assetPath + item.file}" loading="lazy" alt="${item.title}">
                    </div>
                `;
            }

            // ä¼˜åŒ–ï¼šè§†é¢‘åŒºåŸŸç‚¹å‡»æ’­æ”¾ï¼Œæ–‡å­—åŒºåŸŸç‚¹å‡»è·³è½¬
            if (item.type === 'video') {
                card.innerHTML = `
                    ${mediaHTML}
                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" style="text-decoration:none; color:inherit;">
                        <div class="meta">
                            <div class="work-title">${item.title}</div>
                            <div class="work-desc">${item.desc}</div>
                        </div>
                    </a>
                `;
            } else {
                card.innerHTML = `
                    <a href="${item.link}" target="_blank" rel="noopener noreferrer" style="text-decoration:none; color:inherit;">
                        ${mediaHTML}
                        <div class="meta">
                            <div class="work-title">${item.title}</div>
                            <div class="work-desc">${item.desc}</div>
                        </div>
                    </a>
                `;
            }

            gallery.appendChild(card);
            
            // ç§»åŠ¨ç«¯è§†é¢‘è‡ªåŠ¨æ’­æ”¾ï¼ˆæ»šåŠ¨åˆ°è§†å£æ—¶ï¼‰
            if (isMobile && item.type === 'video') {
                // å»¶è¿Ÿè®¾ç½®ï¼Œç¡®ä¿DOMå·²å®Œå…¨åŠ è½½
                setTimeout(() => {
                    setupMobileVideoAutoplay(videoId, videoSrc, placeholderId);
                }, 100);
            }
            
            // ä¸ºè§†é¢‘æ·»åŠ åŠ è½½å®Œæˆäº‹ä»¶å¤„ç†ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰
            if (item.type === 'video') {
                const cardElement = gallery.lastElementChild;
                const video = cardElement.querySelector('video');
                const playButton = cardElement.querySelector('.play-button');
                const placeholder = cardElement.querySelector('.video-placeholder');
                
                if (video) {
                    // è§†é¢‘åŠ è½½æ•°æ®å®Œæˆ
                    video.addEventListener('loadeddata', function() {
                        this.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        this.style.display = 'block';
                    });
                    
                    // è§†é¢‘æ’­æ”¾æ—¶éšè—å ä½ç¬¦å’ŒæŒ‰é’®
                    video.addEventListener('play', function() {
                        this.classList.add('playing');
                        if (placeholder) {
                            placeholder.style.display = 'none';
                        }
                        if (playButton) {
                            playButton.style.display = 'none';
                        }
                        this.style.display = 'block';
                    });
                    
                    // è§†é¢‘æš‚åœæ—¶æ˜¾ç¤ºå ä½ç¬¦ï¼ˆç§»åŠ¨ç«¯ï¼‰
                    video.addEventListener('pause', function() {
                        this.classList.remove('playing');
                        if (isMobileDevice() && placeholder && !this.src) {
                            // å¦‚æœè§†é¢‘æœªåŠ è½½ï¼Œæ˜¾ç¤ºå ä½ç¬¦
                            placeholder.style.display = 'flex';
                            this.style.display = 'none';
                        }
                    });
                    
                    // è§†é¢‘åŠ è½½é”™è¯¯å¤„ç†
                    video.addEventListener('error', function() {
                        console.error('è§†é¢‘åŠ è½½é”™è¯¯:', this.src);
                        if (placeholder) {
                            const loadingDiv = placeholder.querySelector('.video-loading');
                            if (loadingDiv) {
                                loadingDiv.textContent = 'åŠ è½½å¤±è´¥ï¼Œç‚¹å‡»é‡è¯•';
                            }
                        }
                    });
                }
            }
            });
            
            // åˆå§‹åŒ–åˆ†ç±»ç­›é€‰åŠŸèƒ½
            initFilterButtons();
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateWorks();
        });
    </script>
    
    <!-- Decap CMS Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <script>
        if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
                if (!user) {
                    window.netlifyIdentity.on("login", () => {
                        document.location.href = "/admin/";
                    });
                }
            });
        }
    </script>

</body>
</html>